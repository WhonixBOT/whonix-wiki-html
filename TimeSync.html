<!DOCTYPE html>
<html class="client-nojs" dir="ltr" lang="en"><!-- 
 single html processed by https://github.com/zTrix/webpage2html
 title: Dev/TimeSync - Whonix
 url: ./TimeSync
 date: Wed Jan 30 08:13:17 2019
-->
<head>
<meta charset="utf-8"/>
<title>Dev/TimeSync - Whonix</title>
<link rel="stylesheet" type="text/css" href="style.css">




<meta content="" name="ResourceLoaderDynamicStyles"/>

<meta content="MediaWiki 1.31.1" name="generator"/>
<meta content="" name="google-site-verification"/>
<meta content="https://www.whonix.org/w/images/4/47/Whonix_Facebook_Social_Share.png" name="image"/>
<meta content="https://www.whonix.org/w/images/4/47/Whonix_Facebook_Social_Share.png" name="twitter:image:src"/>
<meta content="summary_large_image" name="twitter:card"/>
<meta content="@Whonix" name="twitter:site"/>
<meta content="Whonix" name="twitter:domain"/>
<meta content="@Whonix" name="twitter:creator"/>
<meta content="Design Documentation of Whonix's Time Synchronization Mechanism" name="description"/>
<meta content="Design Documentation of Whonix's Time Synchronization Mechanism" name="twitter:description"/>
<meta content="width=device-width, user-scalable=yes, initial-scale=1.0" name="viewport"/>
<link data-href="/w/index.php?title=Dev/TimeSync&amp;action=edit" href="https://www.whonix.org/w/index.php?title=Dev/TimeSync&amp;action=edit" rel="alternate.html" title="Edit" type="application/x-wiki"/>
<link data-href="/w/index.php?title=Dev/TimeSync&amp;action=edit" href="https://www.whonix.org/w/index.php?title=Dev/TimeSync&amp;action=edit" rel="edit.html" title="Edit"/>
<link data-href="/favicon.ico" href="https://www.whonix.org/favicon.ico" rel="shortcut icon"/>
<link data-href="/w/opensearch_desc.php" href="https://www.whonix.org/w/opensearch_desc.php" rel="search.html" title="Whonix (en)" type="application/opensearchdescription+xml"/>
<link data-href="https://www.whonix.org/w/api.php?action=rsd" href="https://www.whonix.org/w/api.php?action=rsd" rel="EditURI" type="application/rsd+xml"/>
<link data-href="/w/index.php?title=Special:RecentChanges&amp;feed=atom" href="https://www.whonix.org/w/index.php?title=Special:RecentChanges&amp;feed=atom" rel="alternate.html" title="Whonix Atom feed" type="application/atom+xml"/>
<link data-href="./Dev/TimeSync" href="./Dev/TimeSync" rel="canonical"/>
<meta content="article" property="og:type"/>
<meta content="Whonix" property="og:site_name"/>
<meta content="Dev/TimeSync" property="og:title"/>
<meta content="./Dev/TimeSync" property="og:url"/>
<meta content="https://www.whonix.org/w/images/4/47/Whonix_Facebook_Social_Share.png" property="og:image"/>
<meta content="Design Documentation of Whonix's Time Synchronization Mechanism" property="og:description"/>

<meta content="" property="fb:app_id"/>
<meta content="" property="fb:admins"/>
<meta content="https://www.facebook.com/Whonix" property="article:author"/>
<meta content="https://www.facebook.com/Whonix" property="article:publisher"/>
<meta content="IE=edge" http-equiv="X-UA-Compatible"/>
<!--[if lt IE 9]><script src="/w/load.php?debug=false&amp;lang=en&amp;modules=html5shiv&amp;only=scripts&amp;skin=foreground&amp;sync=1"></script><![endif]-->
</head>
<body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Dev_TimeSync rootpage-Dev skin-foreground action-view"><div id="navwrapper"><!-- START FOREGROUNDTEMPLATE -->

</div>
<div id="page-content">
<div class="row">
<div class="large-12 columns">
<!-- Output page indicators -->
<div class="mw-indicators mw-body-content">
</div>
<!-- If user is logged in output echo location -->
<!--[if lt IE 9]>
				<div id="siteNotice" class="sitenotice panel radius">Whonix may not look as expected in this version of Internet Explorer. We recommend you upgrade to a newer version of Internet Explorer or switch to a browser like Firefox or Chrome.</div>
				<![endif]-->
<div class="sitenotice" id="siteNotice"><div dir="ltr" id="localNotice" lang="en"><div class="mw-parser-output"><p><style type="text/css">

#banner {
 position: relative;
 overflow: hidden;
 margin-bottom: 0.5em !important;
 margin-top: 0.5em !important;
 background-color:#D03232;
 border: solid 1px #aaaaaa; 
 height:66px;
}

#banner a.cn-full-banner-click {
 display:block;
 height:100%;
 width:100%;
 cursor: pointer;
}


#banner-logo {
 position: absolute;
 top: 8px;
 left: 15px;
 background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAArCAYAAAA65tviAAANxklEQVRo3rWae3Ad1X3HP2d3r65elmz5KcvyA0u2MQYbcIyhNgNI40wcHAdKIDjM5EFC0oaB0nTS0Jl22ukj09CmnaRNJ7QpTMorpQWSQoITiRjimNi4NTa2ZVvGT0m2JEuWru5D997d8+sf5+zdvZJsnHS6M5rV2bv39/t9f+/zO1cxxdUGdJp7nYKPAXcLrAEWAnkFx4E3gVc74KcA7UAHV3a12bvlMVfBBoGNClYCswFf4CSwD9ip4JcdoC/HQ031sN3cPifwPftIAKViC0AUKPv/VmVA6SsF1AazgBcUtEmMx4TX4s++ADzdCX6o6EsCCV9oNxpfKoCL4VgD1NYkmdEwjZHRDCdSOUZBHAtQ4JyClg7IXs4S1gqdwO1WEQKoGZZHwkpfAMbsX+zKKVjRAWcuaZFQk+3QDbRooAlomlHDnffdQuPCWVTVJEELIkIhm2fw/Agdb3Wx/cCZUABfwbYOeHEqrbXBastmlg/SXFWhPr7uKhbOrqW2sgLXUSjR5Md9xtLj9A2k2LHvDKNaOAcikdAPdMBzk4CEINqgU8EdClgErFvfyub7bkGs8IhAoBGtES2gBc9RnD45wJM/fIczF9LiGpqPdMC32ywDq6C7gJc0SLXnqE/d3MJNKxopFAMkCOkZ2mhBtEZpcBB2vtfDO8cH6QfS1qWBrR3wo1BhcYt8FHhVLIgbb1jC1gc2orUxvmEQAQjXBOb/hOvwrWd38t8nBnAMycc64O+tJTYreE2DLG6oVX/8iQ8ZACEtMSDQIBICMYoTLagg4PxgipffPkEvkDJgAoEZnZAGUDawqwVGgMQcYHnjDB786laUgNaC0trcRaM1pTWWWSiM0gE/+Mk+fvruaVEmdr4osNtmH3XT0jl89o5rEMczfhIqRkIwEoHQgkIsf0EXCwz1D/GDX52iBxOIAqMYMBK61j0CL7rAEuAP/vx+KuumWUEjZsQ0KFaDaF0SQkRw/IDnfryb7QfOigdFBa6Ae9vVjXxyw9VQWRvRjLuspuRWEIKJ0RfQmTF27TvO3p5RjofCw291wtvKmj4FTGsC1t+4hLse3IwOiAlcrjWxWgqFmChUopDlb5/bwf4zwyigdW4dj915A279bBCrgDg9kUk8jDsbRZZ4APT38a87DtNb0NJvQqO3ExaoNlim4KiALAL1xUe3sODqlijgxPit6BiDmE9PLRDI0Dm+9tTPyRV8/vq+dVQ0LkIpJxKqRKfcPc3nhm75c/MsyKTZt2svO86m5ERU21pUG9wDvOgBS4E/ffIxiiRQlogWo/0yAGHsxC1S0pplHmgGDu7DVTB98TLcZFUkUJlLWR4SKUVKtGN8LN3ssS4yg4M89V4/p8EPwAPuUW3wd8CjM0FtWNnE/Y9/nmIhiOLDMii5lAiC1VqoTSItx10kGB0m33uaqmWrSxoWGw9l67LvESkj5A3oXJb0u3vR2QyegmcPDnLa18EQuAq+pdpsCVkM3Pup21nzkXa07xuBY24wyX9DjYYgofRZFDcayY+jKipj7xMJiZQDiNEUAeW4+BeHyR49SHHgHIICLTgi7OpL8+7FcX0KHOAN1Q6nBBYtAx78w200r15t0yI20JhCiNhayn14olCircBhZiq5CdaSsc/F1GjRmuJgP7ljhyj09YByI7cOTPB3j+TlF/1ZjpkY6VVtMKqgrgX48l/8LnNbW21miQnIhAAsgZta+Agg5WvibgSClJot8X2kWCB79DDZg/tCj40KZKCjVBwIg7kir/VlpdsAyag28B1wlwKPfOMxZi9tMSlXImZl2itxIEqJZaBCoSc/FxHTSihT+8X3yR0/QrbrAH4qBcWCLbQ25etY6xLoMpcdzPm81j8u3da+qt3WkBbg4b96hMY1NyK+T5BNQ7GI9ouGsOOilAuuh/ISKC8BjhMJGsZJ6Cl+ET2eQ+dyBOkU/uhFgpGLFEcuojNjBOkxdDYTKaOs9bH3QGItS9QOIZqBXMBPLhSwFrmo2swGZnEr8NnPtTGzvpIgO2aratQHSSCgTX8kQWCaR+vTSimjdN83nxV9xA/KqrYxUMyScW3HG8aSsBMa1NgaLZzOaXaMFEMgx1QbbAc2LQK2fewGFi1oQIcNYhBv5MK1BRcjOnEdarC0tt3tRH/H+nvIL/pe6F7lTWpIz1WKPakiezOaHgPkZdUOTwh8pQHUh1cv5LabW/F9P2pBAo3WGhVmMh2tdWDrimVatg50qeGMgEosYCPBDL1yt5JYrEj4LgqlwFPw7/0FugNhzPRcf6Ta4eMCLzvA6soEX/7MRvL5YlmrLjoKMuNSsVY7ZCJi3U+X/FiCqP0vuadE75i1pR/o8iY1iIFCULHNbF4Lz/QXOBltqm5TbbBAwVkBaQb1O7+9lrqaihITYkxEYj5sgcWzzCRNxvJ+6bMy4LH3YlYr21wRnxaYxHIsq3kz5XM6AlIZtvFngQVzgU3XNbPu2qYyJhN9dvJurnw9dUxMVMTkTZoBbmJSiZQDsMki4SheGSjQ5Qsp8/j7HfDpEMhGgbcc4Lqkx5c+sZZCvoiUNlGRayixwWmFDdcqiKwjsc3YxLWJLR19T8uk9UQAIQg3WUFfpsB/XShwygw+RGC+gn5l99VJgRzAHFCbr23i+ta5UUxom2qDmOaEqNpewjIywcWiLjm+jqw8lRXiV8OmtTz1zC6OBsYaCo53QOvEKcrDwLcdYJXn8IUt1+H7QVlMXFJAmZgM4rVHXzobaX1FACTQ1K5azClVwX90HqLHWANgVgcMl4DE5lm9Ao11oDY01rFpTbN1o8jfQwHD2lIW/GJS8AfVBDfQjAaaM55mSU6hqgKCGo3ruUhRcMcdvHEHsw/TVC2dT2L5Qr7z9E7eFyEwIJ7tgAemnGsJtCv4mYBcBWrb+iU01FbYGhHb8gaxAhZbhxlHTWoton19Rgf8W33AS+th0eKAh+bUcO/tH6a+ehEnuodQY/0Mv/8e+aODsF2Y0dxMdUsTz7y6n/8ZTDFuhO7vgHmXHZm2wz8LfN4BrgI+fctiqjynlE0+qCZQEAb8AskV4+STASrr4A079J1x+UarT9PmDaxddyNVlZVsa/guS5s2QDpF14FBBntS1JMnfSFPX1+BG2a4nOtqYs/eAXafHmIoEnhlB3R94Mi0zUwbl1aAWlXhsm1tc6kah5U5KlpmrQrC6Kocrb+3glmt13C8u0CtCiiOpRjuOU/63FlSmSSvL7+J/MxqChmfx5v/k2leLe54kQt9gjMODY5LrXZpUB6jvT5/9p0Mp/qD0ngWuKsDXvnAIbbNYjOBfgG3BlhdneCuVXPLKnB54Gvy84p86McuycJGcoMj+OkM3YeGkGweP1VgdCigSmBa1ueha6+hKqlZevYEH6kfYdEMl+uaPLycS5BSDPcJR44GPH80zytKqDwJc0agZoQn3oKvXvE03rpYo8BpIFENLE843LtyDo5M0RCKMNRU4OZnAsZ6k1T4PvmLmvSwIp9ymFPh0lTjQdph554MW1oqSSQ0dZWaRE4z60SOm6qEGRqCPLw7BscbwFsCugqyBeh/H0lfROkxzjHOz+jlbXz208WviGZck48V7Lx2OXBEQCpAtTqKbcsbcEVKk8fQxfJFYfvmDNs+6VAvCZqmuZB2IOtAxmGgJ2DnngzfPKv55a2gqmB6JdQloaYCqj2o8MCz/iNiDknyPmSLkC4io+Oo1Lgd1x/G53VaSXPqshaJxctKBYcEJAFqmaPYvKCWhoQzqf0eKWoOJjUXmjXzlgvzZgEZuNAD/3hSOFMJ2fnA9YZHpQczqmBaAqoroNKFhGv2a5gOn2IAOR8yRUjlYfQCFE4BDfTzHL/PKNuBEXUlJ0zt0GLnt7WANIHaNKuS5TUuxVjqVUoRCGS1kCpC1u50k47R7gsP+Lx6UEPSzGad2VBfC/UVUJuAqgRUuOCGVsEMrvIBZAMYPGuUQjNQARziNC9xPwHdVwTEJgAHOGrPTmQmqNVJh1uneyQcs0O8THFmZExo2ac43zWdh54foGtAoA4qF0PDfKithOoEVFn3KllFQ1HDuRNwpgej0jzQhzAdxZPcTZbdVwRkQvX/EbBFMCO+RcBHGxLMSSozyhFjmUkNX6DYf2+RNZshWXAZueiw5fk8qWpQLjSvhbrp1ioOePagRRR07YKBgmXWC0zHbJ8HKfIid5L7NYBMOBC6XcEbYg9dpgPXJBTtMxN4qtw6IoJyHZyqJIHn0eWNs2dBhqXL4I6Vis7DIo8fQWkXKucizU2oucvMLlAVYPebkJ0N1GE2G/OB83a9nb/kKE9R5MSvBWQCqOnA08BWAfFAzQLWV7tcX+fhKTsScx2cigSugsMX8+wfydOt4YI9J3SAcfj6gXUo6vkajeZMscaF3Djoq8zJDg5QQHBRnOUX/JBvAnuBPkD/X4CEKfo+gX9QMEuDVIFqAG6d5tFS7eB6Lj3jATuGCgwBw7EDVODnHtz9ujlkgnpWsJ4dNDKXuTag+4F6hGEUVfTyPb5OjjeAc4Tfu1z6/Q1i52+AR8WEDgnrBa71hGx09idihLi+EwbKDk0TQJF6NrOHFpYhCEUUHgHbeYJu/gVjzNErruy/CRj7A4M/EfhKnLhEIN7B/Pigp5NL/MigGTiLyx28wGru4Qjf5xgP8z5piGaA/y9ApgA2D/gSBlAS+K6Cf+qAw1dE4GngM0ArK+nm8JQ/JZhw/S9dtEONwVO5dQAAAABJRU5ErkJggg==);
 height: 50px;
 width: 100%;
 background-repeat: no-repeat;
}

#banner #black-text {
 font-size: 1.1em;
 color: white;
 padding: 0.5em 40px 0.4em 60px;
 line-height: 1.3em;
 text-align: center;
}
</style>
</p><div id="banner">
<a class="cn-full-banner-click" data-href="/wiki/Payments" href="./Payments.html" title="">
<div id="banner-logo"></div>
<div id="black-text">
Whonix requires money to stay alive.
     </div>
</a>
</div>
</div></div></div> </div>
</div>
<div id="mw-js-message" style="display:none;"></div>
<div class="row">
<div class="large-12 columns" id="p-cactions">
<a class="button small secondary radius" data-dropdown="actions" data-options="align:left; is_hover: true; hover_timeout:700" href="#" id="actions-button"><i class="fa fa-cog"><span class="show-for-medium-up">Â Actions</span></i></a>
<!--RTL -->
<ul class="f-dropdown" data-dropdown-content="" id="actions">
<li class="selected" id="ca-nstab-main"><a accesskey="c" data-href="/wiki/Dev/TimeSync" href="./Dev/TimeSync.html" title="View the content page [c]">Page</a></li><li class="new" id="ca-talk"><a accesskey="t" data-href="/w/index.php?title=Talk:Dev/TimeSync&amp;action=edit&amp;redlink=1" href="https://www.whonix.org/w/index.php?title=Talk:Dev/TimeSync&amp;action=edit&amp;redlink=1" rel="discussion.html" title="Discussion about the content page (page does not exist) [t]">Discussion</a></li><li id="ca-edit"><a accesskey="e" data-href="/w/index.php?title=Dev/TimeSync&amp;action=edit" href="https://www.whonix.org/w/index.php?title=Dev/TimeSync&amp;action=edit.html" title="Edit this page [e]">Edit</a></li><li id="ca-history"><a accesskey="h" data-href="/w/index.php?title=Dev/TimeSync&amp;action=history" href="https://www.whonix.org/w/index.php?title=Dev/TimeSync&amp;action=history.html" title="Past revisions of this page [h]">History</a></li> </ul>
<!--RTL -->
<div id="content">
<h1 class="title" id="firstHeading">Dev/TimeSync</h1>
<h5 class="subtitle" id="siteSub"><span class="subpages">&lt; <a class="mw-redirect" data-href="/wiki/Dev" href="./Dev.html" title="Dev">Dev</a></span><span class="mw-redirectedfrom">(Redirected from <a class="mw-redirect" data-href="/w/index.php?title=TimeSync&amp;redirect=no" href="https://www.whonix.org/w/index.php?title=TimeSync&amp;redirect=no.html" title="TimeSync">TimeSync</a>)</span></h5>
<div class="clear_both" id="contentSub"></div>
<div class="mw-bodytext" id="bodyContent">
<div class="mw-content-ltr" dir="ltr" id="mw-content-text" lang="en"><div class="mw-parser-output">
<div class="toc" id="toc"><div class="toctitle" dir="ltr" lang="en"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Basic_Knowledge"><span class="tocnumber">1</span> <span class="toctext">Basic Knowledge</span></a>
<ul>
<li class="toclevel-2 tocsection-2"><a href="#Introduction"><span class="tocnumber">1.1</span> <span class="toctext">Introduction</span></a></li>
<li class="toclevel-2 tocsection-3"><a href="#Virtualizers_Time_Synchronization_Features"><span class="tocnumber">1.2</span> <span class="toctext">Virtualizers Time Synchronization Features</span></a>
<ul>
<li class="toclevel-3 tocsection-4"><a href="#VirtualBox_Time_Synchronization_Features"><span class="tocnumber">1.2.1</span> <span class="toctext">VirtualBox Time Synchronization Features</span></a></li>
<li class="toclevel-3 tocsection-5"><a href="#KVM.27s_Time_Synchronization_Features"><span class="tocnumber">1.2.2</span> <span class="toctext">KVM's Time Synchronization Features</span></a></li>
<li class="toclevel-3 tocsection-6"><a href="#Qubes_Time_Synchronization_Features"><span class="tocnumber">1.2.3</span> <span class="toctext">Qubes Time Synchronization Features</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-7"><a href="#Facts"><span class="tocnumber">1.3</span> <span class="toctext">Facts</span></a></li>
<li class="toclevel-2 tocsection-8"><a href="#Other_Facts"><span class="tocnumber">1.4</span> <span class="toctext">Other Facts</span></a></li>
<li class="toclevel-2 tocsection-9"><a href="#Definitions"><span class="tocnumber">1.5</span> <span class="toctext">Definitions</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-10"><a href="#Attacks"><span class="tocnumber">2</span> <span class="toctext">Attacks</span></a></li>
<li class="toclevel-1 tocsection-11"><a href="#Goals"><span class="tocnumber">3</span> <span class="toctext">Goals</span></a>
<ul>
<li class="toclevel-2 tocsection-12"><a href="#Completely_Isolated_Virtual_Time"><span class="tocnumber">3.1</span> <span class="toctext">Completely Isolated Virtual Time</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-13"><a href="#Whonix.27s_Time_Synchronization_Mechanism"><span class="tocnumber">4</span> <span class="toctext">Whonix's Time Synchronization Mechanism</span></a>
<ul>
<li class="toclevel-2 tocsection-14"><a href="#Overview"><span class="tocnumber">4.1</span> <span class="toctext">Overview</span></a></li>
<li class="toclevel-2 tocsection-15"><a href="#Block_Networking_until_sdwdate_Finishes"><span class="tocnumber">4.2</span> <span class="toctext">Block Networking until sdwdate Finishes</span></a></li>
<li class="toclevel-2 tocsection-16"><a href="#boot_clock_randomization"><span class="tocnumber">4.3</span> <span class="toctext">boot clock randomization</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-17"><a href="#Conclusions"><span class="tocnumber">5</span> <span class="toctext">Conclusions</span></a></li>
<li class="toclevel-1 tocsection-18"><a href="#Adjusting_time_slowly_using_adjtimex.2Fntp_adjtime"><span class="tocnumber">6</span> <span class="toctext">Adjusting time slowly using adjtimex/ntp_adjtime</span></a></li>
<li class="toclevel-1 tocsection-19"><a href="#External_Clock"><span class="tocnumber">7</span> <span class="toctext">External Clock</span></a></li>
<li class="toclevel-1 tocsection-20"><a href="#Discarded_Options"><span class="tocnumber">8</span> <span class="toctext">Discarded Options</span></a>
<ul>
<li class="toclevel-2 tocsection-21"><a href="#NTP"><span class="tocnumber">8.1</span> <span class="toctext">NTP</span></a></li>
<li class="toclevel-2 tocsection-22"><a href="#tlsdate"><span class="tocnumber">8.2</span> <span class="toctext">tlsdate</span></a></li>
<li class="toclevel-2 tocsection-23"><a href="#htpdate"><span class="tocnumber">8.3</span> <span class="toctext">htpdate</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-24"><a href="#TODO"><span class="tocnumber">9</span> <span class="toctext">TODO</span></a>
<ul>
<li class="toclevel-2 tocsection-25"><a href="#Consideration_no_TimeSync_on_Host"><span class="tocnumber">9.1</span> <span class="toctext">Consideration no TimeSync on Host</span></a></li>
<li class="toclevel-2 tocsection-26"><a href="#Time_Source_of_Time_Servers"><span class="tocnumber">9.2</span> <span class="toctext">Time Source of Time Servers</span></a></li>
<li class="toclevel-2 tocsection-27"><a href="#Local_Clock_Leaks"><span class="tocnumber">9.3</span> <span class="toctext">Local Clock Leaks</span></a></li>
<li class="toclevel-2 tocsection-28"><a href="#Tor_Consensus_Method"><span class="tocnumber">9.4</span> <span class="toctext">Tor Consensus Method</span></a>
<ul>
<li class="toclevel-3 tocsection-29"><a href="#Introduction_2"><span class="tocnumber">9.4.1</span> <span class="toctext">Introduction</span></a></li>
<li class="toclevel-3 tocsection-30"><a href="#Open_Questions"><span class="tocnumber">9.4.2</span> <span class="toctext">Open Questions</span></a>
<ul>
<li class="toclevel-4 tocsection-31"><a href="#Under_which_conditions_Tor_is_not_able_to_verify_the_Tor_consensus_file.3F"><span class="tocnumber">9.4.2.1</span> <span class="toctext">Under which conditions Tor is not able to verify the Tor consensus file?</span></a></li>
<li class="toclevel-4 tocsection-32"><a href="#Other_Questions"><span class="tocnumber">9.4.2.2</span> <span class="toctext">Other Questions</span></a></li>
</ul>
</li>
<li class="toclevel-3 tocsection-33"><a href="#Reasons_for_relying_solely_on_anondate_for_time_setting"><span class="tocnumber">9.4.3</span> <span class="toctext">Reasons for relying solely on anondate for time setting</span></a></li>
<li class="toclevel-3 tocsection-34"><a href="#Reasons_against_relying_solely_on_anondate_for_time_setting"><span class="tocnumber">9.4.4</span> <span class="toctext">Reasons against relying solely on anondate for time setting</span></a></li>
<li class="toclevel-3 tocsection-35"><a href="#Conclusions_2"><span class="tocnumber">9.4.5</span> <span class="toctext">Conclusions</span></a></li>
<li class="toclevel-3 tocsection-36"><a href="#Why_not_use_tordate_by_Tails_instead_of_reinventing_the_wheel_with_anondate.3F"><span class="tocnumber">9.4.6</span> <span class="toctext">Why not use tordate by Tails instead of reinventing the wheel with anondate?</span></a></li>
<li class="toclevel-3 tocsection-37"><a href="#Random_Stuff"><span class="tocnumber">9.4.7</span> <span class="toctext">Random Stuff</span></a></li>
<li class="toclevel-3 tocsection-38"><a href="#Status_of_this_idea"><span class="tocnumber">9.4.8</span> <span class="toctext">Status of this idea</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-1 tocsection-39"><a href="#Debugging"><span class="tocnumber">10</span> <span class="toctext">Debugging</span></a></li>
<li class="toclevel-1 tocsection-40"><a href="#See_Also"><span class="tocnumber">11</span> <span class="toctext">See Also</span></a>
<ul>
<li class="toclevel-2 tocsection-41"><a href="#Other"><span class="tocnumber">11.1</span> <span class="toctext">Other</span></a></li>
<li class="toclevel-2 tocsection-42"><a href="#Previous_Discussion"><span class="tocnumber">11.2</span> <span class="toctext">Previous Discussion</span></a></li>
<li class="toclevel-2 tocsection-43"><a href="#Other_Projects"><span class="tocnumber">11.3</span> <span class="toctext">Other Projects</span></a></li>
<li class="toclevel-2 tocsection-44"><a href="#Comparison_with_Others"><span class="tocnumber">11.4</span> <span class="toctext">Comparison with Others</span></a></li>
<li class="toclevel-2 tocsection-45"><a href="#Tickets"><span class="tocnumber">11.5</span> <span class="toctext">Tickets</span></a>
<ul>
<li class="toclevel-3 tocsection-46"><a href="#Qubes"><span class="tocnumber">11.5.1</span> <span class="toctext">Qubes</span></a>
<ul>
<li class="toclevel-4 tocsection-47"><a href="#high_priority"><span class="tocnumber">11.5.1.1</span> <span class="toctext">high priority</span></a></li>
<li class="toclevel-4 tocsection-48"><a href="#normal_priority"><span class="tocnumber">11.5.1.2</span> <span class="toctext">normal priority</span></a></li>
</ul>
</li>
<li class="toclevel-3 tocsection-49"><a href="#others"><span class="tocnumber">11.5.2</span> <span class="toctext">others</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-50"><a href="#Clock_Correlation_Attack"><span class="tocnumber">11.6</span> <span class="toctext">Clock Correlation Attack</span></a>
<ul>
<li class="toclevel-3 tocsection-51"><a href="#Attack"><span class="tocnumber">11.6.1</span> <span class="toctext">Attack</span></a></li>
<li class="toclevel-3 tocsection-52"><a href="#Defense"><span class="tocnumber">11.6.2</span> <span class="toctext">Defense</span></a></li>
<li class="toclevel-3 tocsection-53"><a href="#wallclock"><span class="tocnumber">11.6.3</span> <span class="toctext">wallclock</span></a></li>
<li class="toclevel-3 tocsection-54"><a href="#Development"><span class="tocnumber">11.6.4</span> <span class="toctext">Development</span></a></li>
<li class="toclevel-3 tocsection-55"><a href="#Sources"><span class="tocnumber">11.6.5</span> <span class="toctext">Sources</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-56"><a href="#TSC"><span class="tocnumber">11.7</span> <span class="toctext">TSC</span></a></li>
<li class="toclevel-2 tocsection-57"><a href="#clocksource_xen"><span class="tocnumber">11.8</span> <span class="toctext">clocksource xen</span></a></li>
<li class="toclevel-2 tocsection-58"><a href="#Resources"><span class="tocnumber">11.9</span> <span class="toctext">Resources</span></a></li>
<li class="toclevel-2 tocsection-59"><a href="#Footnotes"><span class="tocnumber">11.10</span> <span class="toctext">Footnotes</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-60"><a href="#License"><span class="tocnumber">12</span> <span class="toctext">License</span></a></li>
</ul>
</div>
<h1><span class="mw-headline" id="Basic_Knowledge">Basic Knowledge</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a data-href="/w/index.php?title=Dev/TimeSync&amp;action=edit&amp;section=1" href="https://www.whonix.org/w/index.php?title=Dev/TimeSync&amp;action=edit&amp;section=1.html" title="Edit section: Basic Knowledge">edit</a><span class="mw-editsection-bracket">]</span></span></h1>
<h2><span class="mw-headline" id="Introduction">Introduction</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a data-href="/w/index.php?title=Dev/TimeSync&amp;action=edit&amp;section=2" href="https://www.whonix.org/w/index.php?title=Dev/TimeSync&amp;action=edit&amp;section=2.html" title="Edit section: Introduction">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>The Post Install Advice is part of this design, therefore read <a data-href="/wiki/Post_Install_Advice#Network_Time_Syncing" href="./Post_Install_Advice.html" title="Post Install Advice">Network Time Syncing</a> first. Also read the Advanced Security Guide chapter <a data-href="/wiki/Advanced_Security_Guide#Network_Time_Synchronization" href="./Advanced_Security_Guide.html" title="Advanced Security Guide">Network Time Synchronization</a> as well.
</p>
<h2><span class="mw-headline" id="Virtualizers_Time_Synchronization_Features">Virtualizers Time Synchronization Features</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a data-href="/w/index.php?title=Dev/TimeSync&amp;action=edit&amp;section=3" href="https://www.whonix.org/w/index.php?title=Dev/TimeSync&amp;action=edit&amp;section=3.html" title="Edit section: Virtualizers Time Synchronization Features">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<h3><span class="mw-headline" id="VirtualBox_Time_Synchronization_Features">VirtualBox Time Synchronization Features</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a data-href="/w/index.php?title=Dev/TimeSync&amp;action=edit&amp;section=4" href="https://www.whonix.org/w/index.php?title=Dev/TimeSync&amp;action=edit&amp;section=4.html" title="Edit section: VirtualBox Time Synchronization Features">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p><span id="VirtualBox.27s_Time_Synchronization_Features"></span>
For understanding Whonix's Time Synchronization Mechanism, it is required to know VirtualBox's time synchronization features:
</p>
<ul><li>VirtualBox uses the host's time if it needs to correct the time for guests.</li>
<li>(Some of VirtualBox's time synchronization features depend on guest additions.)</li>
<li>By default VirtualBox corrects Virtual Machine guests' virtual hardware system clock,
<ul><li>when they get powered on,</li>
<li>when they resume from suspension and</li>
<li>when their clock is more than X minutes off.</li></ul></li></ul>
<h3><span id="KVM's_Time_Synchronization_Features"></span><span class="mw-headline" id="KVM.27s_Time_Synchronization_Features">KVM's Time Synchronization Features</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a data-href="/w/index.php?title=Dev/TimeSync&amp;action=edit&amp;section=5" href="https://www.whonix.org/w/index.php?title=Dev/TimeSync&amp;action=edit&amp;section=5.html" title="Edit section: KVM's Time Synchronization Features">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>TODO: document
</p>
<h3><span class="mw-headline" id="Qubes_Time_Synchronization_Features">Qubes Time Synchronization Features</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a data-href="/w/index.php?title=Dev/TimeSync&amp;action=edit&amp;section=6" href="https://www.whonix.org/w/index.php?title=Dev/TimeSync&amp;action=edit&amp;section=6.html" title="Edit section: Qubes Time Synchronization Features">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>TODO: document
</p>
<h2><span class="mw-headline" id="Facts">Facts</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a data-href="/w/index.php?title=Dev/TimeSync&amp;action=edit&amp;section=7" href="https://www.whonix.org/w/index.php?title=Dev/TimeSync&amp;action=edit&amp;section=7.html" title="Edit section: Facts">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>People have been using:
</p>
<ul><li>Tor Browser and Mozilla Firefox in parallel</li>
<li>Tails inside VMs and Firefox on the host</li>
<li>Tor Browser inside Whonix-Workstation and Mozilla Firefox on the host</li></ul>
<h2><span class="mw-headline" id="Other_Facts">Other Facts</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a data-href="/w/index.php?title=Dev/TimeSync&amp;action=edit&amp;section=8" href="https://www.whonix.org/w/index.php?title=Dev/TimeSync&amp;action=edit&amp;section=8.html" title="Edit section: Other Facts">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<ul><li>Almost no one and no operating system is using Secure Network Time Synchronization or External Clocks by default. Most systems synchronize the system clock using unauthenticated NTP. An adversary tampering with NTP replies or malicious NTP server makes things even worse. Even if there was authenticated NTP, there is a requirement for a distributed trust model.</li>
<li>A system not using NTP or using authenticated NTP stands out from most other users.</li>
<li>clock jumps are bad: <a class="external text" data-href="http://www.wired.com/2012/07/leap-second-glitch-explained/" href="http://www.wired.com/2012/07/leap-second-glitch-explained/" rel="noreferrer noopener" target="_blank">wired: The Inside Story of the Extra Second That Crashed the Web</a></li></ul>
<h2><span class="mw-headline" id="Definitions">Definitions</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a data-href="/w/index.php?title=Dev/TimeSync&amp;action=edit&amp;section=9" href="https://www.whonix.org/w/index.php?title=Dev/TimeSync&amp;action=edit&amp;section=9.html" title="Edit section: Definitions">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<ul><li>Time Sanity Check in context of Whonix: Is an init.d script, which checks if the system clock is between build timestamp and expiration date (17 MAY 2033 10:00:00).</li></ul>
<h1><span class="mw-headline" id="Attacks">Attacks</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a data-href="/w/index.php?title=Dev/TimeSync&amp;action=edit&amp;section=10" href="https://www.whonix.org/w/index.php?title=Dev/TimeSync&amp;action=edit&amp;section=10.html" title="Edit section: Attacks">edit</a><span class="mw-editsection-bracket">]</span></span></h1>
<p>A correct system clock is crucial for many reasons (see footnotes for more):
</p>
<ul><li><b>Attack 1:</b> Replay attacks <sup class="reference" id="cite_ref-1"><a href="#cite_note-1">[1]</a></sup></li>
<li><b>Attack 2:</b> Feeding old/outdated/known vulnerable updates and (https) certificates <sup class="reference" id="cite_ref-2"><a href="#cite_note-2">[2]</a></sup></li>
<li><b>Attack 3:</b> Deanonymizing <sup class="reference" id="cite_ref-3"><a href="#cite_note-3">[3]</a></sup></li>
<li><b>Attack 4:</b> Linking all sessions to the same pseudonym <sup class="reference" id="cite_ref-4"><a href="#cite_note-4">[4]</a></sup></li>
<li><b>Attack 5:</b> Locating onion services. <sup class="reference" id="cite_ref-5"><a href="#cite_note-5">[5]</a></sup></li></ul>
<h1><span class="mw-headline" id="Goals">Goals</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a data-href="/w/index.php?title=Dev/TimeSync&amp;action=edit&amp;section=11" href="https://www.whonix.org/w/index.php?title=Dev/TimeSync&amp;action=edit&amp;section=11.html" title="Edit section: Goals">edit</a><span class="mw-editsection-bracket">]</span></span></h1>
<h2><span class="mw-headline" id="Completely_Isolated_Virtual_Time">Completely Isolated Virtual Time</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a data-href="/w/index.php?title=Dev/TimeSync&amp;action=edit&amp;section=12" href="https://www.whonix.org/w/index.php?title=Dev/TimeSync&amp;action=edit&amp;section=12.html" title="Edit section: Completely Isolated Virtual Time">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>Quote <a class="external free" data-href="https://www.kernel.org/doc/Documentation/virtual/kvm/timekeeping.txt" href="https://www.kernel.org/doc/Documentation/virtual/kvm/timekeeping.txt" rel="noreferrer noopener" target="_blank">https://www.kernel.org/doc/Documentation/virtual/kvm/timekeeping.txt</a>
</p>
<blockquote>
<p>4.8) Covert channels and leaks
</p><p>In addition to the above problems, time information will inevitably leak to the guest about the host in anything but a perfect implementation of virtualized
time.  This may allow the guest to infer the presence of a hypervisor (as in a red-pill type detection), and it may allow information to leak between guest 
by using CPU utilization itself as a signalling channel.  Preventing such problems would require completely isolated virtual time which may not track
real time any longer.  This may be useful in certain security or QA contexts, but in general is not recommended for real-world deployment scenarios.
</p>
</blockquote>
<p>So we want a completely isolated virtual time.
</p>
<h1><span id="Whonix's_Time_Synchronization_Mechanism"></span><span class="mw-headline" id="Whonix.27s_Time_Synchronization_Mechanism">Whonix's Time Synchronization Mechanism</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a data-href="/w/index.php?title=Dev/TimeSync&amp;action=edit&amp;section=13" href="https://www.whonix.org/w/index.php?title=Dev/TimeSync&amp;action=edit&amp;section=13.html" title="Edit section: Whonix's Time Synchronization Mechanism">edit</a><span class="mw-editsection-bracket">]</span></span></h1>
<h2><span class="mw-headline" id="Overview">Overview</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a data-href="/w/index.php?title=Dev/TimeSync&amp;action=edit&amp;section=14" href="https://www.whonix.org/w/index.php?title=Dev/TimeSync&amp;action=edit&amp;section=14.html" title="Edit section: Overview">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<ul><li>Whonix leaves the host's system clock or time synchronization mechanism untouched.</li>
<li>Whonix-Gateway and Whonix-Workstation are commonly used inside virtualizers and therefore have their own virtual hardware system clocks.</li>
<li>Virtualizers time synchronization get disabled by Whonix.
<ul><li>Most VirtualBox time synchronization features get disabled by Whonix.
<ul><li>Guest additions time synchronization gets disabled in by <a class="external text" data-href="https://github.com/Whonix/vbox-disable-timesync" href="https://github.com/Whonix/vbox-disable-timesync" rel="noreferrer noopener" target="_blank">vbox-disable-timesync</a> at run time. See VirtualBox bug report <a class="external text" data-href="https://www.virtualbox.org/ticket/10828" href="https://www.virtualbox.org/ticket/10828" rel="noreferrer noopener" target="_blank">VBoxService --disable-timesync broken</a>. They say it is actually not a bug. It is a missing feature, that running instances of VBoxService can not be modified in their settings.</li>
<li>built in time synchronization features get disabled by <i>VBoxManage setextradata "$VMNAME" "VBoxInternal/Devices/VMMDev/0/Config/GetHostTimeDisabled" "1"</i> at build time.</li></ul></li>
<li>KVM: TODO document</li>
<li>Qubes: TODO
<ul><li><a class="external free" data-href="https://phabricator.whonix.org/T389" href="https://phabricator.whonix.org/T389" rel="noreferrer noopener" target="_blank">https://phabricator.whonix.org/T389</a></li>
<li><a class="external free" data-href="https://phabricator.whonix.org/T440" href="https://phabricator.whonix.org/T440" rel="noreferrer noopener" target="_blank">https://phabricator.whonix.org/T440</a></li>
<li><a class="external free" data-href="https://phabricator.whonix.org/T389" href="https://phabricator.whonix.org/T389" rel="noreferrer noopener" target="_blank">https://phabricator.whonix.org/T389</a></li></ul></li></ul></li>
<li>VM Settings, Hardware Clock: set to UTC.</li>
<li>When get powered on, they still get their time from the host. The user is advised to modify the biossystemtimeoffset in Advanced Security Guide, chapter <a data-href="/wiki/Advanced_Security_Guide#Network_Time_Synchronization" href="./Advanced_Security_Guide.html" title="Advanced Security Guide">Network Time Synchronization</a>. <sup class="reference" id="cite_ref-6"><a href="#cite_note-6">[6]</a></sup></li>
<li>Time Sanity Check before <a data-href="/wiki/Sdwdate" href="./Sdwdate.html" title="Sdwdate">sdwdate</a> will be executed, this ensures, that the host clock is sane and not slow in 1980. User gets advised to fix its host clock in such cases.</li>
<li>After they are connected to the Tor network, they use sdwdate (inspired by <a class="external text" data-href="https://tails.boum.org/contribute/design/Time_syncing/" href="https://tails.boum.org/contribute/design/Time_syncing/" rel="noreferrer noopener" target="_blank">tails_htp</a>) to set the system clock. <sup class="reference" id="cite_ref-7"><a href="#cite_note-7">[7]</a></sup></li>
<li>Time Sanity Check after sdwdate was executed. This should catch eventual bigger bugs and attacks. User gets informed if it fails.</li>
<li>Using <a class="external text" data-href="https://github.com/Whonix/bootclockrandomization" href="https://github.com/Whonix/bootclockrandomization" rel="noreferrer noopener" target="_blank">Boot Clock Randomization</a>, i.e. after boot, the clock is set randomly between 5 and 180 seconds into the past or future. This is useful to enforce the design goal, that the host clock and Whonix-Workstation clock should always slightly differ. It is also useful to obfuscate the clock when sdwdate itself is running, because naturally at this time, sdwdate hasn't finished.</li>
<li>sdwdate runs after booting.</li>
<li>Whonix-Gateway: Using sdwdate is better against Attack (1) when using a bridge.</li>
<li>Every hour, at a random time, sdwdate will set the clock again. This is useful for machines running for long time periods without reboot.</li>
<li>sdwdate runs at non-predictable times to prevent the ISP or Tor guard/bridge node to guess, that the user is running Whonix.</li>
<li>sdwdate adds or subtracts a random amount of seconds in range of 0.000000001 and 0.999999999. <sup class="reference" id="cite_ref-8"><a href="#cite_note-8">[8]</a></sup> This is supposed to prevent time servers tracking individual users.</li>
<li>That will reach the design goal, that all clocks, the host's, Whonix-Gateway's and Whonix-Workstation's slightly differ.</li></ul>
<h2><span class="mw-headline" id="Block_Networking_until_sdwdate_Finishes">Block Networking until sdwdate Finishes</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a data-href="/w/index.php?title=Dev/TimeSync&amp;action=edit&amp;section=15" href="https://www.whonix.org/w/index.php?title=Dev/TimeSync&amp;action=edit&amp;section=15.html" title="Edit section: Block Networking until sdwdate Finishes">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>TODO: expand
</p><p><b>This is not yet enabled by default.</b>
</p><p>Network access will be limited to Tor and sdwdate until network time synchronization is done to prevent accidental traffic before that is done.
</p><p>Whonix firewall runs in two different modes. After boot  it runs in <code>timesync-fail-closed mode</code>.
</p>
<pre>OK: First run during current boot, therefore running in timesync-fail-closed mode.
OK: (Only local Tor control port connections and torified sdwdate allowed.)
</pre>
<p>Otherwise after sdwdate succeeded or after manually reloading Whonix firewall it runs in <code>full mode</code>.
</p>
<pre>OK: Consecutive run during current boot, therefore running in full mode.
OK: (Full torified network access allowed.)
</pre>
<p>Users are encouraged to test so we can enable it by default in the future.
</p><p><a class="external free" data-href="https://forums.whonix.org/t/testers-wanted-blocking-networking-until-sdwdate-finished-status-of-sdwdate-gui/5372/6" href="https://forums.whonix.org/t/testers-wanted-blocking-networking-until-sdwdate-finished-status-of-sdwdate-gui/5372/6" rel="noreferrer noopener" target="_blank">https://forums.whonix.org/t/testers-wanted-blocking-networking-until-sdwdate-finished-status-of-sdwdate-gui/5372/6</a>
</p><p>Instructions:
</p><p><a data-href="/wiki/Network_Time_Synchronization#Block_Networking_until_sdwdate_Finishes" href="./Network_Time_Synchronization.html" title="Network Time Synchronization">Network_Time_Synchronization#Block_Networking_until_sdwdate_Finishes</a>
</p>
<h2><span class="mw-headline" id="boot_clock_randomization">boot clock randomization</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a data-href="/w/index.php?title=Dev/TimeSync&amp;action=edit&amp;section=16" href="https://www.whonix.org/w/index.php?title=Dev/TimeSync&amp;action=edit&amp;section=16.html" title="Edit section: boot clock randomization">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p><a class="external free" data-href="https://github.com/Whonix/bootclockrandomization" href="https://github.com/Whonix/bootclockrandomization" rel="noreferrer noopener" target="_blank">https://github.com/Whonix/bootclockrandomization</a>
</p><p><a class="external free" data-href="https://forums.whonix.org/t/bootclockrandomization-always-moving-clock-plus-or-5-seconds" href="https://forums.whonix.org/t/bootclockrandomization-always-moving-clock-plus-or-5-seconds" rel="noreferrer noopener" target="_blank">https://forums.whonix.org/t/bootclockrandomization-always-moving-clock-plus-or-5-seconds</a>
</p><p>Open <i><span style="background-color:#FBFBFB">/var/log/bootclockrandomization.log</span></i> in an editor.
</p>
<div style="background: #F8F8F8; border: 2px; padding: 5px; margin: 10px; border-style: solid; border-color: black; width: 100%">
<p><u>If you are using a graphical environment</u>, run.
</p><div class="codeContainerNew">
<div class="preDiv">
<pre>kwrite /var/log/bootclockrandomization.log</pre>
</div>
<div class="textareaDiv">
<textarea class="codeBoxAreaNew" onfocus="this.select()" readonly="readonly" rows="1">kwrite /var/log/bootclockrandomization.log</textarea>
</div>
</div>
<p><u>If you are using a terminal (Konsole)</u>, run.
</p><div class="codeContainerNew">
<div class="preDiv">
<pre>nano /var/log/bootclockrandomization.log</pre>
</div>
<div class="textareaDiv">
<textarea class="codeBoxAreaNew" onfocus="this.select()" readonly="readonly" rows="1">nano /var/log/bootclockrandomization.log</textarea>
</div>
</div>
</div>
<h1><span class="mw-headline" id="Conclusions">Conclusions</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a data-href="/w/index.php?title=Dev/TimeSync&amp;action=edit&amp;section=17" href="https://www.whonix.org/w/index.php?title=Dev/TimeSync&amp;action=edit&amp;section=17.html" title="Edit section: Conclusions">edit</a><span class="mw-editsection-bracket">]</span></span></h1>
<ul><li><span style="background-color: #FF9090"><b>Attack 1</b></span> is a general Tor problem. It is impossible to solve for Whonix. It is unsolved in other projects as well.</li>
<li><span style="background-color: #FFFB85"><b>Attack 2</b></span> gets partially defeated.
<ul><li>Whonix-Gateway and Whonix-Workstation are immune.</li>
<li>This problem is unsolved in other projects as well.
<ul><li>This is a general problem with all operating systems.</li>
<li>The host is still at risk.</li>
<li><a class="external text" data-href="http://brainstorm.ubuntu.com/idea/30050/" href="http://brainstorm.ubuntu.com/idea/30050/" rel="noreferrer noopener" target="_blank">Ubuntu Brainstorm Idea #30050: Secure Network Time Synchronization</a></li>
<li><a class="external text" data-href="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=%23687166" href="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=%23687166" rel="noreferrer noopener" target="_blank">Debian Bug Report ntp: NTP security vulnerability because not using authentication by default</a></li>
<li><a class="external text" data-href="https://bugs.launchpad.net/ubuntu/+source/ntp/+bug/1039420" href="https://bugs.launchpad.net/ubuntu/+source/ntp/+bug/1039420" rel="noreferrer noopener" target="_blank">Ubuntu Bug Report NTP security vulnerability because not using authentication by default</a></li></ul></li>
<li>Manual workaround: Check your clock manually and read <a data-href="/wiki/Other_Operating_Systems#About_Ubuntu" href="./Other_Operating_Systems.html" title="Other Operating Systems">About Ubuntu</a> (stale mirror attack). (<a class="external text" data-href="https://bugs.launchpad.net/launchpad/+bug/716535" href="https://bugs.launchpad.net/launchpad/+bug/716535" rel="noreferrer noopener" target="_blank">Bug #716535: Please support Valid-Until in release files for security.ubuntu.com</a>)</li></ul></li>
<li><span style="background-color: #90FF90"><b>Attack 3</b></span> gets defeated, Whonix adds additional security.</li>
<li><span style="background-color: #90FF90"><b>Attack 4</b></span> gets defeated, Whonix adds additional security.</li>
<li><span style="background-color: #FF9090"><b>Attack 5</b></span> is a general Tor problem, which can not be solved by Whonix and which is unsolved in other projects as well. Since host, Whonix-Gateway and Whonix-Workstation time all differ, at least this attack becomes harder against Whonix.</li></ul>
<p>When the user powers on Whonix-Gateway and the host time is too much off, it will not be able to connect to the Tor network. It is advised, when powering on Whonix-Gateway, to check that the host time is no more than 1 hour in past or more than 3 hour in future, otherwise Tor will be unable to establish circuits.<sup class="reference" id="cite_ref-9"><a href="#cite_note-9">[9]</a></sup>
</p><p>An adversary tampering with the user's clock, while the user doesn't recognize that, can't do any more damage to Whonix than he could do to Tor Browser. Worst case is a denial of service for Tor. On the other hand, an adversary capable of actively tampering with the traffic between the user and its entry guard or bridge poses much bigger risks to Tor in general. <sup class="reference" id="cite_ref-10"><a href="#cite_note-10">[10]</a></sup>
</p><p>The reason for running TimeSync on Whonix-Gateway, is that onion services can only be accessed if the clock is no more than 30 minutes slow or fast.<sup class="reference" id="cite_ref-11"><a href="#cite_note-11">[11]</a></sup> Running TimeSync ensures, that Whonix-Gateway's clock is reasonably accurate.
</p><p><span id="sclockadj2"></span>
</p>
<h1><span id="Adjusting_time_slowly_using_adjtimex/ntp_adjtime"></span><span class="mw-headline" id="Adjusting_time_slowly_using_adjtimex.2Fntp_adjtime">Adjusting time slowly using adjtimex/ntp_adjtime</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a data-href="/w/index.php?title=Dev/TimeSync&amp;action=edit&amp;section=18" href="https://www.whonix.org/w/index.php?title=Dev/TimeSync&amp;action=edit&amp;section=18.html" title="Edit section: Adjusting time slowly using adjtimex/ntp adjtime">edit</a><span class="mw-editsection-bracket">]</span></span></h1>
<p>Under <a class="external text" data-href="https://github.com/Whonix/sdwdate/pull/4" href="https://github.com/Whonix/sdwdate/pull/4" rel="noreferrer noopener" target="_blank">consideration</a> is changing the time with <tt>sclockadj2</tt>. The initial drive for this was that calling <tt>clock_settime()</tt> in the original <tt>sclockadj</tt> can result in several thousand entries in <tt>systemd</tt>'s journal per invocation (can be seen with <tt>journalctrl -f</tt>) on Debian.
</p><p><tt>sclockadj2</tt> uses <tt>adjtimex</tt> call in libc (als called <tt>ntp_adjtime</tt>) which translates to Linux' kernel system call 124. This is a modal interface that is used by `ntpd` to change the system clock. <tt>adjtimex</tt> supports a mode with "hard" changes to the time, but those generate entries in <tt>systemd</tt> journal, just like with <tt>clock_settime</tt>.
</p><p>The offset mode for <tt>adjtimex</tt> allows a change of 0.5 seconds per call (used to be ~130 milisec until the 2.6 kernel). The documentation of this call is incomplete, partly resulting from the limited number of clients (<tt>ntpd</tt>, <tt>chronyd</tt>) using this interface, but by tracing the kernel internals (<tt>linux/kernel/time/ntp.c</tt> and <tt>/linux/kernel/time/timekeeping.c</tt>) one can get a more complete picture, including that modern kernels support a NANO mode easier implementation of smaller adjustments than the older Î¼second based interface, without the need to do clock tick adjustment calculations.
</p><p>Based on this interface and mode bit definitions taken from <tt>/usr/include/linux/timex.h</tt> (more complete than the counterparts you typically find online) to form a Python based interface via <tt>ctypes</tt>. Primarily first setting the kernel internals to handle nanoseconds specifications and run in PLL mode. Then using OFFSET  to adjust the time.
With this call the kernel is instructed to change the time gradually. You can observe this change by making further calls to <tt>adjtimex</tt>, this time without setting any values (specified by 0 in the modes bitfield of the structure handed to <tt>adjtimex</tt>). To handle changes of more than the maximum allowed (Â±0.5 seconds), you need to invoke a 0.5 second change and observe if the offset has been reduced to 0, then invoke again. Writing a new offset using <tt>adjtimex</tt> will overwrite any running adjustment process, therefore you have to wait.
</p><p>By default the kernel uses a decreasing stepsize as the (remaining) offset to handle  approaches 0. This can be influenced by the TIMECONST to start with bigger steps, or even reset the stepsize on a regular basis while the kernel is changing the clock according to the remaining offset. 
</p><p>The <tt>ntpd</tt> can use this offset changing possibility as is but also has a more sofisticated approach, by instructing the kernel about the drift compared to the internal clock. 
</p><p>The <tt>sclockadj2</tt> directly uses a nanosecond offset (positive or negative) that instructs the kernel to adjust (looping muliple invocations if the absolute value of the offset &gt; 0.5 seconds. The program has to be run as root in order to tell the kernel to make these changes (querying the status doesn't require this). At the start of this process a PID file is written, which is checked during loops (if running longer than 0.5 s) and will kill any previous invocation of the program. The syntax for the offset invocation is:
</p>
<pre>     sclockadj2 offset [-h] [--constant CONSTANT] [--verbose] [--quiet][--wait]  nanoseconds
</pre>
<p>for changes &gt; 0.5s <tt>--wait</tt> has to be specified. Increased verbosity can be used to watch the progress of what the kernel is doing with the offset.
</p><p>This progress can also be seen by invoking the program with the <tt>status</tt> option. To do so has some instructional value for observing normal `ntpd` behaviour as well. The full options for status:
</p>
<pre>   usage: sclockadj2 status [-h] [--follow] [--set] [--verbose] [--quiet]
                            [--debug] [--wait]
</pre>
<pre>   adjtimex status (--quiet -&gt; only offset, --verbose -&gt; detail)
</pre>
<pre>   optional arguments:
     -h, --help     show this help message and exit
     --follow, -f   follow status indefinately
     --set          set status explicitly to PLL and NANO
     --verbose, -v  increase verbosity level
     --quiet, -q    decrease verbosity level
     --debug, -D    Debug messages. Don't change date
     --wait         wait for offset to return to 0
</pre>
<p>Stopping a previous invocation of <tt>sclockadj2</tt> (which might be looping on values &gt; 0.5s), including stopping the internal offset can easily be achieved by calling <tt>sclockadj2 offset 0</tt>
</p>
<h1><span class="mw-headline" id="External_Clock">External Clock</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a data-href="/w/index.php?title=Dev/TimeSync&amp;action=edit&amp;section=19" href="https://www.whonix.org/w/index.php?title=Dev/TimeSync&amp;action=edit&amp;section=19.html" title="Edit section: External Clock">edit</a><span class="mw-editsection-bracket">]</span></span></h1>
<p>This topic is still under research. Help is welcome.
</p><p>It might make sense to add an external clock, such as a GPS, or even better an atomic clock. (Can we get an atomic USB clock?) This clock should be added to the host and/or Whonix-Gateway and/or Whonix-Workstation?
</p><p>Open question: would the GPS/atomic clock be too accurate and would that make Whonix more fingerprintable?
</p>
<h1><span class="mw-headline" id="Discarded_Options">Discarded Options</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a data-href="/w/index.php?title=Dev/TimeSync&amp;action=edit&amp;section=20" href="https://www.whonix.org/w/index.php?title=Dev/TimeSync&amp;action=edit&amp;section=20.html" title="Edit section: Discarded Options">edit</a><span class="mw-editsection-bracket">]</span></span></h1>
<h2><span class="mw-headline" id="NTP">NTP</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a data-href="/w/index.php?title=Dev/TimeSync&amp;action=edit&amp;section=21" href="https://www.whonix.org/w/index.php?title=Dev/TimeSync&amp;action=edit&amp;section=21.html" title="Edit section: NTP">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p><span id="NTP_authentication_.28autokey.29_is_insecure"></span>
</p>
<ul><li>unauthenticated by default</li>
<li>NTP insecure
<ul><li><a class="external free" data-href="https://gist.github.com/CHEF-KOCH/12976cf15012d64b8fd2" href="https://gist.github.com/CHEF-KOCH/12976cf15012d64b8fd2" rel="noreferrer noopener" target="_blank">https://gist.github.com/CHEF-KOCH/12976cf15012d64b8fd2</a> (<a class="external text" data-href="http://www.webcitation.org/6aRCpoRYw" href="http://www.webcitation.org/6aRCpoRYw" rel="noreferrer noopener" target="_blank">w</a>)</li>
<li><a class="external free" data-href="https://blog.hboeck.de/archives/863-Dont-update-NTP-stop-using-it.html" href="https://blog.hboeck.de/archives/863-Dont-update-NTP-stop-using-it.html" rel="noreferrer noopener" target="_blank">https://blog.hboeck.de/archives/863-Dont-update-NTP-stop-using-it.html</a> (<a class="external text" data-href="http://www.webcitation.org/6aRCvxwSc" href="http://www.webcitation.org/6aRCvxwSc" rel="noreferrer noopener" target="_blank">w</a>)</li></ul></li>
<li>NTP authentication (autokey):
<ul><li>info: <a class="external free" data-href="https://tools.ietf.org/html/draft-ietf-ntp-network-time-security-00" href="https://tools.ietf.org/html/draft-ietf-ntp-network-time-security-00" rel="noreferrer noopener" target="_blank">https://tools.ietf.org/html/draft-ietf-ntp-network-time-security-00</a></li>
<li>insecure: <a class="external free" data-href="http://www.innovationslab.net/~brian/NTP/autokey-analysis.pdf" href="http://www.innovationslab.net/~brian/NTP/autokey-analysis.pdf" rel="noreferrer noopener" target="_blank">http://www.innovationslab.net/~brian/NTP/autokey-analysis.pdf</a> [down, contacted author]</li>
<li>insecure: <a class="external free" data-href="http://zero-entropy.de/autokey_analysis.pdf" href="http://zero-entropy.de/autokey_analysis.pdf" rel="noreferrer noopener" target="_blank">http://zero-entropy.de/autokey_analysis.pdf</a> (<a class="external text" data-href="http://www.webcitation.org/6aRAaVJEt" href="http://www.webcitation.org/6aRAaVJEt" rel="noreferrer noopener" target="_blank">w</a>)</li>
<li>Does not work behind NAT? <sup class="reference" id="cite_ref-12"><a href="#cite_note-12">[12]</a></sup> <sup class="reference" id="cite_ref-13"><a href="#cite_note-13">[13]</a></sup></li></ul></li>
<li>NTP leaks the local time. <sup class="reference" id="cite_ref-ntp-rfc_14-0"><a href="#cite_note-ntp-rfc-14">[14]</a></sup> <sup class="reference" id="cite_ref-ntp-se_15-0"><a href="#cite_note-ntp-se-15">[15]</a></sup></li>
<li>does not work over Tor, because NTP uses UDP, while the Tor network does not support UDP</li>
<li><a class="external text" data-href="http://www.ntp.org/ntpfaq/NTP-s-algo.htm" href="http://www.ntp.org/ntpfaq/NTP-s-algo.htm" rel="noreferrer noopener" target="_blank">Quote</a> <sup class="reference" id="cite_ref-16"><a href="#cite_note-16">[16]</a></sup>: <blockquote><p>For example standard Linux adjusts the time with a rate of 0.5ms per second.</p></blockquote>
<ul><li>500000 ns = 0.5 ms = 0.0005 s</li>
<li>1 day = 86400 s <sup class="reference" id="cite_ref-17"><a href="#cite_note-17">[17]</a></sup></li>
<li>NTP can adjust the clock 43.2 s per 1 day.</li>
<li>Or 1296 s (= 21.6 m) per 30 days.</li>
<li>Or 15768 s (= 262.8 m) (=4.38 h) per 365 days. (4.38 h per year)</li></ul></li></ul>
<h2><span class="mw-headline" id="tlsdate">tlsdate</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a data-href="/w/index.php?title=Dev/TimeSync&amp;action=edit&amp;section=22" href="https://www.whonix.org/w/index.php?title=Dev/TimeSync&amp;action=edit&amp;section=22.html" title="Edit section: tlsdate">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p><a class="external free" data-href="https://github.com/ioerror/tlsdate" href="https://github.com/ioerror/tlsdate" rel="noreferrer noopener" target="_blank">https://github.com/ioerror/tlsdate</a>
</p><p>Pros:
</p>
<ul><li>uses seccomp</li>
<li><s>written by Jacob Appelbaum (security researcher; The Tor Project staff member)</s> Due to the recent news now probably abandoned.</li></ul>
<p>Cons:
</p>
<ul><li>Only native SSL CA pinning support. No direct SSL certificate pinning support.</li>
<li>Does not distribute trust. <sup class="reference" id="cite_ref-18"><a href="#cite_note-18">[18]</a></sup> <sup class="reference" id="cite_ref-19"><a href="#cite_note-19">[19]</a></sup> <sup class="reference" id="cite_ref-20"><a href="#cite_note-20">[20]</a></sup> The single time source can send by error or by malicious intent send wrong time replies.</li>
<li>Does not support hooks for user notifications about state of network time synchronization. -&gt; Users shouldn't use the internet in Whonix-Workstation before network time synchronization finished, and timesync is informing users about this. -&gt; Implementing notifications would be difficult or require patching tlsdate.</li>
<li>Produces clock jumps, which confuses various applications. Does not gradually adjust as <i><span style="background-color:#FBFBFB">sdwdate</span></i> does with <a class="external text" data-href="https://github.com/Whonix/Whonix/issues/169" href="https://github.com/Whonix/Whonix/issues/169" rel="noreferrer noopener" target="_blank">Slow Clock Adjuster</a>. <sup class="reference" id="cite_ref-21"><a href="#cite_note-21">[21]</a></sup></li>
<li>Cannot connect to (most) Tor onion services, because most of those do not support SSL. <sup class="reference" id="cite_ref-22"><a href="#cite_note-22">[22]</a></sup> <sup class="reference" id="cite_ref-23"><a href="#cite_note-23">[23]</a></sup></li>
<li>Minor: <i><span style="background-color:#FBFBFB">command line parser doesn't fail closed on extraneous / unknown command line parameters</span></i> <sup class="reference" id="cite_ref-24"><a href="#cite_note-24">[24]</a></sup> - not that important in the absence of bugs, butsafer behavior for <i><span style="background-color:#FBFBFB">tlsdate</span></i> would be to fail closed on on extraneous / unknown command line parameters.</li>
<li>Likely denial of service issue: <a class="external free" data-href="https://github.com/ioerror/tlsdate/issues/149" href="https://github.com/ioerror/tlsdate/issues/149" rel="noreferrer noopener" target="_blank">https://github.com/ioerror/tlsdate/issues/149</a></li></ul>
<h2><span class="mw-headline" id="htpdate">htpdate</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a data-href="/w/index.php?title=Dev/TimeSync&amp;action=edit&amp;section=23" href="https://www.whonix.org/w/index.php?title=Dev/TimeSync&amp;action=edit&amp;section=23.html" title="Edit section: htpdate">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>Original.
</p>
<ul><li><a class="external text" data-href="http://www.vervest.org/htp/" href="http://www.vervest.org/htp/" rel="noreferrer noopener" target="_blank">htpdate</a> (<a class="external text" data-href="https://packages.debian.org/stretch/htpdate" href="https://packages.debian.org/stretch/htpdate" rel="noreferrer noopener" target="_blank">debian package</a>)</li>
<li>Detailed Package status in Debian: <a class="external free" data-href="https://packages.qa.debian.org/h/htpdate.html" href="https://packages.qa.debian.org/h/htpdate.html" rel="noreferrer noopener" target="_blank">https://packages.qa.debian.org/h/htpdate.html</a></li>
<li>unresponsive upstream [tails-dev contact them because of their tails_htp fork - no reply] [no reply to Patrick in past]</li>
<li>htp=htpdate (same program as the one on rkeene.org)</li></ul>
<p>Tails htpdate fork
</p>
<ul><li>code in revision control: <a class="external free" data-href="http://anonscm.debian.org/cgit/collab-maint/htpdate.git" href="http://anonscm.debian.org/cgit/collab-maint/htpdate.git" rel="noreferrer noopener" target="_blank">http://anonscm.debian.org/cgit/collab-maint/htpdate.git</a></li>
<li>Tails' reasons to fork htpdate:
<ul><li>they wanted to add features such as TLS Authentication of servers</li>
<li>and source pools model. <sup class="reference" id="cite_ref-25"><a href="#cite_note-25">[25]</a></sup></li></ul></li>
<li>The htpdate implementation used by Tails is the perl one and not the C version.</li></ul>
<h1><span class="mw-headline" id="TODO">TODO</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a data-href="/w/index.php?title=Dev/TimeSync&amp;action=edit&amp;section=24" href="https://www.whonix.org/w/index.php?title=Dev/TimeSync&amp;action=edit&amp;section=24.html" title="Edit section: TODO">edit</a><span class="mw-editsection-bracket">]</span></span></h1>
<h2><span class="mw-headline" id="Consideration_no_TimeSync_on_Host">Consideration no TimeSync on Host</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a data-href="/w/index.php?title=Dev/TimeSync&amp;action=edit&amp;section=25" href="https://www.whonix.org/w/index.php?title=Dev/TimeSync&amp;action=edit&amp;section=25.html" title="Edit section: Consideration no TimeSync on Host">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>Would it be advisable to run no network time synching daemon on the host at all? There are open questions. See:<br/>
<a class="external free" data-href="https://forums.whonix.org/t/ntp-possible-skew-per-day-month-year/487/5" href="https://forums.whonix.org/t/ntp-possible-skew-per-day-month-year/487/5" rel="noreferrer noopener" target="_blank">https://forums.whonix.org/t/ntp-possible-skew-per-day-month-year/487/5</a>
</p>
<h2><span class="mw-headline" id="Time_Source_of_Time_Servers">Time Source of Time Servers</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a data-href="/w/index.php?title=Dev/TimeSync&amp;action=edit&amp;section=26" href="https://www.whonix.org/w/index.php?title=Dev/TimeSync&amp;action=edit&amp;section=26.html" title="Edit section: Time Source of Time Servers">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>Even if we could very securely obtain the time from a server with distributed trust and everything, the question is, how do these servers themselves set their own clock? If they just use unauthenticated NTP themselves, they might not be a big help.
</p><p>TODO: invent sdwdate-server
</p>
<h2><span class="mw-headline" id="Local_Clock_Leaks">Local Clock Leaks</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a data-href="/w/index.php?title=Dev/TimeSync&amp;action=edit&amp;section=27" href="https://www.whonix.org/w/index.php?title=Dev/TimeSync&amp;action=edit&amp;section=27.html" title="Edit section: Local Clock Leaks">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<ul><li>TCP Sequence Numbers -&gt; open issue <sup class="reference" id="cite_ref-26"><a href="#cite_note-26">[26]</a></sup></li>
<li>ICMP timestamps -&gt; blocked by Whonix's firewall for Whonix VMs. Host: <a data-href="/wiki/Computer_Security_Education#Disable_ICMP_Timestamps" href="./Computer_Security_Education.html" title="Computer Security Education">Recommendation</a> to disable on the host.</li>
<li>TCP timestamps -&gt; blocked in Whonix VMs by <a class="external text" data-href="https://github.com/Whonix/tcp-timestamps-disable" href="https://github.com/Whonix/tcp-timestamps-disable" rel="noreferrer noopener" target="_blank">tcp-timestamps-disable</a>.; <a data-href="/wiki/Computer_Security_Education#Disable_TCP_Timestamps" href="./Computer_Security_Education.html" title="Computer Security Education">Recommendation</a> to disable on the host.</li>
<li>NTP <sup class="reference" id="cite_ref-ntp-rfc_14-1"><a href="#cite_note-ntp-rfc-14">[14]</a></sup> <sup class="reference" id="cite_ref-ntp-se_15-1"><a href="#cite_note-ntp-se-15">[15]</a></sup> -&gt; Not installed by default in Whonix. Host: TODO</li>
<li>Automatic updaters and other network using cron jobs that run at non-random, canned <sup class="reference" id="cite_ref-27"><a href="#cite_note-27">[27]</a></sup> times.</li>
<li>Javascript. <sup class="reference" id="cite_ref-28"><a href="#cite_note-28">[28]</a></sup> <sup class="reference" id="cite_ref-29"><a href="#cite_note-29">[29]</a></sup></li>
<li>E-mail clients such as Mozilla Thunderbird and others.<sup class="reference" id="cite_ref-30"><a href="#cite_note-30">[30]</a></sup></li></ul>
<p><a class="external text" data-href="https://trac.torproject.org/projects/tor/ticket/6314" href="https://trac.torproject.org/projects/tor/ticket/6314" rel="noreferrer noopener" target="_blank">prevent leak via Date header field (local timestamp disclosure)</a>
&lt;/ref&gt; <sup class="reference" id="cite_ref-31"><a href="#cite_note-31">[31]</a></sup> <sup class="reference" id="cite_ref-32"><a href="#cite_note-32">[32]</a></sup>
</p>
<ul><li>https / ssl, older <sup class="reference" id="cite_ref-example-wheezy_33-0"><a href="#cite_note-example-wheezy-33">[33]</a></sup> versions of openssl, TLS HELLO gmt_unix_time <sup class="reference" id="cite_ref-34"><a href="#cite_note-34">[34]</a></sup> What about other implementations of SSL / TLS, other than openssl?</li>
<li>older <sup class="reference" id="cite_ref-example-wheezy_33-1"><a href="#cite_note-example-wheezy-33">[33]</a></sup> versions of Tor (NETINFO) <sup class="reference" id="cite_ref-tlsleaktwo_35-0"><a href="#cite_note-tlsleaktwo-35">[35]</a></sup></li>
<li>web servers (time stamps from http headers (RFC 2616)) <sup class="reference" id="cite_ref-36"><a href="#cite_note-36">[36]</a></sup></li></ul>
<h2><span class="mw-headline" id="Tor_Consensus_Method">Tor Consensus Method</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a data-href="/w/index.php?title=Dev/TimeSync&amp;action=edit&amp;section=28" href="https://www.whonix.org/w/index.php?title=Dev/TimeSync&amp;action=edit&amp;section=28.html" title="Edit section: Tor Consensus Method">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<h5><span class="mw-headline" id="Introduction_2">Introduction</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a data-href="/w/index.php?title=Dev/TimeSync&amp;action=edit&amp;section=29" href="https://www.whonix.org/w/index.php?title=Dev/TimeSync&amp;action=edit&amp;section=29.html" title="Edit section: Introduction">edit</a><span class="mw-editsection-bracket">]</span></span></h5>
<p><b>Just an idea. Not implemented.</b>
</p><p>Tails' <a class="external text" data-href="https://git-tails.immerda.ch/tails/plain/config/chroot_local-includes/etc/NetworkManager/dispatcher.d/20-time.sh" href="https://git-tails.immerda.ch/tails/plain/config/chroot_local-includes/etc/NetworkManager/dispatcher.d/20-time.sh" rel="noreferrer noopener" target="_blank"><i><span style="background-color:#FBFBFB">tordate</span></i></a> (<a class="external text" data-href="https://tails.boum.org/contribute/design/Time_syncing/#index3h1" href="https://tails.boum.org/contribute/design/Time_syncing/" rel="noreferrer noopener" target="_blank">Guessing time based on Tor consensus</a>), renamed to <i><span style="background-color:#FBFBFB"><a data-href="/wiki/Anondate" href="./Anondate.html" title="Anondate">anondate</a></span></i> for trademark reasons and refactored to work outside of Tails provides useful bash functions to check system clock using Tor's consensus file and Tor's log.
</p><p><a class="external free" data-href="https://github.com/Whonix/anon-shared-helper-scripts/blob/master/usr/lib/anon-shared-helper-scripts/anondate" href="https://github.com/Whonix/anon-shared-helper-scripts/blob/master/usr/lib/anon-shared-helper-scripts/anondate" rel="noreferrer noopener" target="_blank">https://github.com/Whonix/anon-shared-helper-scripts/blob/master/usr/lib/anon-shared-helper-scripts/anondate</a>
</p><p>Tor connects to the network. The Tor consensus file contains rough time information. Since when and until when it is valid.
</p><p><i><span style="background-color:#FBFBFB">tordate</span></i> (now <i><span style="background-color:#FBFBFB">anondate</span></i>) can provide us with a few machine readable infos we can then use for whatever we may need them.
</p><p>This is magic.
</p>
<pre>valid-after=2014-07-31 21:00:00
valid-until=2014-08-01 00:00:00
</pre>
<p>This is simply <i><span style="background-color:#FBFBFB">/bin/date</span></i>.
</p>
<pre>Current time is 2014-07-31 22:44:02
</pre>
<p>Less magic.
</p>
<pre>Current time is in valid Tor range
</pre>
<p>Less magic, but maybe useful.
</p>
<pre>Current time is not in valid Tor range, setting to middle of this range: [2014-07-31 22:30:00]
</pre>
<p><i><span style="background-color:#FBFBFB">anondate</span></i> can do this by parsing Tor's verified consensus file <i><span style="background-color:#FBFBFB">/var/lib/cached-microdesc-consensus</span></i> or by parsing <i><span style="background-color:#FBFBFB">/var/lib/tor/unverified-microdesc-consensus</span></i>.
</p>
<h5><span class="mw-headline" id="Open_Questions">Open Questions</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a data-href="/w/index.php?title=Dev/TimeSync&amp;action=edit&amp;section=30" href="https://www.whonix.org/w/index.php?title=Dev/TimeSync&amp;action=edit&amp;section=30.html" title="Edit section: Open Questions">edit</a><span class="mw-editsection-bracket">]</span></span></h5>
<h6><span id="Under_which_conditions_Tor_is_not_able_to_verify_the_Tor_consensus_file?"></span><span class="mw-headline" id="Under_which_conditions_Tor_is_not_able_to_verify_the_Tor_consensus_file.3F">Under which conditions Tor is not able to verify the Tor consensus file?</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a data-href="/w/index.php?title=Dev/TimeSync&amp;action=edit&amp;section=31" href="https://www.whonix.org/w/index.php?title=Dev/TimeSync&amp;action=edit&amp;section=31.html" title="Edit section: Under which conditions Tor is not able to verify the Tor consensus file?">edit</a><span class="mw-editsection-bracket">]</span></span></h6>
<p>1) If it has been tampered with by a man-in-the-middle.
</p><p>2) For clocks that are more than 30 days in the past or 2 days in the future, Tor will not even be able to download a consensus. In this case anondate can parse Tor's log and report the authority's cert's valid-after date. <sup class="reference" id="cite_ref-37"><a href="#cite_note-37">[37]</a></sup>
</p>
<pre>anondate --tor-cert-valid-after
</pre>
<pre>Jun 16 00:00:00 2014 GMT
</pre>
<p>Is the authority's cert's valid-after date signed/verified/built-into-Tor or can it be tampered with by a man-in-the-middle attack?
</p><p>3) Anything else?
</p>
<h6><span class="mw-headline" id="Other_Questions">Other Questions</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a data-href="/w/index.php?title=Dev/TimeSync&amp;action=edit&amp;section=32" href="https://www.whonix.org/w/index.php?title=Dev/TimeSync&amp;action=edit&amp;section=32.html" title="Edit section: Other Questions">edit</a><span class="mw-editsection-bracket">]</span></span></h6>
<ul><li>When can anondate set time from verified and when only from unverified consensus file?</li>
<li>How reliable is it to do something as non-standard, unintended, inventive such as parsing Tor's consensus and Tor's log?</li>
<li>When clock is more than 1 hour in past or more than 3 hour in future, Tor will be unable to establish circuits? <sup class="reference" id="cite_ref-38"><a href="#cite_note-38">[38]</a></sup></li>
<li>How accurate has the clock to be so onion services can be accessed? See: <a class="external free" data-href="https://trac.torproject.org/projects/tor/ticket/3460" href="https://trac.torproject.org/projects/tor/ticket/3460" rel="noreferrer noopener" target="_blank">https://trac.torproject.org/projects/tor/ticket/3460</a></li></ul>
<h5><span class="mw-headline" id="Reasons_for_relying_solely_on_anondate_for_time_setting">Reasons for relying solely on anondate for time setting</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a data-href="/w/index.php?title=Dev/TimeSync&amp;action=edit&amp;section=33" href="https://www.whonix.org/w/index.php?title=Dev/TimeSync&amp;action=edit&amp;section=33.html" title="Edit section: Reasons for relying solely on anondate for time setting">edit</a><span class="mw-editsection-bracket">]</span></span></h5>
<ul><li>Does not require <a class="external text" data-href="https://github.com/Whonix/Whonix/issues/24" href="https://github.com/Whonix/Whonix/issues/24" rel="noreferrer noopener" target="_blank">ssl certificate pinning</a>.</li>
<li>Does not rely on remote web servers.</li>
<li>Does not require a somewhat accurate clock as <a href="#Remote_Web_Servers_Method">#Remote Web Servers Method</a> requires to get a rough time guess.</li></ul>
<h5><span class="mw-headline" id="Reasons_against_relying_solely_on_anondate_for_time_setting">Reasons against relying solely on anondate for time setting</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a data-href="/w/index.php?title=Dev/TimeSync&amp;action=edit&amp;section=34" href="https://www.whonix.org/w/index.php?title=Dev/TimeSync&amp;action=edit&amp;section=34.html" title="Edit section: Reasons against relying solely on anondate for time setting">edit</a><span class="mw-editsection-bracket">]</span></span></h5>
<ul><li>Provides only rough time.
<ul><li><a data-href="/wiki/Fingerprint#For_the_websites_that_you_are_visiting" href="./Fingerprint.html" title="Fingerprint">web fingerprint</a> would differ from most other Tor users.</li>
<li>Would cause lots of support requests complaining about skewed clocks.</li>
<li>Might trouble onion services (such as hidden web servers) that need to show time to clients?</li>
<li>Might trouble people attempting to <a data-href="/wiki/I2P" href="./I2P.html" title="I2P">tunnel I2P through Tor</a>?</li>
<li>Might cause other (gpg) verification issues?</li></ul></li>
<li>Fingerprinting issues at ISP level:
<ul><li>In situation, where the clock is that much off, that Tor cannot establish circuits, setting time using anondate required, restart of Tor required:
<ul><li>As per <a data-href="/wiki/Comparison_with_Others#Fingerprint" href="./Comparison_with_Others.html" title="Comparison with Others">Comparison with Others#Fingerprint</a>, quoted from the <a class="external text" data-href="https://tails.boum.org/contribute/design/Time_syncing/#index5h1" href="https://tails.boum.org/contribute/design/Time_syncing/" rel="noreferrer noopener" target="_blank">Tails Design about Time syncing</a>: "Our initial time guess based on the Tor consensus is probably easier to fingerprint, though: a fresh Tor is started, and restarted again right after the consensus has been downloaded."</li>
<li>Related: <a data-href="/wiki/Comparison_with_Others#Network_Time_related" href="./Comparison_with_Others.html" title="Comparison with Others">Comparison with Others#Network Time related</a></li></ul></li></ul></li>
<li><s>Hidden services can only be accessed if the clock is no more than 30 minutes slow or fast. <sup class="reference" id="cite_ref-39"><a href="#cite_note-39">[39]</a></sup></s></li>
<li><a class="external text" data-href="https://labs.riseup.net/code/issues/5774" href="https://labs.riseup.net/code/issues/5774" rel="noreferrer noopener" target="_blank">Tails ticket: Robust time syncing</a> Quote: <blockquote><p>Currently we use tordate to set the initial clock. It is very messy and error prone, so we desperately need a robust replacement.</p></blockquote></li>
<li>Vulnerable to ISP level man-in-the-middle attacks:
<ul><li><a class="external text" data-href="https://tails.boum.org/contribute/design/Time_syncing/" href="https://tails.boum.org/contribute/design/Time_syncing/" rel="noreferrer noopener" target="_blank">Tails Design: Time Syncing</a> Quote: <blockquote><p>First, replaying a consensus older than one week or so results in preventing access to the Tor network, and that's all, because onion keys will be wrong.</p></blockquote>
<ul><li>In a situation where an adversary is replaying a more than ~7 days old consensus:
<ul><li>anondate could report a clock that is more than ~7 days slow. With a system clock that is that slow, Tor would no longer be able to establish circuits. But there are multiple reasons why Tor may not be able to establish circuits. So anondate could only guess, that the clock reported in Tor consensus is more than ~7 days slow, but not know with certainty.</li></ul></li>
<li>In a situation where an adversary is replaying an up to ~7 days old consensus:
<ul><li>anondate could report a clock that is up to ~7 days slow and Tor would still be able to create circuits.</li>
<li>With Tor as is at the moment, anondate cannot even in principle provide a more accurate time guess than a clock that is up to ~7 days slow.</li>
<li>Using an up to ~7 days old consensus, is most likely something we really should avoid?</li></ul></li></ul></li>
<li>Therefore vulnerable to Attack 3 as per <a href="#Attacks">#Attacks</a>.</li></ul></li></ul>
<h5><span class="mw-headline" id="Conclusions_2">Conclusions</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a data-href="/w/index.php?title=Dev/TimeSync&amp;action=edit&amp;section=35" href="https://www.whonix.org/w/index.php?title=Dev/TimeSync&amp;action=edit&amp;section=35.html" title="Edit section: Conclusions">edit</a><span class="mw-editsection-bracket">]</span></span></h5>
<ul><li>Relying solely on anondate for time setting is probably a bad idea.</li>
<li>Tor consensus time is used as an  <a class="external text" data-href="https://phabricator.whonix.org/T151" href="https://phabricator.whonix.org/T151" rel="noreferrer noopener" target="_blank">sdwdate Tor Consensus Time Sanity Check</a>. (Whonix 14 and above)</li>
<li>Rough time fix.
<ul><li>Only for users that do not care about being temporarily <a data-href="/wiki/Fingerprint" href="./Fingerprint.html" title="Fingerprint">fingerprinted</a>! This needs proper documentation.</li>
<li>If clock is too much off so sdwdate cannot fix it, use anondate to get a rough time fix, then let sdwdate do the rest.</li></ul></li></ul>
<h5><span id="Why_not_use_tordate_by_Tails_instead_of_reinventing_the_wheel_with_anondate?"></span><span class="mw-headline" id="Why_not_use_tordate_by_Tails_instead_of_reinventing_the_wheel_with_anondate.3F">Why not use tordate by Tails instead of reinventing the wheel with anondate?</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a data-href="/w/index.php?title=Dev/TimeSync&amp;action=edit&amp;section=36" href="https://www.whonix.org/w/index.php?title=Dev/TimeSync&amp;action=edit&amp;section=36.html" title="Edit section: Why not use tordate by Tails instead of reinventing the wheel with anondate?">edit</a><span class="mw-editsection-bracket">]</span></span></h5>
<ul><li>Because Tails code is highly Tails specific.
<ul><li>Depending on non-persistent Tor data dir.</li>
<li>Entangled with Tails specific gui notifications.</li>
<li>Entangled into the Tails specific boot process with other scripts.</li>
<li>Not a clean abstraction of "tell me what Tor's log / Tor's consensus thinks about date/time".</li>
<li>Quote: "Currently we use tordate to set the initial clock. It is very messy and error prone, so we desperately need a robust replacement." <sup class="reference" id="cite_ref-40"><a href="#cite_note-40">[40]</a></sup></li></ul></li></ul>
<h5><span class="mw-headline" id="Random_Stuff">Random Stuff</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a data-href="/w/index.php?title=Dev/TimeSync&amp;action=edit&amp;section=37" href="https://www.whonix.org/w/index.php?title=Dev/TimeSync&amp;action=edit&amp;section=37.html" title="Edit section: Random Stuff">edit</a><span class="mw-editsection-bracket">]</span></span></h5>
<ul><li><a class="external text" data-href="https://mailman.boum.org/pipermail/tails-dev/2012-January/000822.html" href="https://mailman.boum.org/pipermail/tails-dev/2012-January/000822.html" rel="noreferrer noopener" target="_blank">tails-dev mailing list: tordate: why is it safe to set time from unverified-consensus?</a>
<ul><li>String parsing a unverified consensus using anondate is more risky [hitting hypothetical vulnerabilities in grep] than string parsing a verified Tor consensus.</li></ul></li>
<li>Tor consensus is in some cases downloaded from Tor directory authorities and in some cases from Tor directory mirrors. The latter should not be trusted as much as the former.</li>
<li>We ought to not download the Tor consensus exclusively from Tor directory authorities. Source: <sup class="reference" id="cite_ref-41"><a href="#cite_note-41">[41]</a></sup> <blockquote><p>&lt;armadev&gt; oh. i think that would be horrible. hundreds of thousands of users doing that could overwhelm the directory authorities.</p></blockquote></li></ul>
<h5><span class="mw-headline" id="Status_of_this_idea">Status of this idea</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a data-href="/w/index.php?title=Dev/TimeSync&amp;action=edit&amp;section=38" href="https://www.whonix.org/w/index.php?title=Dev/TimeSync&amp;action=edit&amp;section=38.html" title="Edit section: Status of this idea">edit</a><span class="mw-editsection-bracket">]</span></span></h5>
<ul><li>Needs more research.</li>
<li>A simple command line tool that can parse Tor's consensus and Tor's log as been implemented: <a href="#anondate">#anondate</a></li>
<li>Perhaps relying solely on anondate for time setting could be implemented as an alternative <a data-href="/wiki/Dev/TimeSync#Time_Fetching_Methods" href="./Dev/TimeSync.html" title="Dev/TimeSync">Time Fetching Method</a> into sdwdate and be available as an option (disabled by default in Whonix).</li></ul>
<h1><span class="mw-headline" id="Debugging">Debugging</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a data-href="/w/index.php?title=Dev/TimeSync&amp;action=edit&amp;section=39" href="https://www.whonix.org/w/index.php?title=Dev/TimeSync&amp;action=edit&amp;section=39.html" title="Edit section: Debugging">edit</a><span class="mw-editsection-bracket">]</span></span></h1>
<p>Useful to run in Qubes dom0.
</p>
<pre>qvm-run --pass-io sys-whonix "date -u"Â ; date -u
</pre>
<h1><span class="mw-headline" id="See_Also">See Also</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a data-href="/w/index.php?title=Dev/TimeSync&amp;action=edit&amp;section=40" href="https://www.whonix.org/w/index.php?title=Dev/TimeSync&amp;action=edit&amp;section=40.html" title="Edit section: See Also">edit</a><span class="mw-editsection-bracket">]</span></span></h1>
<h2><span class="mw-headline" id="Other">Other</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a data-href="/w/index.php?title=Dev/TimeSync&amp;action=edit&amp;section=41" href="https://www.whonix.org/w/index.php?title=Dev/TimeSync&amp;action=edit&amp;section=41.html" title="Edit section: Other">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<ul><li><a class="external text" data-href="http://curl.haxx.se/docs/security.html" href="http://curl.haxx.se/docs/security.html" rel="noreferrer noopener" target="_blank">List to keep track of curl advisories from the official website. Their descriptions are non-cryptic.</a></li>
<li><a data-href="/wiki/Time_Attacks" href="./Time_Attacks.html" title="Time Attacks">Time Attacks</a></li>
<li><a data-href="/wiki/Sdwdate" href="./Sdwdate.html" title="Sdwdate">sdwdate - Secure Distribiuted Web Date - Homepage</a></li></ul>
<h2><span class="mw-headline" id="Previous_Discussion">Previous Discussion</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a data-href="/w/index.php?title=Dev/TimeSync&amp;action=edit&amp;section=42" href="https://www.whonix.org/w/index.php?title=Dev/TimeSync&amp;action=edit&amp;section=42.html" title="Edit section: Previous Discussion">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<ul><li><a class="external text" data-href="https://lists.torproject.org/pipermail/tor-talk/2011-January/008551.html" href="https://lists.torproject.org/pipermail/tor-talk/2011-January/008551.html" rel="noreferrer noopener" target="_blank">System time in anonymity oriented LiveCDs</a></li>
<li><a class="external text" data-href="https://mailman.boum.org/pipermail/tails-dev/2014-August/006821.html" href="https://mailman.boum.org/pipermail/tails-dev/2014-August/006821.html" rel="noreferrer noopener" target="_blank">Tails-dev mailing list - Tails htpdate - why use time information from neutral and foe pools?</a></li>
<li><a class="external text" data-href="https://mailman.boum.org/pipermail/tails-dev/2013-February/002635.html" href="https://mailman.boum.org/pipermail/tails-dev/2013-February/002635.html" rel="noreferrer noopener" target="_blank">Tails-dev Endless Data Attack and Defense</a></li></ul>
<h2><span class="mw-headline" id="Other_Projects">Other Projects</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a data-href="/w/index.php?title=Dev/TimeSync&amp;action=edit&amp;section=43" href="https://www.whonix.org/w/index.php?title=Dev/TimeSync&amp;action=edit&amp;section=43.html" title="Edit section: Other Projects">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<ul><li><a class="external text" data-href="https://tails.boum.org/contribute/design/Time_syncing/" href="https://tails.boum.org/contribute/design/Time_syncing/" rel="noreferrer noopener" target="_blank">Tails Design: Time syncing</a></li>
<li><a class="external free" data-href="https://docs.google.com/a/chromium.org/document/d/1ylaCHabUIHoKRJQWhBxqQ5Vck270fX7XCWBdiJofHbU/edit" href="https://docs.google.com/a/chromium.org/document/d/1ylaCHabUIHoKRJQWhBxqQ5Vck270fX7XCWBdiJofHbU/edit" rel="noreferrer noopener" target="_blank">https://docs.google.com/a/chromium.org/document/d/1ylaCHabUIHoKRJQWhBxqQ5Vck270fX7XCWBdiJofHbU/edit</a></li></ul>
<h2><span class="mw-headline" id="Comparison_with_Others">Comparison with Others</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a data-href="/w/index.php?title=Dev/TimeSync&amp;action=edit&amp;section=44" href="https://www.whonix.org/w/index.php?title=Dev/TimeSync&amp;action=edit&amp;section=44.html" title="Edit section: Comparison with Others">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p><a data-href="/wiki/Comparison_with_Others#Network_Time_related" href="./Comparison_with_Others.html" title="Comparison with Others">Network Time related</a>
</p>
<h2><span class="mw-headline" id="Tickets">Tickets</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a data-href="/w/index.php?title=Dev/TimeSync&amp;action=edit&amp;section=45" href="https://www.whonix.org/w/index.php?title=Dev/TimeSync&amp;action=edit&amp;section=45.html" title="Edit section: Tickets">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<h3><span class="mw-headline" id="Qubes">Qubes</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a data-href="/w/index.php?title=Dev/TimeSync&amp;action=edit&amp;section=46" href="https://www.whonix.org/w/index.php?title=Dev/TimeSync&amp;action=edit&amp;section=46.html" title="Edit section: Qubes">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<h4><span class="mw-headline" id="high_priority">high priority</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a data-href="/w/index.php?title=Dev/TimeSync&amp;action=edit&amp;section=47" href="https://www.whonix.org/w/index.php?title=Dev/TimeSync&amp;action=edit&amp;section=47.html" title="Edit section: high priority">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<ul><li><a class="external text" data-href="https://phabricator.whonix.org/T389" href="https://phabricator.whonix.org/T389" rel="noreferrer noopener" target="_blank">make sure Qubes-Whonix has no access to clocksource=xen</a></li>
<li><a class="external text" data-href="https://phabricator.whonix.org/T397" href="https://phabricator.whonix.org/T397" rel="noreferrer noopener" target="_blank">prevent dom0 telling Qubes-Whonix VMs the time</a></li></ul>
<h4><span class="mw-headline" id="normal_priority">normal priority</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a data-href="/w/index.php?title=Dev/TimeSync&amp;action=edit&amp;section=48" href="https://www.whonix.org/w/index.php?title=Dev/TimeSync&amp;action=edit&amp;section=48.html" title="Edit section: normal priority">edit</a><span class="mw-editsection-bracket">]</span></span></h4>
<ul><li>document <a data-href="/wiki/Advanced_Security_Guide#Spoof_the_Initial_Virtual_Hardware_Clock_Offset" href="./Advanced_Security_Guide.html" title="Advanced Security Guide">Spoof the Initial Virtual Hardware Clock Offset</a> for <a data-href="/wiki/Advanced_Security_Guide#Qubes" href="./Advanced_Security_Guide.html" title="Advanced Security Guide">Qubes</a></li>
<li><a class="external text" data-href="https://phabricator.whonix.org/T387" href="https://phabricator.whonix.org/T387" rel="noreferrer noopener" target="_blank">Qubes-Whonix-Gateway as ClockVM</a></li></ul>
<h3><span class="mw-headline" id="others">others</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a data-href="/w/index.php?title=Dev/TimeSync&amp;action=edit&amp;section=49" href="https://www.whonix.org/w/index.php?title=Dev/TimeSync&amp;action=edit&amp;section=49.html" title="Edit section: others">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<ul><li><a class="external text" data-href="https://trac.torproject.org/projects/tor/ticket/6894" href="https://trac.torproject.org/projects/tor/ticket/6894" rel="noreferrer noopener" target="_blank">torproject.org #6894 answer network time requests</a></li>
<li><a class="external text" data-href="https://tails.boum.org/todo/robust_time_syncing/" href="https://tails.boum.org/todo/robust_time_syncing/" rel="noreferrer noopener" target="_blank">Tails Todo: robust time syncing</a></li>
<li><a class="external free" data-href="https://tails.boum.org/blueprint/robust_time_syncing/" href="https://tails.boum.org/blueprint/robust_time_syncing/" rel="noreferrer noopener" target="_blank">https://tails.boum.org/blueprint/robust_time_syncing/</a></li>
<li><a class="external text" data-href="https://tails.boum.org/todo/safer_tordate_parameters/" href="https://tails.boum.org/todo/safer_tordate_parameters/" rel="noreferrer noopener" target="_blank">Tails Todo: safer tordate parameters (always use tordate)</a></li>
<li><a class="external text" data-href="https://tails.boum.org/todo/bridge_mode_vs_tordate_timeouts/" href="https://tails.boum.org/todo/bridge_mode_vs_tordate_timeouts/" rel="noreferrer noopener" target="_blank">Tails Todo: bridge mode vs tordate timeouts</a></li>
<li><a class="external text" data-href="https://tails.boum.org/todo/when_htp_fails_the_user_should_be_prompted/" href="https://tails.boum.org/todo/when_htp_fails_the_user_should_be_prompted/" rel="noreferrer noopener" target="_blank">Tails Todo: when htp fails the user should be prompted</a></li>
<li><a class="external text" data-href="https://github.com/QubesOS/qubes-issues/issues/2342" href="https://github.com/QubesOS/qubes-issues/issues/2342" rel="noreferrer noopener" target="_blank">Qubes: secure time synchronization</a></li>
<li><a class="external text" data-href="https://trac.torproject.org/projects/tor/ticket/16659" href="https://trac.torproject.org/projects/tor/ticket/16659" rel="noreferrer noopener" target="_blank">Linux TCP Initial Sequence Numbers may aid correlation</a></li></ul>
<h2><span class="mw-headline" id="Clock_Correlation_Attack">Clock Correlation Attack</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a data-href="/w/index.php?title=Dev/TimeSync&amp;action=edit&amp;section=50" href="https://www.whonix.org/w/index.php?title=Dev/TimeSync&amp;action=edit&amp;section=50.html" title="Edit section: Clock Correlation Attack">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<h3><span class="mw-headline" id="Attack">Attack</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a data-href="/w/index.php?title=Dev/TimeSync&amp;action=edit&amp;section=51" href="https://www.whonix.org/w/index.php?title=Dev/TimeSync&amp;action=edit&amp;section=51.html" title="Edit section: Attack">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>prerequisite knowledge:
</p>
<ul><li>Whonix-Gateway [Proxy]VMs and Whonix-Workstation [App]VM's system time cannot not be obtained by watching traffic at ISP level.</li>
<li>This chapter is not about tracking a single VM across its different Tor exit relays.</li>
<li>The context is anonymity. The significance is deanonymization.</li>
<li>In anonymity we don't just care about about correlations. Also about estimations. Anonymity set reduction. Partitioning users is already a success. Because it may be combined with other guesses. No direct proof is required. From some countries, there are just a few 100 users or less. If there is already a lead by country, then combined with these time related issues, things begin to really matter.</li>
<li>clocksource 'xen' / 'kvmclock' doesn't prevent Whonix from using sdwdate.</li>
<li>clocksource 'xen' / 'kvmclock' doesn't prevent each VM having slightly different system time (used by all the applications), so no direct leaks here.</li>
<li>[host | dom0] host time and VM times a very, very similar. At most one second difference. Or less. In [host | dom0], see:</li></ul>
<pre>dateÂ ; qvm-run --pass-io sys-net date
</pre>
<p>Attack:
</p>
<ul><li>1) requires a) compromise a Whonix-Workstation VM and b) observing the ISP network the user is using</li>
<li>2) read [host | dom0] time using clocksource 'xen' / 'kvmclock' or possibly the wall clock interface</li>
<li>3) [host | dom0] time will be very similar to NetVM's time (the system where external network connections are made)</li>
<li>4) correlate Whonix-Workstation VM with NetVM's time</li>
<li>5) anonymity set reduction done</li></ul>
<p>Notes:
</p><p>No need to compromise multiple VMs. Only one VM, a Whonix-Workstation VM needs to be compromised. NetVM does not have to be compromised, it leaks in most cases - hard to avoid all cases - any passive ISP level adversary watching traffic can read the clients local clock. It is leaked on many levels, see <a href="#Local_Clock_Leaks">#Local Clock Leaks</a>.
</p><p>Threat Model:
</p>
<ul><li>Whonix-Workstation AppVM gets compromised up to local root code execution. Then the attacker uses the local exploit, reads clocksource 'xen' / 'kvmclock'.</li></ul>
<h3><span class="mw-headline" id="Defense">Defense</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a data-href="/w/index.php?title=Dev/TimeSync&amp;action=edit&amp;section=52" href="https://www.whonix.org/w/index.php?title=Dev/TimeSync&amp;action=edit&amp;section=52.html" title="Edit section: Defense">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>We need to make sure that all of Whonix-Gateway, Whonix-Workstation, and NetVM uses slightly different time. Even if Whonix-Workstation would be compromised, and the attacker gets knowledge of the time of [host | dom0] and sniffs NetVM's time, it would hinder correlation.
</p><p>[host | dom0] and non-anonymous VM's clocks should be as synced, correct and secure as those can be.
</p><p>But those should differ from the clocks within Whonix VMs.
</p><p>We need completely isolated virtual time within Whonix VMs. <sup class="reference" id="cite_ref-42"><a href="#cite_note-42">[42]</a></sup> <sup class="reference" id="cite_ref-43"><a href="#cite_note-43">[43]</a></sup>
</p>
<h3><span class="mw-headline" id="wallclock">wallclock</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a data-href="/w/index.php?title=Dev/TimeSync&amp;action=edit&amp;section=53" href="https://www.whonix.org/w/index.php?title=Dev/TimeSync&amp;action=edit&amp;section=53.html" title="Edit section: wallclock">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>&gt; The other interface ("wallclock interface") would provide such time, though. And it is not configurable. But not sure if it is used anywhere in Linux by default (probably besides initial system time set).
</p><p>Yes. Must be so. Otherwise with "ticks" alone the VM had no chance to figure out the current time. And this is a roblem, because we don't want the VM to know [host | dom0]'s time.
</p><p>We might be able to solve the wallclock [not pvclock] issue by <a data-href="/wiki/Advanced_Security_Guide#Spoof_the_Initial_Virtual_Hardware_Clock_Offset" href="./Advanced_Security_Guide.html" title="Advanced Security Guide">Spoofing the Initial Virtual Hardware Clock Offset</a>.
</p>
<h3><span class="mw-headline" id="Development">Development</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a data-href="/w/index.php?title=Dev/TimeSync&amp;action=edit&amp;section=54" href="https://www.whonix.org/w/index.php?title=Dev/TimeSync&amp;action=edit&amp;section=54.html" title="Edit section: Development">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<p>Rather than modifying [host | dom0]'s clock, we could perhaps spoof the initial virtual hardware clock offset. It is possible for KVM, as per: <a class="external free" data-href="https://libvirt.org/formatdomain.html#elementsTime" href="https://libvirt.org/formatdomain.html" rel="noreferrer noopener" target="_blank">https://libvirt.org/formatdomain.html#elementsTime</a>
</p><p>Something like this:
</p>
<pre>&lt;clock offset='variable' adjustment='123456' basis='utc'&gt;
</pre>
<p>Reading clocksource xen as a [root] user is not easily possible.
source: <a class="external free" data-href="http://lists.xen.org/archives/html/xen-users/2015-08/msg00020.html" href="http://lists.xen.org/archives/html/xen-users/2015-08/msg00020.html" rel="noreferrer noopener" target="_blank">http://lists.xen.org/archives/html/xen-users/2015-08/msg00020.html</a>
</p><p>Would probably require writing a kernel module.
</p>
<ul><li><a class="external text" data-href="https://phabricator.whonix.org/T440" href="https://phabricator.whonix.org/T440" rel="noreferrer noopener" target="_blank">set random clock offset for Qubes-Whonix VMs using mgmt to prevent clock correlation attacks</a></li>
<li><a class="external text" data-href="https://phabricator.whonix.org/T389" href="https://phabricator.whonix.org/T389" rel="noreferrer noopener" target="_blank">make sure Qubes-Whonix has no access to clocksource=xen</a></li>
<li><a class="external free" data-href="https://groups.google.com/forum/#!topic/qubes-devel/aN3IOv6JmKw" href="https://groups.google.com/forum/" rel="noreferrer noopener" target="_blank">https://groups.google.com/forum/#!topic/qubes-devel/aN3IOv6JmKw</a></li></ul>
<h3><span class="mw-headline" id="Sources">Sources</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a data-href="/w/index.php?title=Dev/TimeSync&amp;action=edit&amp;section=55" href="https://www.whonix.org/w/index.php?title=Dev/TimeSync&amp;action=edit&amp;section=55.html" title="Edit section: Sources">edit</a><span class="mw-editsection-bracket">]</span></span></h3>
<ul><li><a class="external free" data-href="https://groups.google.com/forum/#!topic/qubes-devel/aN3IOv6JmKw" href="https://groups.google.com/forum/" rel="noreferrer noopener" target="_blank">https://groups.google.com/forum/#!topic/qubes-devel/aN3IOv6JmKw</a></li>
<li>Document with general information on various clock interfaces.
<ul><li>Not very specific to kvm.</li>
<li>PIT, RTC, APIC, HPET, Offboard Timers, TSC</li>
<li><a class="external free" data-href="https://www.kernel.org/doc/Documentation/virtual/kvm/timekeeping.txt" href="https://www.kernel.org/doc/Documentation/virtual/kvm/timekeeping.txt" rel="noreferrer noopener" target="_blank">https://www.kernel.org/doc/Documentation/virtual/kvm/timekeeping.txt</a></li></ul></li></ul>
<h2><span class="mw-headline" id="TSC">TSC</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a data-href="/w/index.php?title=Dev/TimeSync&amp;action=edit&amp;section=56" href="https://www.whonix.org/w/index.php?title=Dev/TimeSync&amp;action=edit&amp;section=56.html" title="Edit section: TSC">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>Needs more research.
</p><p>Why we should avoid leaking TSC from the host go the VM.
</p><p>Leaking anything related to time from the host into the VM [or from VM to VM] risks cryptographic side channel attacks and should therefore be avoided.
</p><p>Search term:<br/>
time stamp counter tsc side channel
</p><p>Leads to:<br/>
<a class="external free" data-href="http://blog.cr0.org/2009/05/time-stamp-counter-disabling-oddities.html" href="http://blog.cr0.org/2009/05/time-stamp-counter-disabling-oddities.html" rel="noreferrer noopener" target="_blank">http://blog.cr0.org/2009/05/time-stamp-counter-disabling-oddities.html</a>
</p><p>TSC leaks may be similar to TCP sequence numbers. <sup class="reference" id="cite_ref-44"><a href="#cite_note-44">[44]</a></sup>
</p>
<h2><span class="mw-headline" id="clocksource_xen">clocksource xen</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a data-href="/w/index.php?title=Dev/TimeSync&amp;action=edit&amp;section=57" href="https://www.whonix.org/w/index.php?title=Dev/TimeSync&amp;action=edit&amp;section=57.html" title="Edit section: clocksource xen">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p><a class="external free" data-href="https://github.com/QubesOS/qubes-issues/issues/1764#issuecomment-195619793" href="https://github.com/QubesOS/qubes-issues/issues/1764" rel="noreferrer noopener" target="_blank">https://github.com/QubesOS/qubes-issues/issues/1764#issuecomment-195619793</a>
</p>
<h2><span class="mw-headline" id="Resources">Resources</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a data-href="/w/index.php?title=Dev/TimeSync&amp;action=edit&amp;section=58" href="https://www.whonix.org/w/index.php?title=Dev/TimeSync&amp;action=edit&amp;section=58.html" title="Edit section: Resources">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<ul><li><a class="external text" data-href="https://software.intel.com/en-us/blogs/2013/06/20/eliminate-the-dreaded-clocksource-is-unstable-message-switch-to-tsc-for-a-stable" href="https://software.intel.com/en-us/blogs/2013/06/20/eliminate-the-dreaded-clocksource-is-unstable-message-switch-to-tsc-for-a-stable" rel="noreferrer noopener" target="_blank">General information on various clock sources such as tsc etc. by intel</a></li></ul>
<h2><span class="mw-headline" id="Footnotes">Footnotes</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a data-href="/w/index.php?title=Dev/TimeSync&amp;action=edit&amp;section=59" href="https://www.whonix.org/w/index.php?title=Dev/TimeSync&amp;action=edit&amp;section=59.html" title="Edit section: Footnotes">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<div class="reflist" style="list-style-type: decimal;">
<div class="mw-references-wrap mw-references-columns"><ol class="references">
<li id="cite_note-1"><span class="mw-cite-backlink"><a href="#cite_ref-1">â</a></span> <span class="reference-text">Replay old Tor consensus, see <a class="external text" data-href="https://tails.boum.org/contribute/design/Time_syncing/" href="https://tails.boum.org/contribute/design/Time_syncing/" rel="noreferrer noopener" target="_blank">Tails: Time syncing</a> for detailed explanation.</span>
</li>
<li id="cite_note-2"><span class="mw-cite-backlink"><a href="#cite_ref-2">â</a></span> <span class="reference-text">Cryptographic verification depends on system clock, i.e. a clock two years in past will accept certificates/updates, which have been expired/revoked for two years.</span>
</li>
<li id="cite_note-3"><span class="mw-cite-backlink"><a href="#cite_ref-3">â</a></span> <span class="reference-text"><a href="#Local_Clock_Leaks">#Local Clock Leaks</a> are an issue. Imagine the user connects to an adversary controlled web-server with Mozilla Firefox and connects to another web-server controlled by the same adversary with Thunderbird. The adversary can link the anonymous and non-anonymous session, thus deanonymizing.</span>
</li>
<li id="cite_note-4"><span class="mw-cite-backlink"><a href="#cite_ref-4">â</a></span> <span class="reference-text">If the clock is too much off, it is also easy for an adversary's web-server to detect "Oh, that's the Tor Browser user who's clock is X in past/future.", thus allowing the adversary to link all sessions to the same pseudonym. See Tor Browser upstream bug #3059: <a class="external text" data-href="https://trac.torproject.org/projects/tor/ticket/3059" href="https://trac.torproject.org/projects/tor/ticket/3059" rel="noreferrer noopener" target="_blank">Find some way to deal with time-based fingerprints</a>.</span>
</li>
<li id="cite_note-5"><span class="mw-cite-backlink"><a href="#cite_ref-5">â</a></span> <span class="reference-text">
For onion services a correct clock is crucial, see:
<ul><li><a class="external text" data-href="http://www.cl.cam.ac.uk/~sjm217/papers/ccs06hotornot.pdf" href="http://www.cl.cam.ac.uk/~sjm217/papers/ccs06hotornot.pdf" rel="noreferrer noopener" target="_blank">Hot or Not: Revealing Hidden Services by their Clock Skew</a></li>
<li><a class="external text" data-href="http://caia.swin.edu.au/talks/CAIA-TALK-080728A.pdf" href="http://caia.swin.edu.au/talks/CAIA-TALK-080728A.pdf" rel="noreferrer noopener" target="_blank">An improved clock-skew measurement technique for revealing hidden services</a></li>
<li><a class="external text" data-href="http://people.cs.umass.edu/~elisha/Papers/SkewMask%20-%20final%20version.pdf" href="http://people.cs.umass.edu/~elisha/Papers/SkewMask%20-%20final%20version.pdf" rel="noreferrer noopener" target="_blank">SkewMask: Frustrating Clock Skew Fingerprinting Attempts</a></li>
<li><a class="external text" data-href="http://www.caida.org/publications/papers/2005/fingerprinting/" href="http://www.caida.org/publications/papers/2005/fingerprinting/" rel="noreferrer noopener" target="_blank">Remote physical device fingerprinting</a></li></ul>
</span></li>
<li id="cite_note-6"><span class="mw-cite-backlink"><a href="#cite_ref-6">â</a></span> <span class="reference-text">Developer information: If we needed or wanted to render the hardware clock unusable, we could set VirtualBox <i>--biossystemtimeoffset</i> several decades in past or future.</span>
</li>
<li id="cite_note-7"><span class="mw-cite-backlink"><a href="#cite_ref-7">â</a></span> <span class="reference-text">Stream isolation has been added, for Whonix's sdwdate implementation i.e. people using Tor Browser prevent notifying their exit relay, that they are sdwdate or Whonix users.</span>
</li>
<li id="cite_note-8"><span class="mw-cite-backlink"><a href="#cite_ref-8">â</a></span> <span class="reference-text">
Check.
<pre>grep -i "Made up" /var/log/sdwdate.log
</pre></span>
</li>
<li id="cite_note-9"><span class="mw-cite-backlink"><a href="#cite_ref-9">â</a></span> <span class="reference-text"><a class="external free" data-href="https://lists.torproject.org/pipermail/tor-talk/2012-February/023264.html" href="https://lists.torproject.org/pipermail/tor-talk/2012-February/023264.html" rel="noreferrer noopener" target="_blank">https://lists.torproject.org/pipermail/tor-talk/2012-February/023264.html</a></span>
</li>
<li id="cite_note-10"><span class="mw-cite-backlink"><a href="#cite_ref-10">â</a></span> <span class="reference-text">General Tor problems, Tor is known to be broken against many active attacks. This can not be solved by Whonix. When an adversary is capable of running active attacks, tampering with the time leading into a denial of service is the least of the worries. The adversary could also disrupt the service easier. And as for active attacking in general, there are other attacks which are easier to deploy and which pose a greater danger. Not a Whonix specific problem.</span>
</li>
<li id="cite_note-11"><span class="mw-cite-backlink"><a href="#cite_ref-11">â</a></span> <span class="reference-text"><a class="external free" data-href="https://trac.torproject.org/projects/tor/ticket/3582#comment:3" href="https://trac.torproject.org/projects/tor/ticket/3582" rel="noreferrer noopener" target="_blank">https://trac.torproject.org/projects/tor/ticket/3582#comment:3</a></span>
</li>
<li id="cite_note-12"><span class="mw-cite-backlink"><a href="#cite_ref-12">â</a></span> <span class="reference-text"><a class="external free" data-href="http://lists.ntp.org/pipermail/questions/2010-November/028033.html" href="http://lists.ntp.org/pipermail/questions/2010-November/028033.html" rel="noreferrer noopener" target="_blank">http://lists.ntp.org/pipermail/questions/2010-November/028033.html</a></span>
</li>
<li id="cite_note-13"><span class="mw-cite-backlink"><a href="#cite_ref-13">â</a></span> <span class="reference-text"><a class="external free" data-href="https://labs.riseup.net/code/issues/6113" href="https://labs.riseup.net/code/issues/6113" rel="noreferrer noopener" target="_blank">https://labs.riseup.net/code/issues/6113</a></span>
</li>
<li id="cite_note-ntp-rfc-14"><span class="mw-cite-backlink">â <sup><a href="#cite_ref-ntp-rfc_14-0">14.0</a></sup> <sup><a href="#cite_ref-ntp-rfc_14-1">14.1</a></sup></span> <span class="reference-text">
Source: <a class="external text" data-href="https://www.ietf.org/rfc/rfc5905.txt" href="https://www.ietf.org/rfc/rfc5905.txt" rel="noreferrer noopener" target="_blank">RFC5905</a>
<blockquote>
<p>Origin Timestamp (org): Time at the client when the request departed
for the server, in NTP timestamp format.
</p>
</blockquote></span>
</li>
<li id="cite_note-ntp-se-15"><span class="mw-cite-backlink">â <sup><a href="#cite_ref-ntp-se_15-0">15.0</a></sup> <sup><a href="#cite_ref-ntp-se_15-1">15.1</a></sup></span> <span class="reference-text">
Credits: Thanks to <a class="external text" data-href="https://security.stackexchange.com/users/4564/dfc" href="https://security.stackexchange.com/users/4564/dfc" rel="noreferrer noopener" target="_blank">dfc</a> for <a class="external text" data-href="http://security.stackexchange.com/a/67142/54240" href="http://security.stackexchange.com/a/67142/54240" rel="noreferrer noopener" target="_blank">the answer on security.se</a>.</span>
</li>
<li id="cite_note-16"><span class="mw-cite-backlink"><a href="#cite_ref-16">â</a></span> <span class="reference-text"><a class="external free" data-href="http://www.webcitation.org/6ST27IXN6" href="http://www.webcitation.org/6ST27IXN6" rel="noreferrer noopener" target="_blank">http://www.webcitation.org/6ST27IXN6</a></span>
</li>
<li id="cite_note-17"><span class="mw-cite-backlink"><a href="#cite_ref-17">â</a></span> <span class="reference-text">60 s * 60 m * 24 h</span>
</li>
<li id="cite_note-18"><span class="mw-cite-backlink"><a href="#cite_ref-18">â</a></span> <span class="reference-text">As <i><span style="background-color:#FBFBFB">sdwdate</span></i> does.</span>
</li>
<li id="cite_note-19"><span class="mw-cite-backlink"><a href="#cite_ref-19">â</a></span> <span class="reference-text"><a class="external free" data-href="https://github.com/ioerror/tlsdate/issues/112" href="https://github.com/ioerror/tlsdate/issues/112" rel="noreferrer noopener" target="_blank">https://github.com/ioerror/tlsdate/issues/112</a></span>
</li>
<li id="cite_note-20"><span class="mw-cite-backlink"><a href="#cite_ref-20">â</a></span> <span class="reference-text"><a class="external free" data-href="https://github.com/ioerror/tlsdate/issues/143#issuecomment-57053323" href="https://github.com/ioerror/tlsdate/issues/143" rel="noreferrer noopener" target="_blank">https://github.com/ioerror/tlsdate/issues/143#issuecomment-57053323</a></span>
</li>
<li id="cite_note-21"><span class="mw-cite-backlink"><a href="#cite_ref-21">â</a></span> <span class="reference-text"><a class="external text" data-href="https://github.com/Whonix/sdwdate/blob/master/usr/lib/sclockadj" href="https://github.com/Whonix/sdwdate/blob/master/usr/lib/sclockadj" rel="noreferrer noopener" target="_blank">sclockadj</a></span>
</li>
<li id="cite_note-22"><span class="mw-cite-backlink"><a href="#cite_ref-22">â</a></span> <span class="reference-text">Because in most cases, there is little need to combine Tor onion services with SSL. <a data-href="/wiki/Onion_Services#Notes_about_End-to-end_security_of_Onion_Services" href="./Onion_Services.html" title="Onion Services">connections to Tor onion services are Tor-to-Tor encrypted by default ("not exactly end-to-end")</a>.</span>
</li>
<li id="cite_note-23"><span class="mw-cite-backlink"><a href="#cite_ref-23">â</a></span> <span class="reference-text"><a class="external free" data-href="https://github.com/ioerror/tlsdate/issues/157" href="https://github.com/ioerror/tlsdate/issues/157" rel="noreferrer noopener" target="_blank">https://github.com/ioerror/tlsdate/issues/157</a></span>
</li>
<li id="cite_note-24"><span class="mw-cite-backlink"><a href="#cite_ref-24">â</a></span> <span class="reference-text"><a class="external free" data-href="https://github.com/ioerror/tlsdate/issues/158" href="https://github.com/ioerror/tlsdate/issues/158" rel="noreferrer noopener" target="_blank">https://github.com/ioerror/tlsdate/issues/158</a></span>
</li>
<li id="cite_note-25"><span class="mw-cite-backlink"><a href="#cite_ref-25">â</a></span> <span class="reference-text"><a class="external free" data-href="https://tails.boum.org/contribute/design/Time_syncing/#index4h1" href="https://tails.boum.org/contribute/design/Time_syncing/" rel="noreferrer noopener" target="_blank">https://tails.boum.org/contribute/design/Time_syncing/#index4h1</a></span>
</li>
<li id="cite_note-26"><span class="mw-cite-backlink"><a href="#cite_ref-26">â</a></span> <span class="reference-text">
<ul><li><a class="external text" data-href="https://mailman.boum.org/pipermail/tails-dev/2014-September/007062.html" href="https://mailman.boum.org/pipermail/tails-dev/2014-September/007062.html" rel="noreferrer noopener" target="_blank">Tails-dev - TCP Sequence Numbers leak System Clock</a></li>
<li><a class="external text" data-href="https://trac.torproject.org/projects/tor/ticket/16659" href="https://trac.torproject.org/projects/tor/ticket/16659" rel="noreferrer noopener" target="_blank">Linux TCP Initial Sequence Numbers may aid correlation</a></li></ul>
</span></li>
<li id="cite_note-27"><span class="mw-cite-backlink"><a href="#cite_ref-27">â</a></span> <span class="reference-text">By distribution defaults.</span>
</li>
<li id="cite_note-28"><span class="mw-cite-backlink"><a href="#cite_ref-28">â</a></span> <span class="reference-text">Was <a class="external text" data-href="https://trac.torproject.org/projects/tor/ticket/3059" href="https://trac.torproject.org/projects/tor/ticket/3059" rel="noreferrer noopener" target="_blank">fixed</a> in Tor Browser, but remains open for other applications such as browsers like Mozilla Firefox.</span>
</li>
<li id="cite_note-29"><span class="mw-cite-backlink"><a href="#cite_ref-29">â</a></span> <span class="reference-text">See <a class="external free" data-href="http://ip-check.info" href="http://ip-check.info" rel="noreferrer noopener" target="_blank">http://ip-check.info</a> for demonstration.</span>
</li>
<li id="cite_note-30"><span class="mw-cite-backlink"><a href="#cite_ref-30">â</a></span> <span class="reference-text">As of June 2016, Iceweasel has been replaced by Firefox-ESR in Debian, see <a class="external free" data-href="https://wiki.debian.org/Iceweasel" href="https://wiki.debian.org/Iceweasel" rel="noreferrer noopener" target="_blank">https://wiki.debian.org/Iceweasel</a></span>
</li>
<li id="cite_note-31"><span class="mw-cite-backlink"><a href="#cite_ref-31">â</a></span> <span class="reference-text">
<a class="external text" data-href="https://trac.torproject.org/projects/tor/ticket/6315" href="https://trac.torproject.org/projects/tor/ticket/6315" rel="noreferrer noopener" target="_blank">prevent leak via Message-ID header field (local timestamp disclosure) </a></span>
</li>
<li id="cite_note-32"><span class="mw-cite-backlink"><a href="#cite_ref-32">â</a></span> <span class="reference-text">
<a class="external text" data-href="https://blog.torproject.org/blog/torbirdy-013-our-fourth-beta-release" href="https://blog.torproject.org/blog/torbirdy-013-our-fourth-beta-release" rel="noreferrer noopener" target="_blank">Quote, on October 24th, 2014 sukhbir said</a>:<br/>
"The timestamp disclosures are via the date and the message-ID headers (relevant tickets: <a class="external text" data-href="https://trac.torproject.org/projects/tor/ticket/6314" href="https://trac.torproject.org/projects/tor/ticket/6314" rel="noreferrer noopener" target="_blank">#6314</a>, <a class="external text" data-href="https://trac.torproject.org/projects/tor/ticket/6315" href="https://trac.torproject.org/projects/tor/ticket/6315" rel="noreferrer noopener" target="_blank">#6315</a>). We have submitted patches to Mozilla (<a class="external text" data-href="https://bugzilla.mozilla.org/show_bug.cgi?id=902573" href="https://bugzilla.mozilla.org/show_bug.cgi?id=902573" rel="noreferrer noopener" target="_blank">902573</a>, <a class="external text" data-href="https://bugzilla.mozilla.org/show_bug.cgi?id=902580" href="https://bugzilla.mozilla.org/show_bug.cgi?id=902580" rel="noreferrer noopener" target="_blank">902580</a>) that have not yet been merged. The patches probably need more work and we are looking for volunteers to work on them and help us to get them merged. We will be doing a blog post about this soon and put out a call for help."</span>
</li>
<li id="cite_note-example-wheezy-33"><span class="mw-cite-backlink">â <sup><a href="#cite_ref-example-wheezy_33-0">33.0</a></sup> <sup><a href="#cite_ref-example-wheezy_33-1">33.1</a></sup></span> <span class="reference-text">For example the one shipped by Debian wheezy.</span>
</li>
<li id="cite_note-34"><span class="mw-cite-backlink"><a href="#cite_ref-34">â</a></span> <span class="reference-text"><a class="external free" data-href="https://trac.torproject.org/projects/tor/ticket/8751" href="https://trac.torproject.org/projects/tor/ticket/8751" rel="noreferrer noopener" target="_blank">https://trac.torproject.org/projects/tor/ticket/8751</a></span>
</li>
<li id="cite_note-tlsleaktwo-35"><span class="mw-cite-backlink"><a href="#cite_ref-tlsleaktwo_35-0">â</a></span> <span class="reference-text">
See <a class="external text" data-href="https://trac.torproject.org/projects/tor/ticket/4852" href="https://trac.torproject.org/projects/tor/ticket/4852" rel="noreferrer noopener" target="_blank">torproject.org #4852: Clients send NETINFO with time</a>. The ticket says fixed. However, <a class="external text" data-href="https://packages.debian.org/de/wheezy/tor" href="https://packages.debian.org/de/wheezy/tor" rel="noreferrer noopener" target="_blank">Debian wheezy (which Whonix 10 was based on) was using Tor 0.2.3</a> but Nick's <a class="external text" data-href="https://trac.torproject.org/projects/tor/ticket/4852#comment:20" href="https://trac.torproject.org/projects/tor/ticket/4852" rel="noreferrer noopener" target="_blank">patch appeared first in 0.2.4</a>. It was solved in Whonix 11, because it was based on Debian jessie, that contained <a class="external text" data-href="https://packages.debian.org/de/jessie/tor" href="https://packages.debian.org/de/jessie/tor" rel="noreferrer noopener" target="_blank">a more recent version of Tor</a>.</span>
</li>
<li id="cite_note-36"><span class="mw-cite-backlink"><a href="#cite_ref-36">â</a></span> <span class="reference-text">
For demonstration, you could use.
<pre>curl -silent --head torproject.org | grep -i date:
</pre></span>
</li>
<li id="cite_note-37"><span class="mw-cite-backlink"><a href="#cite_ref-37">â</a></span> <span class="reference-text">
Source, source code comment in tordate: <a class="external free" data-href="https://git-tails.immerda.ch/tails/plain/config/chroot_local-includes/etc/NetworkManager/dispatcher.d/20-time.sh" href="https://git-tails.immerda.ch/tails/plain/config/chroot_local-includes/etc/NetworkManager/dispatcher.d/20-time.sh" rel="noreferrer noopener" target="_blank">https://git-tails.immerda.ch/tails/plain/config/chroot_local-includes/etc/NetworkManager/dispatcher.d/20-time.sh</a>
<pre>	# Since Tor 0.2.3.x Tor doesn't download a consensus for
	# clocks that are more than 30 days in the past or 2 days in
	# the future.  For such clock skews we set the time to the
	# authority's cert's valid-after date.
</pre></span>
</li>
<li id="cite_note-38"><span class="mw-cite-backlink"><a href="#cite_ref-38">â</a></span> <span class="reference-text"><a class="external free" data-href="https://lists.torproject.org/pipermail/tor-talk/2012-February/023264.html" href="https://lists.torproject.org/pipermail/tor-talk/2012-February/023264.html" rel="noreferrer noopener" target="_blank">https://lists.torproject.org/pipermail/tor-talk/2012-February/023264.html</a></span>
</li>
<li id="cite_note-39"><span class="mw-cite-backlink"><a href="#cite_ref-39">â</a></span> <span class="reference-text"><a class="external free" data-href="https://trac.torproject.org/projects/tor/ticket/3582#comment:3" href="https://trac.torproject.org/projects/tor/ticket/3582" rel="noreferrer noopener" target="_blank">https://trac.torproject.org/projects/tor/ticket/3582#comment:3</a></span>
</li>
<li id="cite_note-40"><span class="mw-cite-backlink"><a href="#cite_ref-40">â</a></span> <span class="reference-text"><a class="external free" data-href="https://labs.riseup.net/code/issues/5774" href="https://labs.riseup.net/code/issues/5774" rel="noreferrer noopener" target="_blank">https://labs.riseup.net/code/issues/5774</a></span>
</li>
<li id="cite_note-41"><span class="mw-cite-backlink"><a href="#cite_ref-41">â</a></span> <span class="reference-text"><a class="external free" data-href="https://forums.whonix.org/t/tor-dev-mailinglist-proposal/489/10" href="https://forums.whonix.org/t/tor-dev-mailinglist-proposal/489/10" rel="noreferrer noopener" target="_blank">https://forums.whonix.org/t/tor-dev-mailinglist-proposal/489/10</a></span>
</li>
<li id="cite_note-42"><span class="mw-cite-backlink"><a href="#cite_ref-42">â</a></span> <span class="reference-text">
<a class="external free" data-href="http://security.stackexchange.com/questions/106406/how-to-get-a-completely-isolated-virtual-time-using-xen" href="http://security.stackexchange.com/questions/106406/how-to-get-a-completely-isolated-virtual-time-using-xen" rel="noreferrer noopener" target="_blank">http://security.stackexchange.com/questions/106406/how-to-get-a-completely-isolated-virtual-time-using-xen</a></span>
</li>
<li id="cite_note-43"><span class="mw-cite-backlink"><a href="#cite_ref-43">â</a></span> <span class="reference-text">
<a class="external free" data-href="http://lists.xen.org/archives/html/xen-users/2015-11/msg00114.html" href="http://lists.xen.org/archives/html/xen-users/2015-11/msg00114.html" rel="noreferrer noopener" target="_blank">http://lists.xen.org/archives/html/xen-users/2015-11/msg00114.html</a></span>
</li>
<li id="cite_note-44"><span class="mw-cite-backlink"><a href="#cite_ref-44">â</a></span> <span class="reference-text"><a class="external free" data-href="https://trac.torproject.org/projects/tor/ticket/16659#comment:10" href="https://trac.torproject.org/projects/tor/ticket/16659" rel="noreferrer noopener" target="_blank">https://trac.torproject.org/projects/tor/ticket/16659#comment:10</a></span>
</li>
</ol></div></div>
<h1><span class="mw-headline" id="License">License</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a data-href="/w/index.php?title=Dev/TimeSync&amp;action=edit&amp;section=60" href="https://www.whonix.org/w/index.php?title=Dev/TimeSync&amp;action=edit&amp;section=60.html" title="Edit section: License">edit</a><span class="mw-editsection-bracket">]</span></span></h1>
<blockquote>
<p>Whonix Dev/TimeSync wiki page Copyright (C) Amnesia &lt;amnesia at boum dot org&gt;<br/>
Whonix Dev/TimeSync wiki page Copyright (C) 2012 - 2018 ENCRYPTED SUPPORT LP &lt;adrelanos@riseup.net&gt;<br/>
<br/>
This program comes with ABSOLUTELY NO WARRANTY; for details see the wiki source code.<br/>
This is free software, and you are welcome to redistribute it under certain conditions; see the wiki source code for details.
</p>
</blockquote>
<hr/>
<p><font size="-1">Comments will be deleted after some time. Specifically after comments have been addressed in form of wiki enhancements. See <a data-href="/wiki/Wiki_Comments_Policy" href="./Wiki_Comments_Policy.html" title="Wiki Comments Policy">Wiki Comments Policy</a>.</font>
</p>
<div class="comments-body"><div class="c-order">
<div class="c-order-select">
<p class="mw-empty-elt"> </p><form action="" name="ChangeOrder">
<select name="TheOrder">
<option value="0">Sort by date</option>
<option value="1">Sort by score</option>
</select>
</form>
<p class="mw-empty-elt"></p>
</div>
<div class="c-spy" id="spy">
<p> <a data-href="javascript:void(0)" href="javascript:void(0)">Enable comment auto-refresher</a>
</p>
</div>
<div class="visualClear"></div>
</div>
<p> <br/>
</p>
<div id="allcomments"></div><form action="" method="post" name="commentForm">
<div class="c-form-title">Add your comment</div>
<div class="c-form-reply-to" id="replyto"></div>
<div class="c-form-message">Whonix welcomes <b>all comments</b>. If you do not want to be anonymous, <a data-href="./Special:UserLogin/signup" href="./Special:UserLogin/signup">register</a> or <a data-href="./Special:UserLogin" href="./Special:UserLogin">log in</a>. It is free.</div>
<p><textarea cols="64" id="comment" name="commentText" rows="5"></textarea>
</p>
<div class="c-form-button"><input class="site-button" type="button" value="Post comment"/></div>
<p><input name="action" type="hidden" value="purge"/>
<input name="pageId" type="hidden" value="155"/>
<input name="commentid" type="hidden"/>
<input name="lastCommentId" type="hidden" value="0"/>
<input name="commentParentId" type="hidden"/>
<input name="cpage" type="hidden" value="1"/>
<input name="token" type="hidden" value="+\"/></p></form>
<p class="mw-empty-elt"></p>
<a id="end" rel="nofollow"></a></div>
<hr/>
<div style="padding-bottom:1px; padding-top:6px; border:thin solid black; background:#EEEEEE; text-align:center;"><u>Random News:</u>
<p>Please <a class="external text" data-href="./Contribute" href="./Contribute" rel="noreferrer noopener" target="_blank">contribute</a> by helping to <a class="external text" data-href="./Contribute#Answer_Questions" href="./Contribute" rel="noreferrer noopener" target="_blank">answer Whonix questions</a>.
</p>
</div>
<hr/><p><font size="-1"><a class="external text" data-href="./Dev/TimeSync" href="./Dev/TimeSync" rel="noreferrer noopener" target="_blank">https</a> | (<a data-href="/wiki/Forcing_.onion_on_Whonix.org" href="./Forcing_.onion_on_Whonix.org.html" title="Forcing .onion on Whonix.org">forcing</a>) <a class="external text" data-href="http://dds6qkxpwdeubwucdiaord2xgbbeyds25rbsgr73tbfpqpt4a6vjwsyd.onion/wiki/Dev/TimeSync" href="http://dds6qkxpwdeubwucdiaord2xgbbeyds25rbsgr73tbfpqpt4a6vjwsyd.onion/wiki/Dev/TimeSync" rel="noreferrer noopener" target="_blank">onion</a><br/>
</font></p><font size="-1"></font><p><font size="-1">Share: <a data-href="https://twitter.com/intent/tweet?url=./Dev/TimeSync&amp;text=&amp;via=Whonix" href="https://twitter.com/intent/tweet?url=./Dev/TimeSync&amp;text=&amp;via=Whonix">Twitter</a>
|
<a data-href="https://facebook.com/sharer.php?u=./Dev/TimeSync" href="https://facebook.com/sharer.php?u=./Dev/TimeSync">Facebook</a></font>
</p><p><font size="-1">This is a wiki. Want to improve this page? Help is welcome and volunteer contributions are happily considered! See <a class="external text" data-href="https://github.com/Whonix/Whonix/blob/master/CONTRIBUTING.md" href="https://github.com/Whonix/Whonix/blob/master/CONTRIBUTING.md" rel="noreferrer noopener" target="_blank">Conditions for Contributions to Whonix</a>, then <a data-href="/w/index.php?title=Dev/TimeSync&amp;action=edit" href="https://www.whonix.org/w/index.php?title=Dev/TimeSync&amp;action=edit">Edit</a>! IP addresses are scrubbed, but editing over Tor is recommended. Edits are held for moderation.</font>
</p><p><font size="-1">Whonix is a <a class="external text" data-href="http://www.openinventionnetwork.com/licensees.php" href="http://www.openinventionnetwork.com/licensees.php" rel="noreferrer noopener" target="_blank">licensee</a> of the Open Invention Network. Unless otherwise noted, the content of this page is <a data-href="/wiki/Whonix:Copyrights" href="./Whonix:Copyrights.html" title="Whonix:Copyrights">copyrighted</a> and licensed under the same Libre Software <a class="external text" data-href="https://github.com/Whonix/Whonix/blob/master/debian/copyright" href="https://github.com/Whonix/Whonix/blob/master/debian/copyright" rel="noreferrer noopener" target="_blank">license</a> as Whonix itself. (<a data-href="/wiki/Why_Whonix_is_Free_Software" href="./Why_Whonix_is_Free_Software.html" title="Why Whonix is Free Software">Why?</a>)</font>
</p><p><font size="-1">Whonix is provided by ENCRYPTED SUPPORT LP. See <a class="mw-redirect" data-href="/wiki/Impressum" href="./Impressum.html" title="Impressum">Imprint</a>.</font>
</p>
<!-- 
NewPP limit report
Cached time: 20190130071313
Cache expiry: 0
Dynamic content: true
CPU time usage: 0.240 seconds
Real time usage: 0.255 seconds
Preprocessor visited node count: 1267/1000000
Preprocessor generated node count: 3130/1000000
Postâexpand include size: 5562/2097152 bytes
Template argument size: 762/2097152 bytes
Highest expansion depth: 8/40
Expensive parser function count: 0/100
Unstrip recursion depth: 1/20
Unstrip postâexpand size: 24973/5000000 bytes
-->
<!--
Transclusion expansion time report (%,ms,calls,template)
100.00%  135.621      1 -total
 24.51%   33.239      1 Template:Reflist
 15.54%   21.073      1 Template:Footer
 10.40%   14.106      1 Template:Boot_Clock_Randomization
  8.91%   12.089      1 Template:Open_File
  6.81%    9.240      1 Template:Header
  6.72%    9.110      1 Template:Box
  5.64%    7.652      2 Template:CodeSelect
  3.61%    4.896      1 Template:Share
  3.41%    4.622      1 Template:Edit_it
-->
</div></div><div class="printfooter">
Retrieved from "<a data-href="https://www.whonix.org/w/index.php?title=Dev/TimeSync&amp;oldid=39099" dir="ltr" href="https://www.whonix.org/w/index.php?title=Dev/TimeSync&amp;oldid=39099">https://www.whonix.org/w/index.php?title=Dev/TimeSync&amp;oldid=39099</a>"</div>
<div class="clear_both"></div>
</div>
<div class="group"><div class="catlinks" data-mw="interface" id="catlinks"><div class="mw-normal-catlinks" id="mw-normal-catlinks"><a data-href="/wiki/Special:Categories" href="./Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a data-href="/wiki/Category:Design" href="./Category:Design.html" title="Category:Design">Design</a></li></ul></div></div></div>
</div>
</div>
</div>
<footer class="row">
<div id="footer">
<div class="small-12 large-centered columns text-center" id="footer-left">
<ul id="footer-left">
<li id="footer-lastmod"> This page was last edited on 7 November 2018, at 03:46.</li>
<li id="footer-Imprint"><a data-href="/wiki/Imprint" href="./Imprint.html" title="Imprint">Imprint</a></li>
<li id="footer-Privacy_Policy"><a data-href="/wiki/Privacy_Policy" href="./Privacy_Policy.html" title="Privacy Policy">Privacy Policy</a></li>
<li id="footer-Cookie_Policy"><a class="mw-redirect" data-href="/wiki/Cookie_Policy" href="./Cookie_Policy.html" title="Cookie Policy">Cookie Policy</a></li>
<li id="footer-Terms_of_Service"><a class="mw-redirect" data-href="/wiki/Terms_of_Service" href="./Terms_of_Service.html" title="Terms of Service">Terms of Service</a></li>
<li id="footer-Priority_Support"><a data-href="/wiki/Priority_Support" href="./Priority_Support.html" title="Priority Support">Priority Support</a></li>
<li id="footer-Investors"><a data-href="/wiki/Investors" href="./Investors.html" title="Investors">Investors</a></li>
<li id="footer-Professional_Support"><a data-href="/wiki/Professional_Support" href="./Professional_Support.html" title="Professional Support">Professional Support</a></li>
</ul>
</div>
<div class="large-12 small-12 columns" id="footer-right-icons">
<ul id="poweredby">
</ul>
</div>
</div>
</footer>
</div>

</body>
</html>
