<!DOCTYPE html>
<html class="client-nojs" dir="ltr" lang="en"><!-- 
 single html processed by https://github.com/zTrix/webpage2html
 title: Corridor - Whonix
 url: ./Corridor
 date: Tue Aug 28 07:35:20 2018
-->
<head>
<meta charset="utf-8"/>
<title>Corridor - Whonix</title>
<link rel="stylesheet" type="text/css" href="style.css">




<style>.firstHeading, .subtitle, #siteSub, #contentSub, .pagetitle { display: none; }</style>
<meta content="" name="ResourceLoaderDynamicStyles"/>

<meta content="MediaWiki 1.31.0" name="generator"/>
<meta content="" name="google-site-verification"/>
<meta content="https://www.whonix.org/w/images/4/47/Whonix_Facebook_Social_Share.png" name="image"/>
<meta content="https://www.whonix.org/w/images/4/47/Whonix_Facebook_Social_Share.png" name="twitter:image:src"/>
<meta content="summary_large_image" name="twitter:card"/>
<meta content="@Whonix" name="twitter:site"/>
<meta content="Whonix" name="twitter:domain"/>
<meta content="@Whonix" name="twitter:creator"/>
<meta content="Using corridor, a Tor traffic whitelisting gateway with Whonix" name="description"/>
<meta content="Using corridor, a Tor traffic whitelisting gateway with Whonix" name="twitter:description"/>
<meta content="width=device-width, user-scalable=yes, initial-scale=1.0" name="viewport"/>
<link data-href="/w/index.php?title=Corridor&amp;action=edit" href="https://www.whonix.org/w/index.php?title=Corridor&amp;action=edit" rel="alternate.html" title="Edit" type="application/x-wiki"/>
<link data-href="/w/index.php?title=Corridor&amp;action=edit" href="https://www.whonix.org/w/index.php?title=Corridor&amp;action=edit" rel="edit.html" title="Edit"/>
<link data-href="/favicon.ico" href="data:image/x-icon;base64,AAABAAEAEBAAAAEAIABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOPj4wC5q6j/xba0/8W2tP+3qab/4+PiBQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAALyurP/Ku7n/yru5/8q7uf/Ku7n/yru5/8q7uf+6rKr/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAALyurP/Ku7n/yru5/8CohP/VnhL/1Z4S/8CohP/Ku7n/yru5/7mrqf8AAAAAAAAAAAAAAAAAAAAAAAAAAI6Mi//Ku7n/yru5/8GRHP/iqhL/////////////////wJEd/8q7uf/Ku7n/xsXE/wAAAAAAAAAAAAAAAAAAAAC5q6n/yru5/8q7uf/hqRH//////0bcy/9G3Mv//////+GpEf/Ku7n/yru5/7qsqv8AAAAAAAAAAAAAAAAAAAAAxLW0/8q7uf/Ku7n/4qoS/////////////////0bcy//iqhL/yru5/8q7uf/Gt7T/AAAAAAAAAAAAAAAAAAAAAMKzsP/Ku7n/yru5/96lFf//////RtzL/0bcy///////3qUV/8q7uf/Ku7n/wrWy/wAAAAAAAAAAAAAAAAAAAACvo6D/yru5/8q7uf/Ku7n/4akQ//fnvP/57tD/4akQ/8q7uf/Ku7n/yru5/7Gkov8AAAAAAAAAAAAAAAAAAAAAAAAAAMq7uf/Ku7n/yru5/8q7uf/hqRD/4akQ/8q7uf/Ku7n/yru5/8q7uf8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACOjIv/yru5/8q7uf/Ku7n/yru5/8q7uf/Ku7n/yru5/8q7uf+Mioj/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAISDgf/Iurj/yru5/8q7uf/Ku7n/yru5/8i5uP+EgoH/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAC6rKr/q56c/wAAAACOjIv/joyL/wAAAACom5r/taim/wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAuqyp/66hnv8AAAAAAAAAAAAAAAAAAAAAqp2b/7SnpP8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAKmcm/+9r6z/AAAAAAAAAAAAAAAAAAAAALmrqf+jl5b/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwLOw/6uenP8AAAAAAAAAAKqenP+/sq//AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACtoJ7/vK2r/72vrP+sn57/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/D8AAPAPAADgBwAAwAMAAMADAADAAwAAwAMAAMADAADgBwAA4AcAAPAPAADyTwAA888AAPPPAAD5nwAA/D8AAA==" rel="shortcut icon"/>
<link data-href="/w/opensearch_desc.php" href="https://www.whonix.org/w/opensearch_desc.php" rel="search.html" title="Whonix (en)" type="application/opensearchdescription+xml"/>
<link data-href="https://www.whonix.org/w/api.php?action=rsd" href="https://www.whonix.org/w/api.php?action=rsd" rel="EditURI" type="application/rsd+xml"/>
<link data-href="/w/index.php?title=Special:RecentChanges&amp;feed=atom" href="https://www.whonix.org/w/index.php?title=Special:RecentChanges&amp;feed=atom" rel="alternate.html" title="Whonix Atom feed" type="application/atom+xml"/>
<meta content="article" property="og:type"/>
<meta content="Whonix" property="og:site_name"/>
<meta content="Corridor" property="og:title"/>
<meta content="./Corridor" property="og:url"/>
<meta content="https://www.whonix.org/w/images/4/47/Whonix_Facebook_Social_Share.png" property="og:image"/>
<meta content="Using corridor, a Tor traffic whitelisting gateway with Whonix" property="og:description"/>

<meta content="" property="fb:app_id"/>
<meta content="" property="fb:admins"/>
<meta content="https://www.facebook.com/Whonix" property="article:author"/>
<meta content="https://www.facebook.com/Whonix" property="article:publisher"/>
<meta content="IE=edge" http-equiv="X-UA-Compatible"/>
<!--[if lt IE 9]><script src="/w/load.php?debug=false&amp;lang=en&amp;modules=html5shiv&amp;only=scripts&amp;skin=foreground&amp;sync=1"></script><![endif]-->
</head>
<body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Corridor rootpage-Corridor skin-foreground action-view"><div id="navwrapper"><!-- START FOREGROUNDTEMPLATE -->

</div>
<div id="page-content">
<div class="row">
<div class="large-12 columns">
<!-- Output page indicators -->
<div class="mw-indicators mw-body-content">
</div>
<!-- If user is logged in output echo location -->
<!--[if lt IE 9]>
				<div id="siteNotice" class="sitenotice panel radius">Whonix may not look as expected in this version of Internet Explorer. We recommend you upgrade to a newer version of Internet Explorer or switch to a browser like Firefox or Chrome.</div>
				<![endif]-->
<div class="sitenotice" id="siteNotice"><div dir="ltr" id="localNotice" lang="en"><div class="mw-parser-output"><p><style type="text/css">

#banner {
 position: relative;
 overflow: hidden;
 margin-bottom: 0.5em !important;
 margin-top: 0.5em !important;
 background-color:#D03232;
 border: solid 1px #aaaaaa; 
 height:66px;
}

#banner a.cn-full-banner-click {
 display:block;
 height:100%;
 width:100%;
 cursor: pointer;
}


#banner-logo {
 position: absolute;
 top: 8px;
 left: 15px;
 background-image: url(data:image/png;base64,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);
 height: 50px;
 width: 100%;
 background-repeat: no-repeat;
}

#banner #black-text {
 font-size: 1.1em;
 color: white;
 padding: 0.5em 40px 0.4em 60px;
 line-height: 1.3em;
 text-align: center;
}
</style>
</p><div id="banner">
<a class="cn-full-banner-click" data-href="/wiki/Payments" href="./Payments.html" title="">
<div id="banner-logo"></div>
<div id="black-text">
Whonix requires payments to stay alive.
     </div>
</a>
</div>
</div></div></div> </div>
</div>
<div id="mw-js-message" style="display:none;"></div>
<div class="row">
<div class="large-12 columns" id="p-cactions">
<a class="button small secondary radius" data-dropdown="actions" data-options="align:left; is_hover: true; hover_timeout:700" href="#" id="actions-button"><i class="fa fa-cog"><span class="show-for-medium-up"> Actions</span></i></a>
<!--RTL -->
<ul class="f-dropdown" data-dropdown-content="" id="actions">
<li class="selected" id="ca-nstab-main"><a accesskey="c" data-href="/wiki/Corridor" href="./Corridor.html" title="View the content page [c]">Page</a></li><li class="new" id="ca-talk"><a accesskey="t" data-href="/w/index.php?title=Talk:Corridor&amp;action=edit&amp;redlink=1" href="https://www.whonix.org/w/index.php?title=Talk:Corridor&amp;action=edit&amp;redlink=1" rel="discussion.html" title="Discussion about the content page (page does not exist) [t]">Discussion</a></li><li id="ca-edit"><a accesskey="e" data-href="/w/index.php?title=Corridor&amp;action=edit" href="https://www.whonix.org/w/index.php?title=Corridor&amp;action=edit.html" title="Edit this page [e]">Edit</a></li><li id="ca-history"><a accesskey="h" data-href="/w/index.php?title=Corridor&amp;action=history" href="https://www.whonix.org/w/index.php?title=Corridor&amp;action=history.html" title="Past revisions of this page [h]">History</a></li> </ul>
<!--RTL -->
<div id="content">
<h1 class="title" id="firstHeading">Corridor</h1>
<h5 class="subtitle" id="siteSub"></h5>
<div class="clear_both" id="contentSub"></div>
<div class="mw-bodytext" id="bodyContent">
<div class="mw-content-ltr" dir="ltr" id="mw-content-text" lang="en"><div class="mw-parser-output">
<p><br/>
</p>
<div class="toc" id="toc"><div class="toctitle" dir="ltr" lang="en"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Introduction"><span class="tocnumber">1</span> <span class="toctext">Introduction</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#Connecting_to_corridor_before_Tor"><span class="tocnumber">2</span> <span class="toctext">Connecting to corridor before Tor</span></a>
<ul>
<li class="toclevel-2 tocsection-3"><a href="#Introduction_2"><span class="tocnumber">2.1</span> <span class="toctext">Introduction</span></a></li>
<li class="toclevel-2 tocsection-4"><a href="#Warning"><span class="tocnumber">2.2</span> <span class="toctext">Warning</span></a></li>
<li class="toclevel-2 tocsection-5"><a href="#dom0_setup"><span class="tocnumber">2.3</span> <span class="toctext">dom0 setup</span></a></li>
<li class="toclevel-2 tocsection-6"><a href="#sys-corridor_setup"><span class="tocnumber">2.4</span> <span class="toctext">sys-corridor setup</span></a></li>
<li class="toclevel-2 tocsection-7"><a href="#test_corridor"><span class="tocnumber">2.5</span> <span class="toctext">test corridor</span></a></li>
<li class="toclevel-2 tocsection-8"><a href="#test_logging"><span class="tocnumber">2.6</span> <span class="toctext">test logging</span></a></li>
<li class="toclevel-2 tocsection-9"><a href="#interpreting_the_results"><span class="tocnumber">2.7</span> <span class="toctext">interpreting the results</span></a></li>
<li class="toclevel-2 tocsection-10"><a href="#configure_sys-whonix"><span class="tocnumber">2.8</span> <span class="toctext">configure sys-whonix</span></a></li>
<li class="toclevel-2 tocsection-11"><a href="#done"><span class="tocnumber">2.9</span> <span class="toctext">done</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-12"><a href="#Debugging"><span class="tocnumber">3</span> <span class="toctext">Debugging</span></a></li>
<li class="toclevel-1 tocsection-13"><a href="#Footnotes"><span class="tocnumber">4</span> <span class="toctext">Footnotes</span></a></li>
</ul>
</div>
<h1><span class="mw-headline" id="Introduction">Introduction</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a data-href="/w/index.php?title=Corridor&amp;action=edit&amp;section=1" href="https://www.whonix.org/w/index.php?title=Corridor&amp;action=edit&amp;section=1.html" title="Edit section: Introduction">edit</a><span class="mw-editsection-bracket">]</span></span></h1>
<p>corridor is a Tor traffic whitelisting gateway. It is a filtering gateway. Not a proxying gateway.
</p><p><a class="external free" data-href="https://github.com/rustybird/corridor" href="https://github.com/rustybird/corridor" rel="noreferrer noopener" target="_blank">https://github.com/rustybird/corridor</a>
</p><p>It can also be used as a <a class="external text" data-href="https://trac.torproject.org/projects/tor/wiki/doc/TorifyHOWTO/BridgeFirewall" href="https://trac.torproject.org/projects/tor/wiki/doc/TorifyHOWTO/BridgeFirewall" rel="noreferrer noopener" target="_blank">BridgeFirewall</a>.
</p>
<h1><span class="mw-headline" id="Connecting_to_corridor_before_Tor">Connecting to corridor before Tor</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a data-href="/w/index.php?title=Corridor&amp;action=edit&amp;section=2" href="https://www.whonix.org/w/index.php?title=Corridor&amp;action=edit&amp;section=2.html" title="Edit section: Connecting to corridor before Tor">edit</a><span class="mw-editsection-bracket">]</span></span></h1>
<h2><span class="mw-headline" id="Introduction_2">Introduction</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a data-href="/w/index.php?title=Corridor&amp;action=edit&amp;section=3" href="https://www.whonix.org/w/index.php?title=Corridor&amp;action=edit&amp;section=3.html" title="Edit section: Introduction">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>It is possible to configure Whonix-Gateway (sys-whonix) to use corridor as <u>local</u> proxy to establish the following tunnel:<br/>
<b>User -&gt; corridor -&gt; Tor &gt; Internet</b>
</p><p>This is not necessarily more anonymous. It is an additional fail-safe Tor traffic whitelisting firewall that would protect from accidental clearnet leaks (hypothetical clearnet leak bugs in Whonix). As <a class="external text" data-href="https://github.com/rustybird/corridor" href="https://github.com/rustybird/corridor" rel="noreferrer noopener" target="_blank">corridor's project description</a> states, quote "it cannot prevent malware on a client computer from finding out your clearnet IP address". corridor is mostly useful for developers and auditors of Whonix, perhaps also for advanced users who would like to have an additional safety net. It cannot protect from hypothetical Qubes ProxyVM leak bugs either, a <a class="external text" data-href="https://github.com/rustybird/corridor" href="https://github.com/rustybird/corridor" rel="noreferrer noopener" target="_blank">physically isolated, standalone corridor-Gateway</a> would be better and could cover that.
</p><p>It does not increase the tunnel length, i.e. it does not add more relays between you and the destination, if you are interested in that, see <a data-href="/wiki/Tunnels/Introduction" href="./Tunnels/Introduction.html" title="Tunnels/Introduction">Tunnels/Introduction</a>.
</p><p>If you want to do this, apply the following instructions.
</p><p><a class="mw-redirect" data-href="/wiki/Qubes-Whonix" href="./Qubes-Whonix.html" title="Qubes-Whonix">Qubes-Whonix</a> only! <a data-href="/wiki/Non-Qubes-Whonix" href="./Non-Qubes-Whonix.html" title="Non-Qubes-Whonix">Non-Qubes-Whonix</a> is <a data-href="/wiki/Unsupported" href="./Unsupported.html" title="Unsupported">unsupported</a>. <sup class="reference" id="cite_ref-1"><a href="#cite_note-1">[1]</a></sup>
</p><p>Credits: The author of corridor is <a class="external text" data-href="https://github.com/rustybird" href="https://github.com/rustybird" rel="noreferrer noopener" target="_blank">rustybird</a>. The author of <a class="external text" data-href="https://en.wikipedia.org/wiki/Fork_%28software_development%29" href="https://en.wikipedia.org/wiki/Fork_%28software_development%29" rel="noreferrer noopener" target="_blank">fork</a> of <a class="external text" data-href="https://github.com/adrelanos/corridor" href="https://github.com/adrelanos/corridor" rel="noreferrer noopener" target="_blank">corridor for Debian</a> which will be used in these instructions is <a class="external text" data-href="https://github.com/adrelanos" href="https://github.com/adrelanos" rel="noreferrer noopener" target="_blank">Patrick Schleizer</a>.
</p><p>The following instructions should be applied in a <a class="external text" data-href="https://www.qubes-os.org" href="https://www.qubes-os.org" rel="noreferrer noopener" target="_blank">Qubes</a> using a <a class="external text" data-href="https://www.qubes-os.org/doc/templates/debian/" href="https://www.qubes-os.org/doc/templates/debian/" rel="noreferrer noopener" target="_blank">Debian template</a>.
</p>
<h2><span class="mw-headline" id="Warning">Warning</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a data-href="/w/index.php?title=Corridor&amp;action=edit&amp;section=4" href="https://www.whonix.org/w/index.php?title=Corridor&amp;action=edit&amp;section=4.html" title="Edit section: Warning">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<table class="metadata plainlinks ambox ambox-notice" style="">
<tbody><tr><td class="mbox-image"><div style="width: 52px;"><a class="image" data-href="/w/index.php?title=File:Ambox_warning_pn.svg.png&amp;filetimestamp=20130717200816&amp;" href="https://www.whonix.org/w/index.php?title=File:Ambox_warning_pn.svg.png&amp;filetimestamp=20130717200816&amp;"><img alt="Ambox warning pn.svg.png" data-src="/w/images/thumb/f/f7/Ambox_warning_pn.svg.png/40px-Ambox_warning_pn.svg.png" data-srcset="/w/images/thumb/f/f7/Ambox_warning_pn.svg.png/60px-Ambox_warning_pn.svg.png 1.5x, /w/images/thumb/f/f7/Ambox_warning_pn.svg.png/80px-Ambox_warning_pn.svg.png 2x" height="35" src="data:image/png;base64,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" width="40"/></a></div></td><td class="mbox-text" style=""><span class="mbox-text-span">The following instructions will result by default in:
<ul><li>the <a class="external text" data-href="https://packages.debian.org/jessie/tor" href="https://packages.debian.org/jessie/tor" rel="noreferrer noopener" target="_blank">Debian tor package</a> being installed</li>
<li>and thereby automatically connecting to the <a class="external text" data-href="https://www.torproject.org" href="https://www.torproject.org" rel="noreferrer noopener" target="_blank">Tor</a> public network.</li>
<li>Downloading corridor from <a data-href="/wiki/Whonix-APT-Repository" href="./Whonix-APT-Repository.html" title="Whonix-APT-Repository">Whonix-APT-Repository</a>.</li>
<li>This may not be what you want if you want to <a data-href="/wiki/Hide_Tor_and_Whonix_from_your_ISP" href="./Hide_Tor_and_Whonix_from_your_ISP.html" title="Hide Tor and Whonix from your ISP">hide Tor and Whonix from your ISP</a>.</li>
<li>If you are already using Whonix, which you are most likely doing when reading this page, in running a second instance of <a data-href="/wiki/Tor" href="./Tor.html" title="Tor">Tor</a> which is independent from the one running inside Whonix-Gateway. From the perspective of your ISP you will have a different network <a data-href="/wiki/Fingerprint" href="./Fingerprint.html" title="Fingerprint">Fingerprint</a>. This should be no worse than running Tor Browser, or system-tor and Whonix at the same time.<span class="hide-when-compact"> </span><span class="hide-when-compact"> </span></li></ul></span></td></tr></tbody></table>
<h2><span class="mw-headline" id="dom0_setup">dom0 setup</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a data-href="/w/index.php?title=Corridor&amp;action=edit&amp;section=5" href="https://www.whonix.org/w/index.php?title=Corridor&amp;action=edit&amp;section=5.html" title="Edit section: dom0 setup">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>Create a new standalone ProxyVM called <i><span style="background-color:#FBFBFB">sys-corridor</span></i> based on Debian-8 template.
</p><p><code>Qubes VM Manager -&gt; Create AppVM -&gt; enable 'Standalone' -&gt; name: <i><span style="background-color:#FBFBFB">sys-corridor</span></i> -&gt; template: Debian-8 -&gt; OK</code>
</p><p>Enable the <i><span style="background-color:#FBFBFB">corridor</span></i> qvm service.
</p><p><code>Qubes VM Manager -&gt; click on <i><span style="background-color:#FBFBFB">sys-corridor</span></i> -&gt; right click -&gt; VM settings -&gt; services -&gt; type in the field -&gt; <i><span style="background-color:#FBFBFB">corridor</span></i> -&gt; press <i><span style="background-color:#FBFBFB">+</span></i> -&gt; press OK</code>
</p>
<h2><span class="mw-headline" id="sys-corridor_setup">sys-corridor setup</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a data-href="/w/index.php?title=Corridor&amp;action=edit&amp;section=6" href="https://www.whonix.org/w/index.php?title=Corridor&amp;action=edit&amp;section=6.html" title="Edit section: sys-corridor setup">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>Start <i><span style="background-color:#FBFBFB">sys-corridor</span></i> and open a terminal using Qubes start menu.
</p><p>Inside <i><span style="background-color:#FBFBFB">sys-corridor</span></i>...
</p><p>Optional. If you want to use corridor as a <a class="external text" data-href="https://trac.torproject.org/projects/tor/wiki/doc/TorifyHOWTO/BridgeFirewall" href="https://trac.torproject.org/projects/tor/wiki/doc/TorifyHOWTO/BridgeFirewall" rel="noreferrer noopener" target="_blank">BridgeFirewall</a>, configure Tor to use <a class="external text" data-href="https://www.torproject.org/docs/bridges.html.en" href="https://www.torproject.org/docs/bridges.html.en" rel="noreferrer noopener" target="_blank">bridges</a> now. (The Whonix page about <a data-href="/wiki/Bridges" href="./Bridges.html" title="Bridges">Bridges</a> might help but it does not apply one to one.) Also if you want to do that, create folder <i><span style="background-color:#FBFBFB">/etc/corridor.d</span></i> and configuration file <i><span style="background-color:#FBFBFB">/etc/corridor.d/21-bridges-user.conf</span></i> now. Otherwise if you like to use Tor entry guards <sup class="reference" id="cite_ref-2"><a href="#cite_note-2">[2]</a></sup>, you can skip that.
</p><p>Note: <i>Bridges are less reliable and tend to have lower performance than other entry points. If you live in a uncensored area, they are not necessarily more secure than entry guards.</i> <i>Source: <a class="external text" data-href="https://lists.torproject.org/pipermail/tor-talk/2012-May/024378.html" href="https://lists.torproject.org/pipermail/tor-talk/2012-May/024378.html" rel="noreferrer noopener" target="_blank">bridge vs non-bridge users anonymity</a>.</i>
</p><p>Open <i><span style="background-color:#FBFBFB">/etc/corridor.d/21-bridges-user.conf</span></i> in an editor with root rights.
</p>
<div style="background: #F8F8F8; border: 2px; padding: 5px; margin: 10px; border-style: solid; border-color: black; width: 100%">
<p><u>If you are using a graphical Whonix or <a data-href="/wiki/Qubes" href="./Qubes.html" title="Qubes">Qubes-Whonix</a></u>, run.
</p><div class="codeContainer">
<div class="selectBtnDiv">
<div class="smallText"><a class="selectLink" href="#" onclick="SelectText(this.parentNode.parentNode.parentNode.children[2].children[0]); return false;">[select code]</a></div>
</div>
<div class="preDiv">
<pre>kdesudo kwrite /etc/corridor.d/21-bridges-user.conf</pre>
</div>
<div class="textareaDiv">
<textarea class="codeBoxArea" readonly="readonly" rows="1">kdesudo kwrite /etc/corridor.d/21-bridges-user.conf</textarea>
</div>
</div>
<p><u>If you are using a terminal-only Whonix</u>, run.
</p><div class="codeContainer">
<div class="selectBtnDiv">
<div class="smallText"><a class="selectLink" href="#" onclick="SelectText(this.parentNode.parentNode.parentNode.children[2].children[0]); return false;">[select code]</a></div>
</div>
<div class="preDiv">
<pre>sudo nano /etc/corridor.d/21-bridges-user.conf</pre>
</div>
<div class="textareaDiv">
<textarea class="codeBoxArea" readonly="readonly" rows="1">sudo nano /etc/corridor.d/21-bridges-user.conf</textarea>
</div>
</div>
</div>
<p>Add. TODO: doesn't work
</p><p></p><div class="codeContainer">
<div class="selectBtnDiv">
<div class="smallText"><a class="selectLink" href="#" onclick="SelectText(this.parentNode.parentNode.parentNode.children[2].children[0]); return false;">[select code]</a></div>
</div>
<div class="preDiv">
<pre>TODO: doesn't work

BRIDGES=`grep -Ei '^[[:space:]]*Bridge[[:space:]]' /usr/local/etc/torrc.d/*`</pre>
</div>
<div class="textareaDiv">
<textarea class="codeBoxArea" readonly="readonly" rows="1">TODO: doesn't work

BRIDGES=`grep -Ei '^[[:space:]]*Bridge[[:space:]]' /usr/local/etc/torrc.d/*`</textarea>
</div>
</div>
<p>Save.
</p><p><b>WARNING: This tells your ISP that you use Whonix. You should set this up with Tor unless you have a reason not to.</b>
</p><p>Complete the follow steps to obtain the <a data-href="/wiki/Whonix_Signing_Key" href="./Whonix_Signing_Key.html" title="Whonix Signing Key">Whonix Signing Key</a>.
</p><p></p><div class="codeContainer">
<div class="selectBtnDiv">
<div class="smallText"><a class="selectLink" href="#" onclick="SelectText(this.parentNode.parentNode.parentNode.children[2].children[0]); return false;">[select code]</a></div>
</div>
<div class="preDiv">
<pre>sudo apt-key --keyring /etc/apt/trusted.gpg.d/whonix.gpg adv --keyserver hkp://ipv4.pool.sks-keyservers.net:80 --recv-keys 916B8D99C38EAF5E8ADC7A2A8D66066A2EEACCDA</pre>
</div>
<div class="textareaDiv">
<textarea class="codeBoxArea" readonly="readonly" rows="1">sudo apt-key --keyring /etc/apt/trusted.gpg.d/whonix.gpg adv --keyserver hkp://ipv4.pool.sks-keyservers.net:80 --recv-keys 916B8D99C38EAF5E8ADC7A2A8D66066A2EEACCDA</textarea>
</div>
</div>
<p>Add <a data-href="/wiki/Whonix-APT-Repository" href="./Whonix-APT-Repository.html" title="Whonix-APT-Repository">Whonix's APT repository</a> for default Whonix using Debian <i><span style="background-color:#FBFBFB">stable</span></i>. At the time of writing this was <code>stretch</code>.
</p><p></p><div class="codeContainer">
<div class="selectBtnDiv">
<div class="smallText"><a class="selectLink" href="#" onclick="SelectText(this.parentNode.parentNode.parentNode.children[2].children[0]); return false;">[select code]</a></div>
</div>
<div class="preDiv">
<pre>echo "deb http://deb.whonix.org stretch main" | sudo tee /etc/apt/sources.list.d/whonix.list</pre>
</div>
<div class="textareaDiv">
<textarea class="codeBoxArea" readonly="readonly" rows="1">echo "deb http://deb.whonix.org stretch main" | sudo tee /etc/apt/sources.list.d/whonix.list</textarea>
</div>
</div>
<p><a class="mw-redirect" data-href="/wiki/Update" href="./Update.html" title="Update">Update</a> the package lists.
</p><p></p><div class="codeContainer">
<div class="selectBtnDiv">
<div class="smallText"><a class="selectLink" href="#" onclick="SelectText(this.parentNode.parentNode.parentNode.children[2].children[0]); return false;">[select code]</a></div>
</div>
<div class="preDiv">
<pre>sudo apt-get update</pre>
</div>
<div class="textareaDiv">
<textarea class="codeBoxArea" readonly="readonly" rows="1">sudo apt-get update</textarea>
</div>
</div>
<p>Install corridor.
</p><p></p><div class="codeContainer">
<div class="selectBtnDiv">
<div class="smallText"><a class="selectLink" href="#" onclick="SelectText(this.parentNode.parentNode.parentNode.children[2].children[0]); return false;">[select code]</a></div>
</div>
<div class="preDiv">
<pre>sudo apt-get install corridor</pre>
</div>
<div class="textareaDiv">
<textarea class="codeBoxArea" readonly="readonly" rows="1">sudo apt-get install corridor</textarea>
</div>
</div>
<p>As long as this instructions are experimental, you are advised to run the following systemctl commands to check if everything is alright.
</p><p></p><div class="codeContainer">
<div class="selectBtnDiv">
<div class="smallText"><a class="selectLink" href="#" onclick="SelectText(this.parentNode.parentNode.parentNode.children[2].children[0]); return false;">[select code]</a></div>
</div>
<div class="preDiv">
<pre>sudo systemctl --no-pager status corridor-data
sudo systemctl --no-pager status corridor-init-forwarding 
sudo systemctl --no-pager status corridor-init-logged 
sudo systemctl --no-pager status corridor-init-snat</pre>
</div>
<div class="textareaDiv">
<textarea class="codeBoxArea" readonly="readonly" rows="1">sudo systemctl --no-pager status corridor-data
sudo systemctl --no-pager status corridor-init-forwarding 
sudo systemctl --no-pager status corridor-init-logged 
sudo systemctl --no-pager status corridor-init-snat</textarea>
</div>
</div>
<p>Reboot <i><span style="background-color:#FBFBFB">sys-corridor</span></i>.
</p>
<h2><span class="mw-headline" id="test_corridor">test corridor</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a data-href="/w/index.php?title=Corridor&amp;action=edit&amp;section=7" href="https://www.whonix.org/w/index.php?title=Corridor&amp;action=edit&amp;section=7.html" title="Edit section: test corridor">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>Run the above systemctl commands again.
</p><p>Create (or use an appropriate existing one) AppVM called <i><span style="background-color:#FBFBFB">corridor-client</span></i> or so and install / run either system-tor (from Debian or Fedora package sources) or Tor Browser. Then set the NetVM of <i><span style="background-color:#FBFBFB">corridor-client</span></i> to <i><span style="background-color:#FBFBFB">sys-corridor</span></i>. Tor should be still able to connect.
</p><p>To test system-tor, start watching Tor's log.
</p><p></p><div class="codeContainer">
<div class="selectBtnDiv">
<div class="smallText"><a class="selectLink" href="#" onclick="SelectText(this.parentNode.parentNode.parentNode.children[2].children[0]); return false;">[select code]</a></div>
</div>
<div class="preDiv">
<pre>sudo tail -f /var/log/tor/log</pre>
</div>
<div class="textareaDiv">
<textarea class="codeBoxArea" readonly="readonly" rows="1">sudo tail -f /var/log/tor/log</textarea>
</div>
</div>
<p>See if it initially successfully connected.
</p><p>Then restart Tor.
</p><p></p><div class="codeContainer">
<div class="selectBtnDiv">
<div class="smallText"><a class="selectLink" href="#" onclick="SelectText(this.parentNode.parentNode.parentNode.children[2].children[0]); return false;">[select code]</a></div>
</div>
<div class="preDiv">
<pre>sudo service tor restart</pre>
</div>
<div class="textareaDiv">
<textarea class="codeBoxArea" readonly="readonly" rows="1">sudo service tor restart</textarea>
</div>
</div>
<p>See if Tor is still able to connect.
</p><p>To test Tor Browser, check if it is able to initially connect to the internet while NetVM is still set to <i><span style="background-color:#FBFBFB">sys-firewall</span></i>. Then set the NetVM to <i><span style="background-color:#FBFBFB">sys-corridor</span></i> and see if it is still able to connect. If so, that is a good sign. Finally, you could should attempt an un-torified connection by using an un-torified application such as the chromium or firefox browser. Un-torified applications should fail to connect to the internet.
</p>
<h2><span class="mw-headline" id="test_logging">test logging</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a data-href="/w/index.php?title=Corridor&amp;action=edit&amp;section=8" href="https://www.whonix.org/w/index.php?title=Corridor&amp;action=edit&amp;section=8.html" title="Edit section: test logging">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>Whenever you try something that gets blocked by corridor, such as the above <a href="#test_corridor">#test corridor</a>, it will appear in syslog. Examine <i><span style="background-color:#FBFBFB">/var/log/syslog</span></i>.
</p><p>Open <i><span style="background-color:#FBFBFB">/var/log/syslog</span></i> in an editor.
</p>
<div style="background: #F8F8F8; border: 2px; padding: 5px; margin: 10px; border-style: solid; border-color: black; width: 100%">
<p><u>If you are using a graphical environment</u>, run.
</p><div class="codeContainer">
<div class="selectBtnDiv">
<div class="smallText"><a class="selectLink" href="#" onclick="SelectText(this.parentNode.parentNode.parentNode.children[2].children[0]); return false;">[select code]</a></div>
</div>
<div class="preDiv">
<pre>kwrite /var/log/syslog</pre>
</div>
<div class="textareaDiv">
<textarea class="codeBoxArea" readonly="readonly" rows="1">kwrite /var/log/syslog</textarea>
</div>
</div>
<p><u>If you are using a terminal (Konsole)</u>, run.
</p><div class="codeContainer">
<div class="selectBtnDiv">
<div class="smallText"><a class="selectLink" href="#" onclick="SelectText(this.parentNode.parentNode.parentNode.children[2].children[0]); return false;">[select code]</a></div>
</div>
<div class="preDiv">
<pre>nano /var/log/syslog</pre>
</div>
<div class="textareaDiv">
<textarea class="codeBoxArea" readonly="readonly" rows="1">nano /var/log/syslog</textarea>
</div>
</div>
</div>
<p>To check that run inside <i><span style="background-color:#FBFBFB">sys-corridor</span></i>.
</p><p></p><div class="codeContainer">
<div class="selectBtnDiv">
<div class="smallText"><a class="selectLink" href="#" onclick="SelectText(this.parentNode.parentNode.parentNode.children[2].children[0]); return false;">[select code]</a></div>
</div>
<div class="preDiv">
<pre>sudo tail -f /var/log/syslog</pre>
</div>
<div class="textareaDiv">
<textarea class="codeBoxArea" readonly="readonly" rows="1">sudo tail -f /var/log/syslog</textarea>
</div>
</div>
<p>If corridor blocked something, it will look like this.
</p><p></p><div class="codeContainer">
<div class="selectBtnDiv">
<div class="smallText"><a class="selectLink" href="#" onclick="SelectText(this.parentNode.parentNode.parentNode.children[2].children[0]); return false;">[select code]</a></div>
</div>
<div class="preDiv">
<pre>Jul 19 00:58:27 localhost kernel: [  954.706833] corridor:</pre>
</div>
<div class="textareaDiv">
<textarea class="codeBoxArea" readonly="readonly" rows="1">Jul 19 00:58:27 localhost kernel: [  954.706833] corridor:</textarea>
</div>
</div>
<h2><span class="mw-headline" id="interpreting_the_results">interpreting the results</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a data-href="/w/index.php?title=Corridor&amp;action=edit&amp;section=9" href="https://www.whonix.org/w/index.php?title=Corridor&amp;action=edit&amp;section=9.html" title="Edit section: interpreting the results">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>It is probably best not to connect set other VMs than <i><span style="background-color:#FBFBFB">sys-whonix</span></i> to use <i><span style="background-color:#FBFBFB">sys-corridor</span></i> as NetVM. This is because <a class="external text" data-href="https://github.com/marmarek/qubes-core-agent-linux/blob/master/vm-systemd/qubes-update-check.service" href="https://github.com/marmarek/qubes-core-agent-linux/blob/master/vm-systemd/qubes-update-check.service" rel="noreferrer noopener" target="_blank">qubes-update-check.service</a> will and <a class="external text" data-href="https://github.com/QubesOS/qubes-issues/issues/1814" href="https://github.com/QubesOS/qubes-issues/issues/1814" rel="noreferrer noopener" target="_blank">other stuff</a> may try to use the internet without using Tor. Therefore shut down <i><span style="background-color:#FBFBFB">corridor-client</span></i>.
</p>
<h2><span class="mw-headline" id="configure_sys-whonix">configure sys-whonix</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a data-href="/w/index.php?title=Corridor&amp;action=edit&amp;section=10" href="https://www.whonix.org/w/index.php?title=Corridor&amp;action=edit&amp;section=10.html" title="Edit section: configure sys-whonix">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>Set sys-whonix's NetVM to <i><span style="background-color:#FBFBFB">sys-corridor</span></i>.
</p><p><code>Qubes VM Manager -&gt; one left click on sys-whonix -&gt; right click -&gt; VM-Settings -&gt; NetVM -&gt; <i><span style="background-color:#FBFBFB">sys-corridor</span></i> -&gt; OK</code>
</p>
<h2><span class="mw-headline" id="done">done</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a data-href="/w/index.php?title=Corridor&amp;action=edit&amp;section=11" href="https://www.whonix.org/w/index.php?title=Corridor&amp;action=edit&amp;section=11.html" title="Edit section: done">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>sys-whonix should now be using sys-corridor.
</p>
<h1><span class="mw-headline" id="Debugging">Debugging</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a data-href="/w/index.php?title=Corridor&amp;action=edit&amp;section=12" href="https://www.whonix.org/w/index.php?title=Corridor&amp;action=edit&amp;section=12.html" title="Edit section: Debugging">edit</a><span class="mw-editsection-bracket">]</span></span></h1>
<p>In case you are having issues, this chapter contains snippets on how to gather useful information for debugging. Otherwise you can skip this chapter.
</p><p>See if the <i><span style="background-color:#FBFBFB">corridor_relays</span></i> ipset gets populated.
</p><p></p><div class="codeContainer">
<div class="selectBtnDiv">
<div class="smallText"><a class="selectLink" href="#" onclick="SelectText(this.parentNode.parentNode.parentNode.children[2].children[0]); return false;">[select code]</a></div>
</div>
<div class="preDiv">
<pre>sudo ipset list corridor_relays</pre>
</div>
<div class="textareaDiv">
<textarea class="codeBoxArea" readonly="readonly" rows="1">sudo ipset list corridor_relays</textarea>
</div>
</div>
<p>Please also install the <i><span style="background-color:#FBFBFB">usability-misc</span></i> package from Whonix repository since it provides the <i><span style="background-color:#FBFBFB">iptables-save-deterministic</span></i> command or get it from <a data-href="/wiki/Dev/Firewall_Refactoring" href="./Dev/Firewall_Refactoring.html" title="Dev/Firewall Refactoring">elsewhere</a>.
</p><p></p><div class="codeContainer">
<div class="selectBtnDiv">
<div class="smallText"><a class="selectLink" href="#" onclick="SelectText(this.parentNode.parentNode.parentNode.children[2].children[0]); return false;">[select code]</a></div>
</div>
<div class="preDiv">
<pre>sudo apt-get install usability-misc</pre>
</div>
<div class="textareaDiv">
<textarea class="codeBoxArea" readonly="readonly" rows="1">sudo apt-get install usability-misc</textarea>
</div>
</div>
<p>Run <i><span style="background-color:#FBFBFB">iptables-save-deterministic</span></i>.
</p><p></p><div class="codeContainer">
<div class="selectBtnDiv">
<div class="smallText"><a class="selectLink" href="#" onclick="SelectText(this.parentNode.parentNode.parentNode.children[2].children[0]); return false;">[select code]</a></div>
</div>
<div class="preDiv">
<pre>sudo iptables-save-deterministic</pre>
</div>
<div class="textareaDiv">
<textarea class="codeBoxArea" readonly="readonly" rows="1">sudo iptables-save-deterministic</textarea>
</div>
</div>
<p>Should look like this for Qubes.
</p>
<pre>*nat
:PREROUTING ACCEPT [0,0]
:INPUT ACCEPT [0,0]
:OUTPUT ACCEPT [0,0]
:POSTROUTING ACCEPT [0,0]
:CORRIDOR_SNAT - [0,0]
-A POSTROUTING -j CORRIDOR_SNAT
-A CORRIDOR_SNAT -s 10.137.0.0/16 ! -d 10.137.0.0/16 -j MASQUERADE
COMMIT
*filter
:INPUT ACCEPT [0,0]
:FORWARD ACCEPT [0,0]
:OUTPUT ACCEPT [0,0]
:CORRIDOR_FILTER - [0,0]
-A FORWARD -j CORRIDOR_FILTER
-A CORRIDOR_FILTER -m conntrack --ctstate RELATED,ESTABLISHED -j RETURN
-A CORRIDOR_FILTER -m set --match-set corridor_relays dst,dst -j RETURN
-A CORRIDOR_FILTER -m set --match-set corridor_logged src -j LOG --log-prefix "corridor: reject " --log-macdecode
-A CORRIDOR_FILTER -j REJECT --reject-with icmp-host-prohibited
COMMIT
</pre>
<h1><span class="mw-headline" id="Footnotes">Footnotes</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a data-href="/w/index.php?title=Corridor&amp;action=edit&amp;section=13" href="https://www.whonix.org/w/index.php?title=Corridor&amp;action=edit&amp;section=13.html" title="Edit section: Footnotes">edit</a><span class="mw-editsection-bracket">]</span></span></h1>
<div class="reflist" style="list-style-type: decimal;">
<div class="mw-references-wrap"><ol class="references">
<li id="cite_note-1"><span class="mw-cite-backlink"><a href="#cite_ref-1">↑</a></span> <span class="reference-text">
<a class="external text" data-href="https://phabricator.whonix.org/T524" href="https://phabricator.whonix.org/T524" rel="noreferrer noopener" target="_blank">Corridor for Whonix KVM ticket</a></span>
</li>
<li id="cite_note-2"><span class="mw-cite-backlink"><a href="#cite_ref-2">↑</a></span> <span class="reference-text">
<a class="external free" data-href="https://www.torproject.org/docs/faq.html.en#EntryGuards" href="https://www.torproject.org/docs/faq.html.en" rel="noreferrer noopener" target="_blank">https://www.torproject.org/docs/faq.html.en#EntryGuards</a></span>
</li>
</ol></div></div>
<hr/>
<div style="padding-bottom:1px; padding-top:6px; border:thin solid black; background:#EEEEEE; text-align:center;"><u>Random News:</u>
<p>Want to help create awesome, up-to-date <a data-href="/wiki/Screenshots" href="./Screenshots.html" title="Screenshots">screenshots</a> for the Whonix wiki? Help is most welcome!
</p>
</div>
<hr/><p><font size="-1"><a class="external text" data-href="./Corridor" href="./Corridor" rel="noreferrer noopener" target="_blank">https</a> | (<a data-href="/wiki/Forcing_.onion_on_Whonix.org" href="./Forcing_.onion_on_Whonix.org.html" title="Forcing .onion on Whonix.org">forcing</a>) <a class="external text" data-href="http://dds6qkxpwdeubwucdiaord2xgbbeyds25rbsgr73tbfpqpt4a6vjwsyd.onion/wiki/Corridor" href="http://dds6qkxpwdeubwucdiaord2xgbbeyds25rbsgr73tbfpqpt4a6vjwsyd.onion/wiki/Corridor" rel="noreferrer noopener" target="_blank">onion</a><br/>
</font></p><font size="-1"></font><p><font size="-1">Share: <a data-href="https://twitter.com/intent/tweet?url=./Corridor&amp;text=&amp;via=Whonix" href="https://twitter.com/intent/tweet?url=./Corridor&amp;text=&amp;via=Whonix">Twitter</a>
|
<a data-href="https://facebook.com/sharer.php?u=./Corridor" href="https://facebook.com/sharer.php?u=./Corridor">Facebook</a></font>
</p><p><font size="-1">This is a wiki. Want to improve this page? Help is welcome and volunteer contributions are happily considered! See <a class="external text" data-href="https://github.com/Whonix/Whonix/blob/master/CONTRIBUTING.md" href="https://github.com/Whonix/Whonix/blob/master/CONTRIBUTING.md" rel="noreferrer noopener" target="_blank">Conditions for Contributions to Whonix</a>, then <a data-href="/w/index.php?title=Corridor&amp;action=edit" href="https://www.whonix.org/w/index.php?title=Corridor&amp;action=edit">Edit</a>! IP addresses are scrubbed, but editing over Tor is recommended. Edits are held for moderation.</font>
</p><p><font size="-1">Whonix is a <a class="external text" data-href="http://www.openinventionnetwork.com/licensees.php" href="http://www.openinventionnetwork.com/licensees.php" rel="noreferrer noopener" target="_blank">licensee</a> of the Open Invention Network. Unless otherwise noted, the content of this page is <a data-href="/wiki/Whonix:Copyrights" href="./Whonix:Copyrights.html" title="Whonix:Copyrights">copyrighted</a> and licensed under the same Libre Software <a class="external text" data-href="https://github.com/Whonix/Whonix/blob/master/debian/copyright" href="https://github.com/Whonix/Whonix/blob/master/debian/copyright" rel="noreferrer noopener" target="_blank">license</a> as Whonix itself. (<a data-href="/wiki/Why_Whonix_is_Free_Software" href="./Why_Whonix_is_Free_Software.html" title="Why Whonix is Free Software">Why?</a>)</font>
</p>
<!-- 
NewPP limit report
Cached time: 20180825092519
Cache expiry: 0
Dynamic content: true
CPU time usage: 0.140 seconds
Real time usage: 0.147 seconds
Preprocessor visited node count: 904/1000000
Preprocessor generated node count: 5214/1000000
Post‐expand include size: 12266/2097152 bytes
Template argument size: 4579/2097152 bytes
Highest expansion depth: 17/40
Expensive parser function count: 0/100
Unstrip recursion depth: 0/20
Unstrip post‐expand size: 2251/5000000 bytes
-->
<!--
Transclusion expansion time report (%,ms,calls,template)
100.00%  107.226      1 -total
 41.46%   44.454     17 Template:CodeSelect
 17.93%   19.230      1 Template:Mbox
 14.57%   15.618      1 Template:Ambox
 11.24%   12.048      1 Template:Footer
 11.24%   12.048      2 Template:Box
  8.93%    9.575      1 Template:Whonix-APT-Repository-Add
  8.19%    8.780      1 Template:Category_handler
  7.97%    8.543      1 Template:Open_with_root_rights
  6.25%    6.705      1 Template:Open_File
-->
</div></div><div class="printfooter">
Retrieved from "<a data-href="https://www.whonix.org/w/index.php?title=Corridor&amp;oldid=35544" dir="ltr" href="https://www.whonix.org/w/index.php?title=Corridor&amp;oldid=35544">https://www.whonix.org/w/index.php?title=Corridor&amp;oldid=35544</a>"</div>
<div class="clear_both"></div>
</div>
<div class="group"><div class="catlinks" data-mw="interface" id="catlinks"><div class="mw-normal-catlinks" id="mw-normal-catlinks"><a data-href="/wiki/Special:Categories" href="./Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a data-href="/wiki/Category:Documentation" href="./Category:Documentation.html" title="Category:Documentation">Documentation</a></li></ul></div></div></div>
</div>
</div>
</div>
<footer class="row">
<div id="footer">
<div class="small-12 large-centered columns text-center" id="footer-left">
<ul id="footer-left">
<li id="footer-lastmod"> This page was last edited on 9 August 2018, at 21:03.</li>
<li id="footer-Priority_Support"><a data-href="/wiki/Priority_Support" href="./Priority_Support.html" title="Priority Support">Priority Support</a></li>
<li id="footer-Investors"><a data-href="/wiki/Investors" href="./Investors.html" title="Investors">Investors</a></li>
<li id="footer-Professional_Support"><a data-href="/wiki/Professional_Support" href="./Professional_Support.html" title="Professional Support">Professional Support</a></li>
</ul>
</div>
<div class="large-12 small-12 columns" id="footer-right-icons">
<ul id="poweredby">
</ul>
</div>
</div>
</footer>
</div>

</body>
<!-- Cached/compressed 20180825092519 -->
</html>
