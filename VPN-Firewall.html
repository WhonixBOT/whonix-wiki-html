<!DOCTYPE html>
<html class="client-nojs" dir="ltr" lang="en"><!-- 
 single html processed by https://github.com/zTrix/webpage2html
 title: VPN-Firewall - enforces that your VPN gets actually used - Whonix
 url: ./VPN-Firewall
 date: Mon Oct 15 08:14:51 2018
-->
<head>
<meta charset="utf-8"/>
<title>VPN-Firewall - enforces that your VPN gets actually used - Whonix</title>
<link rel="stylesheet" type="text/css" href="style.css">




<meta content="" name="ResourceLoaderDynamicStyles"/>

<meta content="MediaWiki 1.31.1" name="generator"/>
<meta content="" name="google-site-verification"/>
<meta content="https://www.whonix.org/w/images/1/1e/Vpnfirewall-29940640.png" name="image"/>
<meta content="https://www.whonix.org/w/images/1/1e/Vpnfirewall-29940640.png" name="twitter:image:src"/>
<meta content="summary_large_image" name="twitter:card"/>
<meta content="@Whonix" name="twitter:site"/>
<meta content="Whonix" name="twitter:domain"/>
<meta content="@Whonix" name="twitter:creator"/>
<meta content="Instructions on how to use VPN-Firewall. A Fail Closed Mechanism for VPNs. Prevent leaks when using VPNs. Force all connections through VPNs. Prevents..." name="description"/>
<meta content="Instructions on how to use VPN-Firewall. A Fail Closed Mechanism for VPNs. Prevent leaks when using VPNs. Force all connections through VPNs. Prevents..." name="twitter:description"/>
<meta content="width=device-width, user-scalable=yes, initial-scale=1.0" name="viewport"/>
<link data-href="/w/index.php?title=VPN-Firewall&amp;action=edit" href="https://www.whonix.org/w/index.php?title=VPN-Firewall&amp;action=edit" rel="alternate.html" title="Edit" type="application/x-wiki"/>
<link data-href="/w/index.php?title=VPN-Firewall&amp;action=edit" href="https://www.whonix.org/w/index.php?title=VPN-Firewall&amp;action=edit" rel="edit.html" title="Edit"/>
<link data-href="/favicon.ico" href="data:image/x-icon;base64,AAABAAEAEBAAAAEAIABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOPj4wC5q6j/xba0/8W2tP+3qab/4+PiBQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAALyurP/Ku7n/yru5/8q7uf/Ku7n/yru5/8q7uf+6rKr/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAALyurP/Ku7n/yru5/8CohP/VnhL/1Z4S/8CohP/Ku7n/yru5/7mrqf8AAAAAAAAAAAAAAAAAAAAAAAAAAI6Mi//Ku7n/yru5/8GRHP/iqhL/////////////////wJEd/8q7uf/Ku7n/xsXE/wAAAAAAAAAAAAAAAAAAAAC5q6n/yru5/8q7uf/hqRH//////0bcy/9G3Mv//////+GpEf/Ku7n/yru5/7qsqv8AAAAAAAAAAAAAAAAAAAAAxLW0/8q7uf/Ku7n/4qoS/////////////////0bcy//iqhL/yru5/8q7uf/Gt7T/AAAAAAAAAAAAAAAAAAAAAMKzsP/Ku7n/yru5/96lFf//////RtzL/0bcy///////3qUV/8q7uf/Ku7n/wrWy/wAAAAAAAAAAAAAAAAAAAACvo6D/yru5/8q7uf/Ku7n/4akQ//fnvP/57tD/4akQ/8q7uf/Ku7n/yru5/7Gkov8AAAAAAAAAAAAAAAAAAAAAAAAAAMq7uf/Ku7n/yru5/8q7uf/hqRD/4akQ/8q7uf/Ku7n/yru5/8q7uf8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACOjIv/yru5/8q7uf/Ku7n/yru5/8q7uf/Ku7n/yru5/8q7uf+Mioj/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAISDgf/Iurj/yru5/8q7uf/Ku7n/yru5/8i5uP+EgoH/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAC6rKr/q56c/wAAAACOjIv/joyL/wAAAACom5r/taim/wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAuqyp/66hnv8AAAAAAAAAAAAAAAAAAAAAqp2b/7SnpP8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAKmcm/+9r6z/AAAAAAAAAAAAAAAAAAAAALmrqf+jl5b/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwLOw/6uenP8AAAAAAAAAAKqenP+/sq//AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACtoJ7/vK2r/72vrP+sn57/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/D8AAPAPAADgBwAAwAMAAMADAADAAwAAwAMAAMADAADgBwAA4AcAAPAPAADyTwAA888AAPPPAAD5nwAA/D8AAA==" rel="shortcut icon"/>
<link data-href="/w/opensearch_desc.php" href="https://www.whonix.org/w/opensearch_desc.php" rel="search.html" title="Whonix (en)" type="application/opensearchdescription+xml"/>
<link data-href="https://www.whonix.org/w/api.php?action=rsd" href="https://www.whonix.org/w/api.php?action=rsd" rel="EditURI" type="application/rsd+xml"/>
<link data-href="/w/index.php?title=Special:RecentChanges&amp;feed=atom" href="https://www.whonix.org/w/index.php?title=Special:RecentChanges&amp;feed=atom" rel="alternate.html" title="Whonix Atom feed" type="application/atom+xml"/>
<meta content="article" property="og:type"/>
<meta content="Whonix" property="og:site_name"/>
<meta content="VPN-Firewall" property="og:title"/>
<meta content="./VPN-Firewall" property="og:url"/>
<meta content="https://www.whonix.org/w/images/1/1e/Vpnfirewall-29940640.png" property="og:image"/>
<meta content="Instructions on how to use VPN-Firewall. A Fail Closed Mechanism for VPNs. Prevent leaks when using VPNs. Force all connections through VPNs. Prevents..." property="og:description"/>

<meta content="" property="fb:app_id"/>
<meta content="" property="fb:admins"/>
<meta content="https://www.facebook.com/Whonix" property="article:author"/>
<meta content="https://www.facebook.com/Whonix" property="article:publisher"/>
<meta content="IE=edge" http-equiv="X-UA-Compatible"/>
<!--[if lt IE 9]><script src="/w/load.php?debug=false&amp;lang=en&amp;modules=html5shiv&amp;only=scripts&amp;skin=foreground&amp;sync=1"></script><![endif]-->
</head>
<body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-VPN-Firewall rootpage-VPN-Firewall skin-foreground action-view"><div id="navwrapper"><!-- START FOREGROUNDTEMPLATE -->

</div>
<div id="page-content">
<div class="row">
<div class="large-12 columns">
<!-- Output page indicators -->
<div class="mw-indicators mw-body-content">
</div>
<!-- If user is logged in output echo location -->
<!--[if lt IE 9]>
				<div id="siteNotice" class="sitenotice panel radius">Whonix may not look as expected in this version of Internet Explorer. We recommend you upgrade to a newer version of Internet Explorer or switch to a browser like Firefox or Chrome.</div>
				<![endif]-->
<div class="sitenotice" id="siteNotice"><div dir="ltr" id="localNotice" lang="en"><div class="mw-parser-output"><p><style type="text/css">

#banner {
 position: relative;
 overflow: hidden;
 margin-bottom: 0.5em !important;
 margin-top: 0.5em !important;
 background-color:#D03232;
 border: solid 1px #aaaaaa; 
 height:66px;
}

#banner a.cn-full-banner-click {
 display:block;
 height:100%;
 width:100%;
 cursor: pointer;
}


#banner-logo {
 position: absolute;
 top: 8px;
 left: 15px;
 background-image: url(data:image/png;base64,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);
 height: 50px;
 width: 100%;
 background-repeat: no-repeat;
}

#banner #black-text {
 font-size: 1.1em;
 color: white;
 padding: 0.5em 40px 0.4em 60px;
 line-height: 1.3em;
 text-align: center;
}
</style>
</p><div id="banner">
<a class="cn-full-banner-click" data-href="/wiki/Payments" href="./Payments.html" title="">
<div id="banner-logo"></div>
<div id="black-text">
Whonix requires payments to stay alive.
     </div>
</a>
</div>
</div></div></div> </div>
</div>
<div id="mw-js-message" style="display:none;"></div>
<div class="row">
<div class="large-12 columns" id="p-cactions">
<a class="button small secondary radius" data-dropdown="actions" data-options="align:left; is_hover: true; hover_timeout:700" href="#" id="actions-button"><i class="fa fa-cog"><span class="show-for-medium-up"> Actions</span></i></a>
<!--RTL -->
<ul class="f-dropdown" data-dropdown-content="" id="actions">
<li class="selected" id="ca-nstab-main"><a accesskey="c" data-href="/wiki/VPN-Firewall" href="./VPN-Firewall.html" title="View the content page [c]">Page</a></li><li class="new" id="ca-talk"><a accesskey="t" data-href="/w/index.php?title=Talk:VPN-Firewall&amp;action=edit&amp;redlink=1" href="https://www.whonix.org/w/index.php?title=Talk:VPN-Firewall&amp;action=edit&amp;redlink=1" rel="discussion.html" title="Discussion about the content page (page does not exist) [t]">Discussion</a></li><li id="ca-edit"><a accesskey="e" data-href="/w/index.php?title=VPN-Firewall&amp;action=edit" href="https://www.whonix.org/w/index.php?title=VPN-Firewall&amp;action=edit.html" title="Edit this page [e]">Edit</a></li><li id="ca-history"><a accesskey="h" data-href="/w/index.php?title=VPN-Firewall&amp;action=history" href="https://www.whonix.org/w/index.php?title=VPN-Firewall&amp;action=history.html" title="Past revisions of this page [h]">History</a></li> </ul>
<!--RTL -->
<div id="content">
<h1 class="title" id="firstHeading">VPN-Firewall - enforces that your VPN gets actually used</h1>
<h5 class="subtitle" id="siteSub"></h5>
<div class="clear_both" id="contentSub"></div>
<div class="mw-bodytext" id="bodyContent">
<div class="mw-content-ltr" dir="ltr" id="mw-content-text" lang="en"><div class="mw-parser-output">
<h1><span class="mw-headline" id="Why">Why</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a data-href="/w/index.php?title=VPN-Firewall&amp;action=edit&amp;section=1" href="https://www.whonix.org/w/index.php?title=VPN-Firewall&amp;action=edit&amp;section=1.html" title="Edit section: Why">edit</a><span class="mw-editsection-bracket">]</span></span></h1>
<p>If you simply add a VPN using common instructions, it generally fails open. That means, if the VPN breaks down, because the connection is interrupted, traffic will be send without the VPN.
</p><p>It’s much safer when it fails closed, i.e. when the VPN connection breaks down, the whole internet connection must be down as long as the VPN connection isn’t restored.
</p>
<h1><span class="mw-headline" id="What_does_it_do">What does it do</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a data-href="/w/index.php?title=VPN-Firewall&amp;action=edit&amp;section=2" href="https://www.whonix.org/w/index.php?title=VPN-Firewall&amp;action=edit&amp;section=2.html" title="Edit section: What does it do">edit</a><span class="mw-editsection-bracket">]</span></span></h1>
<ul><li>Forbid outgoing traffic after the VPN / tunnel software broke down for some reason.</li>
<li>Tight firewall rules, using iptables policy drop.</li>
<li>Defeat <a class="external text" data-href="https://github.com/adrelanos/vpn-firewall/issues/12" href="https://github.com/adrelanos/vpn-firewall/issues/12" rel="noreferrer noopener" target="_blank">shared VPN/Tor server leak bug</a>.</li>
<li>Only tested with OpenVPN. Should work with other VPN and tunnel clients such as PPTP in theory, you should test if it does what it claims anyway.</li>
<li>Only tested on Debian stretch. Should work in many Linux distribution supporting netfilter-persistent in theory, you should test if it does what it claims.</li>
<li>Open Source / Free Software</li></ul>
<h1><span class="mw-headline" id="What_does_it_NOT_do">What does it NOT do</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a data-href="/w/index.php?title=VPN-Firewall&amp;action=edit&amp;section=3" href="https://www.whonix.org/w/index.php?title=VPN-Firewall&amp;action=edit&amp;section=3.html" title="Edit section: What does it NOT do">edit</a><span class="mw-editsection-bracket">]</span></span></h1>
<ul><li>Care about DNS leaks. If you want to ensure that no plaintext nameserver request packets are being leaked over the course of your VPN session then you will need to analyze the packets leaving your hardware NIC.</li>
<li>Block WebRTC leaks. [1]</li>
<li>Defend against <a class="external text" data-href="https://blog.torproject.org/blog/bittorrent-over-tor-isnt-good-idea" href="https://blog.torproject.org/blog/bittorrent-over-tor-isnt-good-idea" rel="noreferrer noopener" target="_blank">IP leaks</a>. If a locally installed application uses trickery to obtain the the users real IP and sends it somewhere though the VPN. [1]</li>
<li>Defend against adversaries, which are in position to run code locally, i.e. manipulate the firewall rules.</li>
<li>Prevent any other kind trickery to circumvent using the VPN.</li>
<li>Prevent leaks caused by bugs in the VPN software.</li>
<li>Be compatible with Whonix-Gateway/Workstation. (VPN-Firewall is incompatible with Whonix-Gateway/Workstation’s firewall! Use Whonix documentation and use their built-in features.)</li>
<li>Manage IPv6 traffic. IPv6 traffic is blocked.</li>
<li>Install (Open)VPN.</li>
<li>Configure (Open)VPN.</li>
<li>Autostart (Open)VPN.</li>
<li>Anything else not mentioned above in “What does it do”.</li></ul>
<p>[1] This probably does not apply to VMs / computers behind a VPN-Gateway (when using the <a href="#Forwarding">#Forwarding</a> feature).
</p>
<table class="plainlinks metadata ambox ambox-notice" role="presentation"><tbody><tr><td class="mbox-image"><div style="width:52px"><a class="image" data-href="/w/index.php?title=File:Ambox_warning_pn.svg.png&amp;filetimestamp=20130717200816&amp;" href="https://www.whonix.org/w/index.php?title=File:Ambox_warning_pn.svg.png&amp;filetimestamp=20130717200816&amp;"><img alt="Ambox warning pn.svg.png" data-src="/w/images/thumb/f/f7/Ambox_warning_pn.svg.png/40px-Ambox_warning_pn.svg.png" data-srcset="/w/images/thumb/f/f7/Ambox_warning_pn.svg.png/60px-Ambox_warning_pn.svg.png 1.5x, /w/images/thumb/f/f7/Ambox_warning_pn.svg.png/80px-Ambox_warning_pn.svg.png 2x" height="35" src="data:image/png;base64,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" width="40"/></a></div></td><td class="mbox-text"><div class="mbox-text-span">You should test if VPN-Firewall does what it claims.</div></td></tr></tbody></table>
<table class="plainlinks metadata ambox ambox-notice" role="presentation"><tbody><tr><td class="mbox-image"><div style="width:52px"><a class="image" data-href="/w/index.php?title=File:Ambox_warning_pn.svg.png&amp;filetimestamp=20130717200816&amp;" href="https://www.whonix.org/w/index.php?title=File:Ambox_warning_pn.svg.png&amp;filetimestamp=20130717200816&amp;"><img alt="Ambox warning pn.svg.png" data-src="/w/images/thumb/f/f7/Ambox_warning_pn.svg.png/40px-Ambox_warning_pn.svg.png" data-srcset="/w/images/thumb/f/f7/Ambox_warning_pn.svg.png/60px-Ambox_warning_pn.svg.png 1.5x, /w/images/thumb/f/f7/Ambox_warning_pn.svg.png/80px-Ambox_warning_pn.svg.png 2x" height="35" src="data:image/png;base64,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" width="40"/></a></div></td><td class="mbox-text"><div class="mbox-text-span">Use VPN-Firewall outside of Whonix only! (Whonix users should use the built-in VPN_FIREWALL features of Whonix-Gateway and/or Whonix-Workstation, see <a data-href="/wiki/Tunnels/Introduction" href="./Tunnels/Introduction.html" title="Tunnels/Introduction">Tunnels/Introduction</a> and its sub pages for documentation.)</div></td></tr></tbody></table>
<div class="toc" id="toc"><div class="toctitle" dir="ltr" lang="en"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Why"><span class="tocnumber">1</span> <span class="toctext">Why</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#What_does_it_do"><span class="tocnumber">2</span> <span class="toctext">What does it do</span></a></li>
<li class="toclevel-1 tocsection-3"><a href="#What_does_it_NOT_do"><span class="tocnumber">3</span> <span class="toctext">What does it NOT do</span></a></li>
<li class="toclevel-1 tocsection-4"><a href="#How_to_use_VPN-Firewall"><span class="tocnumber">4</span> <span class="toctext">How to use VPN-Firewall</span></a>
<ul>
<li class="toclevel-2 tocsection-5"><a href="#Preparation"><span class="tocnumber">4.1</span> <span class="toctext">Preparation</span></a></li>
<li class="toclevel-2 tocsection-6"><a href="#Remove_old_versions_of_VPN-Firewall"><span class="tocnumber">4.2</span> <span class="toctext">Remove old versions of VPN-Firewall</span></a></li>
<li class="toclevel-2 tocsection-7"><a href="#Qubes_specific"><span class="tocnumber">4.3</span> <span class="toctext">Qubes specific</span></a></li>
<li class="toclevel-2 tocsection-8"><a href="#VPN_Setup"><span class="tocnumber">4.4</span> <span class="toctext">VPN Setup</span></a>
<ul>
<li class="toclevel-3 tocsection-9"><a href="#Introduction"><span class="tocnumber">4.4.1</span> <span class="toctext">Introduction</span></a></li>
<li class="toclevel-3 tocsection-10"><a href="#Get_VPN_Certificate"><span class="tocnumber">4.4.2</span> <span class="toctext">Get VPN Certificate</span></a></li>
<li class="toclevel-3 tocsection-11"><a href="#VPN_Credentials"><span class="tocnumber">4.4.3</span> <span class="toctext">VPN Credentials</span></a></li>
<li class="toclevel-3 tocsection-12"><a href="#VPN_IP_Address"><span class="tocnumber">4.4.4</span> <span class="toctext">VPN IP Address</span></a></li>
<li class="toclevel-3 tocsection-13"><a href="#VPN_Configuration_File"><span class="tocnumber">4.4.5</span> <span class="toctext">VPN Configuration File</span></a></li>
<li class="toclevel-3 tocsection-14"><a href="#install_resolvconf"><span class="tocnumber">4.4.6</span> <span class="toctext">install resolvconf</span></a></li>
<li class="toclevel-3 tocsection-15"><a href="#DNS_Configuration"><span class="tocnumber">4.4.7</span> <span class="toctext">DNS Configuration</span></a></li>
<li class="toclevel-3 tocsection-16"><a href="#add_user_account_tunnel"><span class="tocnumber">4.4.8</span> <span class="toctext">add user account tunnel</span></a></li>
<li class="toclevel-3 tocsection-17"><a href="#Configure_Folder_Permissions"><span class="tocnumber">4.4.9</span> <span class="toctext">Configure Folder Permissions</span></a></li>
<li class="toclevel-3 tocsection-18"><a href="#systemd_setup"><span class="tocnumber">4.4.10</span> <span class="toctext">systemd setup</span></a></li>
<li class="toclevel-3 tocsection-19"><a href="#resolvconf_adjustments"><span class="tocnumber">4.4.11</span> <span class="toctext">resolvconf adjustments</span></a></li>
<li class="toclevel-3 tocsection-20"><a href="#Verify_DNS_Settings"><span class="tocnumber">4.4.12</span> <span class="toctext">Verify DNS Settings</span></a></li>
<li class="toclevel-3 tocsection-21"><a href="#Test_the_VPN"><span class="tocnumber">4.4.13</span> <span class="toctext">Test the VPN</span></a></li>
<li class="toclevel-3 tocsection-22"><a href="#Install_VPN-Firewall"><span class="tocnumber">4.4.14</span> <span class="toctext">Install VPN-Firewall</span></a></li>
<li class="toclevel-3 tocsection-23"><a href="#Forwarding"><span class="tocnumber">4.4.15</span> <span class="toctext">Forwarding</span></a></li>
<li class="toclevel-3 tocsection-24"><a href="#Start_VPN-Firewall"><span class="tocnumber">4.4.16</span> <span class="toctext">Start VPN-Firewall</span></a></li>
<li class="toclevel-3 tocsection-25"><a href="#Test_VPN-Firewall"><span class="tocnumber">4.4.17</span> <span class="toctext">Test VPN-Firewall</span></a></li>
<li class="toclevel-3 tocsection-26"><a href="#Qubes_specific_-_Fallback_Firewall"><span class="tocnumber">4.4.18</span> <span class="toctext">Qubes specific - Fallback Firewall</span></a></li>
<li class="toclevel-3 tocsection-27"><a href="#Done"><span class="tocnumber">4.4.19</span> <span class="toctext">Done</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-1 tocsection-28"><a href="#Appendix"><span class="tocnumber">5</span> <span class="toctext">Appendix</span></a>
<ul>
<li class="toclevel-2 tocsection-29"><a href="#Troubleshooting"><span class="tocnumber">5.1</span> <span class="toctext">Troubleshooting</span></a>
<ul>
<li class="toclevel-3"><a href="#ip_unpriv_vs_ip-unpriv"><span class="tocnumber">5.1.1</span> <span class="toctext">ip_unpriv vs  ip-unpriv</span></a></li>
<li class="toclevel-3"><a href="#50_openvpn_unpriv.conf_vs_50_openvpn-unpriv.conf"><span class="tocnumber">5.1.2</span> <span class="toctext">50_openvpn_unpriv.conf vs 50_openvpn-unpriv.conf</span></a></li>
<li class="toclevel-3"><a href="#Cannot_ioctl_TUNSETIFF"><span class="tocnumber">5.1.3</span> <span class="toctext">Cannot ioctl TUNSETIFF</span></a></li>
<li class="toclevel-3"><a href="#Dev_tun_Mismatch"><span class="tocnumber">5.1.4</span> <span class="toctext">Dev tun Mismatch</span></a></li>
<li class="toclevel-3"><a href="#.2Frun.2Fopenvpn.2Fopenvpn.status_Permission_denied"><span class="tocnumber">5.1.5</span> <span class="toctext">/run/openvpn/openvpn.status Permission denied</span></a></li>
<li class="toclevel-3"><a href="#debug_start"><span class="tocnumber">5.1.6</span> <span class="toctext">debug start</span></a></li>
<li class="toclevel-3"><a href="#Linux_ip_link_set_failed"><span class="tocnumber">5.1.7</span> <span class="toctext">Linux ip link set failed</span></a></li>
<li class="toclevel-3"><a href="#DNS_Configuration_2"><span class="tocnumber">5.1.8</span> <span class="toctext">DNS Configuration</span></a></li>
<li class="toclevel-3"><a href="#Terminology_for_Support_Requests"><span class="tocnumber">5.1.9</span> <span class="toctext">Terminology for Support Requests</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-30"><a href="#Unload_VPN_Firewall"><span class="tocnumber">5.2</span> <span class="toctext">Unload VPN Firewall</span></a></li>
<li class="toclevel-2 tocsection-31"><a href="#Security_Discussion"><span class="tocnumber">5.3</span> <span class="toctext">Security Discussion</span></a></li>
<li class="toclevel-2 tocsection-32"><a href="#Alternatives"><span class="tocnumber">5.4</span> <span class="toctext">Alternatives</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-33"><a href="#Footnotes"><span class="tocnumber">6</span> <span class="toctext">Footnotes</span></a></li>
</ul>
</div>
<h1><span class="mw-headline" id="How_to_use_VPN-Firewall">How to use VPN-Firewall</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a data-href="/w/index.php?title=VPN-Firewall&amp;action=edit&amp;section=4" href="https://www.whonix.org/w/index.php?title=VPN-Firewall&amp;action=edit&amp;section=4.html" title="Edit section: How to use VPN-Firewall">edit</a><span class="mw-editsection-bracket">]</span></span></h1>
<h2><span class="mw-headline" id="Preparation">Preparation</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a data-href="/w/index.php?title=VPN-Firewall&amp;action=edit&amp;section=5" href="https://www.whonix.org/w/index.php?title=VPN-Firewall&amp;action=edit&amp;section=5.html" title="Edit section: Preparation">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>Since setting up OpenVPN including a secure, leak preventing fail closed mechanism is challenging, it is highly recommend to learn how to set up OpenVPN on Debian stable (currently: stretch). Get a Debian stable VM. Install the Debian openvpn package. (sudo apt-get install openvpn) Figure out how to set up your VPN using OpenVPN in the command line. Only proceed if you succeeded setting that up. Do not post support requests regarding these instructions before you succeeded with that basic exercise. You find some help with general VPN setup in the <a href="#VPN_Setup">#VPN Setup</a> chapter or on the <a class="mw-redirect" data-href="/wiki/TestVPN" href="./TestVPN.html" title="TestVPN">TestVPN</a> page. There however are ways to get <a data-href="/wiki/Support" href="./Support.html" title="Support">help</a> from various sources for that basic exercise, also your VPN provider may be of assistance.
</p><p>Existing users who upgrade may remember variable VPN_SERVERS. Don't wonder. That variable was abolished for better security. <sup class="reference" id="cite_ref-1"><a href="#cite_note-1">[1]</a></sup>
</p>
<h2><span class="mw-headline" id="Remove_old_versions_of_VPN-Firewall">Remove old versions of VPN-Firewall</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a data-href="/w/index.php?title=VPN-Firewall&amp;action=edit&amp;section=6" href="https://www.whonix.org/w/index.php?title=VPN-Firewall&amp;action=edit&amp;section=6.html" title="Edit section: Remove old versions of VPN-Firewall">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>If you had any installed. Otherwise you can skip this.
</p>
<pre>sudo update-rc.d vpnfirewall remove
sudo update-rc.d vpn-firewall remove
sudo rm /usr/local/bin/vpnfirewall
sudo rm /usr/bin/vpnfirewall
sudo rm /usr/bin/vpn-firewall
sudo rm /etc/init.d/vpnfirewall
sudo rm /etc/init.d/vpn-firewall
</pre>
<h2><span class="mw-headline" id="Qubes_specific">Qubes specific</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a data-href="/w/index.php?title=VPN-Firewall&amp;action=edit&amp;section=7" href="https://www.whonix.org/w/index.php?title=VPN-Firewall&amp;action=edit&amp;section=7.html" title="Edit section: Qubes specific">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>Non-Qubes users can ignore this.
</p><p>1) If you are using <a class="external text" data-href="https://www.qubes-os.org" href="https://www.qubes-os.org" rel="noreferrer noopener" target="_blank">Qubes OS</a> as your host operating system, it is recommended to use a StandaloneVM for this. For more information, see footnote. <sup class="reference" id="cite_ref-2"><a href="#cite_note-2">[2]</a></sup>
</p><p>2) Enable netfilter-persistent Qubes qvm-service.
</p>
<pre>Qubes VM Manager -&gt; right click on VM -&gt; services -&gt; enter (without the single quotes) 'netfilter-persistent' -&gt; click on + -&gt; OK
</pre>
<h2><span class="mw-headline" id="VPN_Setup">VPN Setup</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a data-href="/w/index.php?title=VPN-Firewall&amp;action=edit&amp;section=8" href="https://www.whonix.org/w/index.php?title=VPN-Firewall&amp;action=edit&amp;section=8.html" title="Edit section: VPN Setup">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<h6><span class="mw-headline" id="Introduction">Introduction</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a data-href="/w/index.php?title=VPN-Firewall&amp;action=edit&amp;section=9" href="https://www.whonix.org/w/index.php?title=VPN-Firewall&amp;action=edit&amp;section=9.html" title="Edit section: Introduction">edit</a><span class="mw-editsection-bracket">]</span></span></h6>
<p>The following example uses the free Riseup VPN, because it is known to support TCP, UDP and SSL. However, any preferred VPN can be used.
</p><p>Update: The Riseup "legacy" VPN may have been discontinued, as it no longer works for the author of these instructions. The Riseup replacement service (Bitmask) has not been tested.
</p>
<h6><span class="mw-headline" id="Get_VPN_Certificate">Get VPN Certificate</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a data-href="/w/index.php?title=VPN-Firewall&amp;action=edit&amp;section=10" href="https://www.whonix.org/w/index.php?title=VPN-Firewall&amp;action=edit&amp;section=10.html" title="Edit section: Get VPN Certificate">edit</a><span class="mw-editsection-bracket">]</span></span></h6>
<p>Look at the <a class="external text" data-href="https://help.riseup.net/vpn" href="https://help.riseup.net/vpn" rel="noreferrer noopener" target="_blank">riseup VPN help page</a> for <a class="external text" data-href="https://help.riseup.net/en/riseup-ca" href="https://help.riseup.net/en/riseup-ca" rel="noreferrer noopener" target="_blank"><code>RiseupCA.pem</code></a> and (right-click) <a class="external text" data-href="https://help.riseup.net/security/network-security/riseup-ca/RiseupCA.pem" href="https://help.riseup.net/security/network-security/riseup-ca/RiseupCA.pem" rel="noreferrer noopener" target="_blank">download</a> it. Store the certificate in <i><span style="background-color:#FBFBFB">/etc/openvpn/RiseupCA.pem</span></i>
</p><p></p><div class="codeContainerNew">
<div class="preDiv">
<pre>curl --tlsv1.2 --proto =https https://help.riseup.net/security/network-security/riseup-ca/RiseupCA.pem | sudo tee /etc/openvpn/RiseupCA.pem</pre>
</div>
<div class="textareaDiv">
<textarea class="codeBoxAreaNew" onfocus="this.select()" readonly="readonly" rows="1">curl --tlsv1.2 --proto =https https://help.riseup.net/security/network-security/riseup-ca/RiseupCA.pem | sudo tee /etc/openvpn/RiseupCA.pem</textarea>
</div>
</div>
<h6><span class="mw-headline" id="VPN_Credentials">VPN Credentials</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a data-href="/w/index.php?title=VPN-Firewall&amp;action=edit&amp;section=11" href="https://www.whonix.org/w/index.php?title=VPN-Firewall&amp;action=edit&amp;section=11.html" title="Edit section: VPN Credentials">edit</a><span class="mw-editsection-bracket">]</span></span></h6>
<p>For this step, a riseup.net account and Riseup account name is required. Go to <a class="external free" data-href="https://user.riseup.net/users/riseupusername/vpn" href="https://user.riseup.net/users/riseupusername/vpn" rel="noreferrer noopener" target="_blank">https://user.riseup.net/users/riseupusername/vpn</a> to obtain a VPN secret (VPN password). Below, replace "riseupusername" with the actual riseup user name, or just go to <a class="external free" data-href="https://user.riseup.net" href="https://user.riseup.net" rel="noreferrer noopener" target="_blank">https://user.riseup.net</a>, login and click on "VPN". 
</p><p>Open <i><span style="background-color:#FBFBFB">/etc/openvpn/auth.txt</span></i> in an editor with root rights.
</p>
<div style="background: #F8F8F8; border: 2px; padding: 5px; margin: 10px; border-style: solid; border-color: black; width: 100%">
<p><u>If you are using a graphical Whonix or <a data-href="/wiki/Qubes" href="./Qubes.html" title="Qubes">Qubes-Whonix</a></u>, run.
</p><div class="codeContainerNew">
<div class="preDiv">
<pre>kdesudo kwrite /etc/openvpn/auth.txt</pre>
</div>
<div class="textareaDiv">
<textarea class="codeBoxAreaNew" onfocus="this.select()" readonly="readonly" rows="1">kdesudo kwrite /etc/openvpn/auth.txt</textarea>
</div>
</div>
<p><u>If you are using a terminal-only Whonix</u>, run.
</p><div class="codeContainerNew">
<div class="preDiv">
<pre>sudo nano /etc/openvpn/auth.txt</pre>
</div>
<div class="textareaDiv">
<textarea class="codeBoxAreaNew" onfocus="this.select()" readonly="readonly" rows="1">sudo nano /etc/openvpn/auth.txt</textarea>
</div>
</div>
</div>
<p>Add the <i>actual</i> user name and password.
</p>
<pre>riseupusername
vpnsecret
</pre>
<p>Save and exit.
</p>
<h6><span class="mw-headline" id="VPN_IP_Address">VPN IP Address</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a data-href="/w/index.php?title=VPN-Firewall&amp;action=edit&amp;section=12" href="https://www.whonix.org/w/index.php?title=VPN-Firewall&amp;action=edit&amp;section=12.html" title="Edit section: VPN IP Address">edit</a><span class="mw-editsection-bracket">]</span></span></h6>
<p>Note: IP addresses are required, not DNS hostnames. Therefore, <i><span style="background-color:#FBFBFB">vpn.riseup.net</span></i> cannot be used, but an IP address instead like <i><span style="background-color:#FBFBFB">198.252.153.226</span></i>. To discover the IP address, check with the provider or use nslookup on the host. For example, to verify the actual IP address of the <i><span style="background-color:#FBFBFB">vpn.riseup.net</span></i> DNS server, run.
</p>
<pre>nslookup vpn.riseup.net
</pre>
<h6><span class="mw-headline" id="VPN_Configuration_File">VPN Configuration File</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a data-href="/w/index.php?title=VPN-Firewall&amp;action=edit&amp;section=13" href="https://www.whonix.org/w/index.php?title=VPN-Firewall&amp;action=edit&amp;section=13.html" title="Edit section: VPN Configuration File">edit</a><span class="mw-editsection-bracket">]</span></span></h6>
<p>Open <i><span style="background-color:#FBFBFB">/etc/openvpn/openvpn.conf</span></i> in an editor with root rights.
</p>
<div style="background: #F8F8F8; border: 2px; padding: 5px; margin: 10px; border-style: solid; border-color: black; width: 100%">
<p><u>If you are using a graphical Whonix or <a data-href="/wiki/Qubes" href="./Qubes.html" title="Qubes">Qubes-Whonix</a></u>, run.
</p><div class="codeContainerNew">
<div class="preDiv">
<pre>kdesudo kwrite /etc/openvpn/openvpn.conf</pre>
</div>
<div class="textareaDiv">
<textarea class="codeBoxAreaNew" onfocus="this.select()" readonly="readonly" rows="1">kdesudo kwrite /etc/openvpn/openvpn.conf</textarea>
</div>
</div>
<p><u>If you are using a terminal-only Whonix</u>, run.
</p><div class="codeContainerNew">
<div class="preDiv">
<pre>sudo nano /etc/openvpn/openvpn.conf</pre>
</div>
<div class="textareaDiv">
<textarea class="codeBoxAreaNew" onfocus="this.select()" readonly="readonly" rows="1">sudo nano /etc/openvpn/openvpn.conf</textarea>
</div>
</div>
</div>
<p>Add.
</p><p>Note: make sure to adjust the <span style="border:1px dotted #005cb9">remote 198.252.153.226 80</span> variable in your config (unless you are using <span style="border:1px dotted #005cb9">nyc.vpn.riseup.net</span> as your VPN service). Replace the IP (<span style="border:1px dotted #005cb9">198.252.153.226</span>) and port (<span style="border:1px dotted #005cb9">80</span>) to match your VPN service.
</p>
<pre>##############################
## VPN provider specific settings ##
##############################
auth-user-pass auth.txt

## using nyc.vpn.riseup.net 80
remote 198.252.153.226 80

ca RiseupCA.pem

remote-cert-tls server
keysize 256
auth SHA256
cipher AES-256-CBC

#############################
## VPN-Firewall specific settings ##
#############################

client
dev tun0

persist-tun
persist-key

script-security 2
up "/etc/openvpn/update-resolv-conf script_type=up dev=tun0"
down "/etc/openvpn/update-resolv-conf script_type=down dev=tun0"
</pre>
<p>Save.
</p>
<h6><span class="mw-headline" id="install_resolvconf">install resolvconf</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a data-href="/w/index.php?title=VPN-Firewall&amp;action=edit&amp;section=14" href="https://www.whonix.org/w/index.php?title=VPN-Firewall&amp;action=edit&amp;section=14.html" title="Edit section: install resolvconf">edit</a><span class="mw-editsection-bracket">]</span></span></h6>
<p><a class="mw-redirect" data-href="/wiki/Update" href="./Update.html" title="Update">Update</a> the package lists.
</p>
<pre>sudo apt-get update
</pre>
<p>Install resolvconf. <sup class="reference" id="cite_ref-3"><a href="#cite_note-3">[3]</a></sup>
</p>
<pre>sudo apt-get install resolvconf
</pre>
<p>Users preferring not to install resolvconf should read the footnotes. <sup class="reference" id="cite_ref-4"><a href="#cite_note-4">[4]</a></sup>
</p>
<h6><span class="mw-headline" id="DNS_Configuration">DNS Configuration</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a data-href="/w/index.php?title=VPN-Firewall&amp;action=edit&amp;section=15" href="https://www.whonix.org/w/index.php?title=VPN-Firewall&amp;action=edit&amp;section=15.html" title="Edit section: DNS Configuration">edit</a><span class="mw-editsection-bracket">]</span></span></h6>
<p>Open <i><span style="background-color:#FBFBFB">/etc/resolvconf/run/interface/original.resolvconf</span></i> in an editor with root rights.
</p>
<div style="background: #F8F8F8; border: 2px; padding: 5px; margin: 10px; border-style: solid; border-color: black; width: 100%">
<p><u>If you are using a graphical Whonix or <a data-href="/wiki/Qubes" href="./Qubes.html" title="Qubes">Qubes-Whonix</a></u>, run.
</p><div class="codeContainerNew">
<div class="preDiv">
<pre>kdesudo kwrite /etc/resolvconf/run/interface/original.resolvconf</pre>
</div>
<div class="textareaDiv">
<textarea class="codeBoxAreaNew" onfocus="this.select()" readonly="readonly" rows="1">kdesudo kwrite /etc/resolvconf/run/interface/original.resolvconf</textarea>
</div>
</div>
<p><u>If you are using a terminal-only Whonix</u>, run.
</p><div class="codeContainerNew">
<div class="preDiv">
<pre>sudo nano /etc/resolvconf/run/interface/original.resolvconf</pre>
</div>
<div class="textareaDiv">
<textarea class="codeBoxAreaNew" onfocus="this.select()" readonly="readonly" rows="1">sudo nano /etc/resolvconf/run/interface/original.resolvconf</textarea>
</div>
</div>
</div>
<p>Comment everything out by adding a <i>#</i> in front of all entries. Alternatively, empty or delete that file. <sup class="reference" id="cite_ref-5"><a href="#cite_note-5">[5]</a></sup>
</p><p>Save and exit.
</p>
<h6><span class="mw-headline" id="add_user_account_tunnel">add user account tunnel</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a data-href="/w/index.php?title=VPN-Firewall&amp;action=edit&amp;section=16" href="https://www.whonix.org/w/index.php?title=VPN-Firewall&amp;action=edit&amp;section=16.html" title="Edit section: add user account tunnel">edit</a><span class="mw-editsection-bracket">]</span></span></h6>
<pre>sudo adduser tunnel
</pre>
<h6><span class="mw-headline" id="Configure_Folder_Permissions">Configure Folder Permissions</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a data-href="/w/index.php?title=VPN-Firewall&amp;action=edit&amp;section=17" href="https://www.whonix.org/w/index.php?title=VPN-Firewall&amp;action=edit&amp;section=17.html" title="Edit section: Configure Folder Permissions">edit</a><span class="mw-editsection-bracket">]</span></span></h6>
<p>Since OpenVPN will be run under user <i>tunnel</i>, that user requires read access to the folder <i>/etc/openvpn</i>.
</p>
<pre>sudo chown -R tunnel:tunnel /etc/openvpn
</pre>
<pre>sudo chown -R tunnel:tunnel /var/run/openvpn
</pre>
<h6><span class="mw-headline" id="systemd_setup">systemd setup</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a data-href="/w/index.php?title=VPN-Firewall&amp;action=edit&amp;section=18" href="https://www.whonix.org/w/index.php?title=VPN-Firewall&amp;action=edit&amp;section=18.html" title="Edit section: systemd setup">edit</a><span class="mw-editsection-bracket">]</span></span></h6>
<p>Create the OpenVPN systemd service file.
</p>
<pre>sudo cp /lib/systemd/system/openvpn@.service /lib/systemd/system/openvpn@openvpn.service
</pre>
<p>Enable the OpenVPN systemd service file.
</p>
<pre>sudo systemctl enable openvpn@openvpn
</pre>
<p>Start the OpenVPN systemd service.
</p>
<pre>sudo systemctl start openvpn@openvpn
</pre>
<p>Check the OpenVPN systemd service status.
</p>
<pre>sudo systemctl status openvpn@openvpn
</pre>
<h5><span class="mw-headline" id="resolvconf_adjustments">resolvconf adjustments</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a data-href="/w/index.php?title=VPN-Firewall&amp;action=edit&amp;section=19" href="https://www.whonix.org/w/index.php?title=VPN-Firewall&amp;action=edit&amp;section=19.html" title="Edit section: resolvconf adjustments">edit</a><span class="mw-editsection-bracket">]</span></span></h5>
<p>Restart resolvconf. <sup class="reference" id="cite_ref-6"><a href="#cite_note-6">[6]</a></sup>
</p>
<pre>sudo service resolvconf restart
</pre>
<h5><span class="mw-headline" id="Verify_DNS_Settings">Verify DNS Settings</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a data-href="/w/index.php?title=VPN-Firewall&amp;action=edit&amp;section=20" href="https://www.whonix.org/w/index.php?title=VPN-Firewall&amp;action=edit&amp;section=20.html" title="Edit section: Verify DNS Settings">edit</a><span class="mw-editsection-bracket">]</span></span></h5>
<p>See current /etc/resolv.conf settings.
</p>
<pre>sudo cat /etc/resolv.conf
</pre>
<p>Should not include your original DNS settings.
</p>
<h5><span class="mw-headline" id="Test_the_VPN">Test the VPN</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a data-href="/w/index.php?title=VPN-Firewall&amp;action=edit&amp;section=21" href="https://www.whonix.org/w/index.php?title=VPN-Firewall&amp;action=edit&amp;section=21.html" title="Edit section: Test the VPN">edit</a><span class="mw-editsection-bracket">]</span></span></h5>
<p>Ping test. Ping some IP. In the example below, we ping google's DNS server. Maybe better use some server of your choice.
</p>
<pre>ping 8.8.8.8
</pre>
<p>Test TCP.
</p>
<pre>TODO
</pre>
<p>DNS Test.
</p>
<pre>nslookup google.com
</pre>
<p>Test DNS and output IP address. Remember these results so you can compare it to what you get later after VPN-Firewall is installed and running.
</p><p></p><div class="codeContainerNew">
<div class="preDiv">
<pre>scurl --remote-name myip.is</pre>
</div>
<div class="textareaDiv">
<textarea class="codeBoxAreaNew" onfocus="this.select()" readonly="readonly" rows="1">scurl --remote-name myip.is</textarea>
</div>
</div>
<p>Or manually run <i>curl</i> with these parameters. <sup class="reference" id="cite_ref-7"><a href="#cite_note-7">[7]</a></sup>
</p><p></p><div class="codeContainerNew">
<div class="preDiv">
<pre>curl --tlsv1.2 --proto =https --remote-name myip.is</pre>
</div>
<div class="textareaDiv">
<textarea class="codeBoxAreaNew" onfocus="this.select()" readonly="readonly" rows="1">curl --tlsv1.2 --proto =https --remote-name myip.is</textarea>
</div>
</div>
<p><br/>
</p>
<h5><span class="mw-headline" id="Install_VPN-Firewall">Install VPN-Firewall</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a data-href="/w/index.php?title=VPN-Firewall&amp;action=edit&amp;section=22" href="https://www.whonix.org/w/index.php?title=VPN-Firewall&amp;action=edit&amp;section=22.html" title="Edit section: Install VPN-Firewall">edit</a><span class="mw-editsection-bracket">]</span></span></h5>
<pre>sudo apt-get install debhelper faketime make dpkg-dev devscripts netfilter-persistent git config-package-dev ruby-ronn
</pre>
<pre>git clone https://github.com/adrelanos/vpn-firewall.git
</pre>
<pre>cd vpn-firewall
</pre>
<p>Signed git tags and commits available. TODO: document how to verify, use some wiki template
</p>
<pre>make deb-icup
</pre>
<h5><span class="mw-headline" id="Forwarding">Forwarding</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a data-href="/w/index.php?title=VPN-Firewall&amp;action=edit&amp;section=23" href="https://www.whonix.org/w/index.php?title=VPN-Firewall&amp;action=edit&amp;section=23.html" title="Edit section: Forwarding">edit</a><span class="mw-editsection-bracket">]</span></span></h5>
<p>If you want to forward traffic for virtual machines (or other computers on the LAN), it can be enabled through an option.
</p>
<table class="plainlinks metadata ambox ambox-notice" role="presentation"><tbody><tr><td class="mbox-image"><div style="width:52px"><a class="image" data-href="/w/index.php?title=File:Ambox_warning_pn.svg.png&amp;filetimestamp=20130717200816&amp;" href="https://www.whonix.org/w/index.php?title=File:Ambox_warning_pn.svg.png&amp;filetimestamp=20130717200816&amp;"><img alt="Ambox warning pn.svg.png" data-src="/w/images/thumb/f/f7/Ambox_warning_pn.svg.png/40px-Ambox_warning_pn.svg.png" data-srcset="/w/images/thumb/f/f7/Ambox_warning_pn.svg.png/60px-Ambox_warning_pn.svg.png 1.5x, /w/images/thumb/f/f7/Ambox_warning_pn.svg.png/80px-Ambox_warning_pn.svg.png 2x" height="35" src="data:image/png;base64,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" width="40"/></a></div></td><td class="mbox-text"><div class="mbox-text-span">Experimental! (The forwarding feature has not yet been tested for leaks!)</div></td></tr></tbody></table>
<table class="plainlinks metadata ambox ambox-notice" role="presentation"><tbody><tr><td class="mbox-image"><div style="width:52px"><a class="image" data-href="/w/index.php?title=File:Ambox_warning_pn.svg.png&amp;filetimestamp=20130717200816&amp;" href="https://www.whonix.org/w/index.php?title=File:Ambox_warning_pn.svg.png&amp;filetimestamp=20130717200816&amp;"><img alt="Ambox warning pn.svg.png" data-src="/w/images/thumb/f/f7/Ambox_warning_pn.svg.png/40px-Ambox_warning_pn.svg.png" data-srcset="/w/images/thumb/f/f7/Ambox_warning_pn.svg.png/60px-Ambox_warning_pn.svg.png 1.5x, /w/images/thumb/f/f7/Ambox_warning_pn.svg.png/80px-Ambox_warning_pn.svg.png 2x" height="35" src="data:image/png;base64,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" width="40"/></a></div></td><td class="mbox-text"><div class="mbox-text-span">The forwarding feature has only been developed and tested in a Qubes ProxyVM. Non-Qubes is <a data-href="/wiki/FAQ#What_do_you_mean_by_unsupported.3F" href="./FAQ.html" title="FAQ">unsupported</a>!</div></td></tr></tbody></table>
<p>(The forwarding feature was introduced in May 29 2016. You might need to update vpn-firewall.)
</p><p>Create a new folder.
</p>
<ul><li>Qubes users: run the following command.</li>
<li>Non-Qubes users: can skip this.</li></ul>
<pre>sudo mkdir -p /rw/config/vpn-firewall.d/
</pre>
<p>Create a new file.
</p>
<ul><li>Qubes users: /rw/config/vpn-firewall.d/50_user.conf</li>
<li>Non-Qubes users: /etc/vpn-firewall.d/50_user.conf</li></ul>
<p>Add.
</p>
<pre>FORWARDING=true
</pre>
<p>Save.
</p>
<h5><span class="mw-headline" id="Start_VPN-Firewall">Start VPN-Firewall</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a data-href="/w/index.php?title=VPN-Firewall&amp;action=edit&amp;section=24" href="https://www.whonix.org/w/index.php?title=VPN-Firewall&amp;action=edit&amp;section=24.html" title="Edit section: Start VPN-Firewall">edit</a><span class="mw-editsection-bracket">]</span></span></h5>
<p>Qubes users only: create qvm-service netfilter-persistent status file.
</p>
<pre>sudo touch /var/run/qubes-service/netfilter-persistent
</pre>
<p>Start VPN-Firewall by restarting netfilter-persistent. <sup class="reference" id="cite_ref-8"><a href="#cite_note-8">[8]</a></sup>
</p>
<pre>sudo service netfilter-persistent restart
</pre>
<p>Check netfilter-persistent status.
</p>
<pre>sudo service netfilter-persistent status
</pre>
<p>Should look like the following.
</p>
<pre>● netfilter-persistent.service - netfilter persistent configuration
   Loaded: loaded (/lib/systemd/system/netfilter-persistent.service; enabled)
  Drop-In: /lib/systemd/system/netfilter-persistent.service.d
           └─30_qubes.conf
   Active: active (exited) since Wed 2016-05-11 19:21:36 UTC; 2s ago
  Process: 3950 ExecStop=/usr/sbin/netfilter-persistent stop (code=exited, status=1/FAILURE)
  Process: 3954 ExecStart=/usr/sbin/netfilter-persistent start (code=exited, status=0/SUCCESS)
 Main PID: 3954 (code=exited, status=0/SUCCESS)

May 11 19:21:36 work netfilter-persistent[3954]: run-parts: executing /usr/share/netfilter-persistent/plugins.d/30_vpn-firewall start
May 11 19:21:36 work netfilter-persistent[3954]: OK: The firewall should not show any messages,
May 11 19:21:36 work netfilter-persistent[3954]: OK: besides output beginning with prefix OK:...
May 11 19:21:36 work netfilter-persistent[3954]: OK: VPN firewall loaded.
May 11 19:21:36 work systemd[1]: Started netfilter persistent configuration.
</pre>
<p>(There will only be a 30_qubes.conf drop-in for Qubes users. Non-Qubes users can ignore this.)
</p><p>At next boot, VPN-Firewall should be automatically starting. It would not hurt to check it really does by checking netfilter-persistent status at next boot.
</p>
<h5><span class="mw-headline" id="Test_VPN-Firewall">Test VPN-Firewall</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a data-href="/w/index.php?title=VPN-Firewall&amp;action=edit&amp;section=25" href="https://www.whonix.org/w/index.php?title=VPN-Firewall&amp;action=edit&amp;section=25.html" title="Edit section: Test VPN-Firewall">edit</a><span class="mw-editsection-bracket">]</span></span></h5>
<p>1) Have VPN-Firewall set up as per above instructions.
</p><p>2) Test if it works. Check whatismyipaddress.com to see if you your external IP is from the VPN. Check your DNS using dnsleaktest.com as well and compare these results to the results you had earlier. If your nameserver is the same as before or does not match your VPN's DNS then there is a problem and you will need to troubleshoot.
</p><p>3) Kill the VPN client.
</p><p>Example OpenVPN:
</p>
<pre>sudo killall openvpn
</pre>
<p>4) Check if you can still connect to whatismyipaddress.com.
</p><p>If yes, bad, something is wrong.
</p><p>If no, good, you won't connect to any remote servers.
</p>
<h5><span class="mw-headline" id="Qubes_specific_-_Fallback_Firewall">Qubes specific - Fallback Firewall</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a data-href="/w/index.php?title=VPN-Firewall&amp;action=edit&amp;section=26" href="https://www.whonix.org/w/index.php?title=VPN-Firewall&amp;action=edit&amp;section=26.html" title="Edit section: Qubes specific - Fallback Firewall">edit</a><span class="mw-editsection-bracket">]</span></span></h5>
<p>Qubes users only. Non-Qubes users can skip this chapter.
</p><p>Untested! Please test and leave feedback!
</p><p>The following is great for users for additional protection from leaks. This fallback is as safe as previous ways to firewall VPNs. It however would not defeat the <a class="external text" data-href="https://github.com/adrelanos/vpn-firewall/issues/12" href="https://github.com/adrelanos/vpn-firewall/issues/12" rel="noreferrer noopener" target="_blank">shared VPN/Tor server leak bug</a>. (It however is awful for developers since this would cloak eventual leaks in VPN-Firewall.)
</p>
<pre>Qubes VM Manager -&gt; sys-vpn -&gt; right click -&gt; VM Settings -&gt; Firewall rules -&gt; choose "deny all network access except..." -&gt; add the IP and port of your VPN server -&gt; OK
</pre>
<h5><span class="mw-headline" id="Done">Done</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a data-href="/w/index.php?title=VPN-Firewall&amp;action=edit&amp;section=27" href="https://www.whonix.org/w/index.php?title=VPN-Firewall&amp;action=edit&amp;section=27.html" title="Edit section: Done">edit</a><span class="mw-editsection-bracket">]</span></span></h5>
<p>Done.
</p>
<h1><span class="mw-headline" id="Appendix">Appendix</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a data-href="/w/index.php?title=VPN-Firewall&amp;action=edit&amp;section=28" href="https://www.whonix.org/w/index.php?title=VPN-Firewall&amp;action=edit&amp;section=28.html" title="Edit section: Appendix">edit</a><span class="mw-editsection-bracket">]</span></span></h1>
<h5><span class="mw-headline" id="Troubleshooting">Troubleshooting</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a data-href="/w/index.php?title=VPN-Firewall&amp;action=edit&amp;section=29" href="https://www.whonix.org/w/index.php?title=VPN-Firewall&amp;action=edit&amp;section=29.html" title="Edit section: Troubleshooting">edit</a><span class="mw-editsection-bracket">]</span></span></h5>
<p>You can skip this troubleshooting chapter unless any difficulties are encountered.
</p>
<h6><span class="mw-headline" id="ip_unpriv_vs_ip-unpriv">ip_unpriv vs  ip-unpriv</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a data-href="/w/index.php?title=Template:VPN-Firewall/Troubleshooting&amp;action=edit&amp;section=T-1" href="https://www.whonix.org/w/index.php?title=Template:VPN-Firewall/Troubleshooting&amp;action=edit&amp;section=T-1.html" title="Edit section: ">edit</a><span class="mw-editsection-bracket">]</span></span></h6>
<p>There are two similar, yet distinct projects: standalone VPN-FIREWALL and Whonix TUNNEL_FIREWALL. Although both are alike, there is one difference that might be encountered. For instance, in chapter <a href="#VPN_Configuration_File">#VPN Configuration File</a>:
</p>
<ul><li>Whonix TUNNEL_FIREWALL uses <i><span style="background-color:#FBFBFB">ip<b>_</b>unpriv</span></i> (underscore)</li>
<li>Standalone VPN-FIREWALL uses <i><span style="background-color:#FBFBFB">ip<b>-</b>unpriv</span></i> (hyphen)</li></ul>
<p><br/>
Be sure to use the right version of ip unpriv according to whether the VPN-FIREWALL or Whonix TUNNEL_FIREWALL project is being used.
</p>
<h6><span class="mw-headline" id="50_openvpn_unpriv.conf_vs_50_openvpn-unpriv.conf">50_openvpn_unpriv.conf vs 50_openvpn-unpriv.conf</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a data-href="/w/index.php?title=Template:VPN-Firewall/Troubleshooting&amp;action=edit&amp;section=T-2" href="https://www.whonix.org/w/index.php?title=Template:VPN-Firewall/Troubleshooting&amp;action=edit&amp;section=T-2.html" title="Edit section: ">edit</a><span class="mw-editsection-bracket">]</span></span></h6>
<p>Like the example above:
</p>
<ul><li>Whonix TUNNEL_FIREWALL uses /usr/lib/tmpfiles.d/50_openvpn_unpriv.conf <i><span style="background-color:#FBFBFB">ip<b>_</b>unpriv</span></i> (underscore)</li>
<li>Standalone VPN-FIREWALL uses  /usr/lib/tmpfiles.d/50_openvpn-unpriv.conf <i><span style="background-color:#FBFBFB">ip<b>-</b>unpriv</span></i> (hyphen)</li></ul>
<h6><span class="mw-headline" id="Cannot_ioctl_TUNSETIFF">Cannot ioctl TUNSETIFF</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a data-href="/w/index.php?title=Template:VPN-Firewall/Troubleshooting&amp;action=edit&amp;section=T-3" href="https://www.whonix.org/w/index.php?title=Template:VPN-Firewall/Troubleshooting&amp;action=edit&amp;section=T-3.html" title="Edit section: ">edit</a><span class="mw-editsection-bracket">]</span></span></h6>
<pre>ERROR: Cannot ioctl TUNSETIFF tun: Operation not permitted (errno=1)
</pre>
<p>In openvpn.conf do not use.
</p>
<pre>dev tun
</pre>
<p>Use.
</p>
<pre>dev tun0
</pre>
<h6><span class="mw-headline" id="Dev_tun_Mismatch">Dev tun Mismatch</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a data-href="/w/index.php?title=Template:VPN-Firewall/Troubleshooting&amp;action=edit&amp;section=T-4" href="https://www.whonix.org/w/index.php?title=Template:VPN-Firewall/Troubleshooting&amp;action=edit&amp;section=T-4.html" title="Edit section: ">edit</a><span class="mw-editsection-bracket">]</span></span></h6>
<p>In openvpn.conf do not use.
</p>
<pre>dev tun
</pre>
<p>Use.
</p>
<pre>dev tun0
</pre>
<h6><span id="/run/openvpn/openvpn.status_Permission_denied"></span><span class="mw-headline" id=".2Frun.2Fopenvpn.2Fopenvpn.status_Permission_denied">/run/openvpn/openvpn.status Permission denied</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a data-href="/w/index.php?title=Template:VPN-Firewall/Troubleshooting&amp;action=edit&amp;section=T-5" href="https://www.whonix.org/w/index.php?title=Template:VPN-Firewall/Troubleshooting&amp;action=edit&amp;section=T-5.html" title="Edit section: ">edit</a><span class="mw-editsection-bracket">]</span></span></h6>
<pre>Options error: --status fails with '/run/openvpn/openvpn.status': Permission denied
</pre>
<p>Do not start OpenVPN as root. Do not use <i>sudo openvpn</i>, because this will lead to permission issues. Files in the <i>/run/openvpn</i> folder are owned by root, so they cannot be overwritten by the user tunnel.
</p>
<h6><span class="mw-headline" id="debug_start">debug start</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a data-href="/w/index.php?title=Template:VPN-Firewall/Troubleshooting&amp;action=edit&amp;section=T-6" href="https://www.whonix.org/w/index.php?title=Template:VPN-Firewall/Troubleshooting&amp;action=edit&amp;section=T-6.html" title="Edit section: ">edit</a><span class="mw-editsection-bracket">]</span></span></h6>
<p>To debug start on the command line, run.
</p>
<pre>sudo /usr/sbin/openvpn --rmtun --dev tun0
sudo /usr/sbin/openvpn --mktun --dev tun0 --dev-type tun --user tunnel --group tunnel
cd /etc/openvpn/
sudo -u tunnel openvpn /etc/openvpn/openvpn.conf
</pre>
<h6><span class="mw-headline" id="Linux_ip_link_set_failed">Linux ip link set failed</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a data-href="/w/index.php?title=Template:VPN-Firewall/Troubleshooting&amp;action=edit&amp;section=T-7" href="https://www.whonix.org/w/index.php?title=Template:VPN-Firewall/Troubleshooting&amp;action=edit&amp;section=T-7.html" title="Edit section: ">edit</a><span class="mw-editsection-bracket">]</span></span></h6>
<pre>Linux ip link set failed: external program exited with error status: 2
</pre>
<p>Use ip_unpriv as documented above.
</p>
<h6><span class="mw-headline" id="DNS_Configuration_2">DNS Configuration</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a data-href="/w/index.php?title=Template:VPN-Firewall/Troubleshooting&amp;action=edit&amp;section=T-8" href="https://www.whonix.org/w/index.php?title=Template:VPN-Firewall/Troubleshooting&amp;action=edit&amp;section=T-8.html" title="Edit section: ">edit</a><span class="mw-editsection-bracket">]</span></span></h6>
<p>This only applies if resolvconf is used.
</p><p>Permissions on two directories may need to be manually changed if they are not automatically applied. Check if changes are necessary via the following command.
</p>
<pre>ls -al /run/resolvconf
</pre>
<p>If the output lists tunnel as having read / write / execute permissions for both <i>/run/resolvconf</i> and <i>/run/resolvconf/interface</i>, then nothing needs modification. If tunnel is not listed as a group for one or both of these directories, then permissions need to be changed. In that case, run.
</p>
<pre>sudo chown --recursive root:tunnel /run/resolvconf
</pre>
<p>Then set the necessary permissions.
</p>
<pre>sudo chmod --recursive 775 /run/resolvconf
</pre>
<p>In <i>/run/resolvconf</i>, resolv.conf may or may not be owned by tunnel, depending on whether the systemd service has already started. There is no need to modify permissions on this file, as the permissions will change when the service starts.
</p>
<h6><span class="mw-headline" id="Terminology_for_Support_Requests">Terminology for Support Requests</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a data-href="/w/index.php?title=Template:VPN-Firewall/Troubleshooting&amp;action=edit&amp;section=T-9" href="https://www.whonix.org/w/index.php?title=Template:VPN-Firewall/Troubleshooting&amp;action=edit&amp;section=T-9.html" title="Edit section: ">edit</a><span class="mw-editsection-bracket">]</span></span></h6>
<p>Phrases such as "over Tor" are ambiguous. Please do not coin idiosyncratic words or phrases, otherwise this leads to confusion. Please use the same terms that are consistently referenced in documentation, such as:
</p>
<ul><li>How to Connect to a VPN Before Tor (User -&gt; VPN -&gt; Tor -&gt; Internet).</li>
<li>How to Connect to Tor Before a VPN (User -&gt; Tor -&gt; VPN -&gt; Internet).</li>
<li>And so on.</li></ul>
<p><br/>
Always refer to the connection scheme when requesting support: <i><span style="background-color:#FBFBFB">User -&gt; VPN -&gt; Tor -&gt; Internet</span></i> or <i><span style="background-color:#FBFBFB">User -&gt; Tor -&gt; VPN -&gt; Internet</span></i> and so on.
</p>
<h5><span class="mw-headline" id="Unload_VPN_Firewall">Unload VPN Firewall</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a data-href="/w/index.php?title=VPN-Firewall&amp;action=edit&amp;section=30" href="https://www.whonix.org/w/index.php?title=VPN-Firewall&amp;action=edit&amp;section=30.html" title="Edit section: Unload VPN Firewall">edit</a><span class="mw-editsection-bracket">]</span></span></h5>
<p>How to unload VPN Firewall? If you know what you are doing... Either...
</p>
<pre>sudo /usr/share/netfilter-persistent/plugins.d/30_vpn-firewall flush
</pre>
<p>Or...
</p>
<pre>sudo service netfilter-persistent flush
</pre>
<p><br/>
</p>
<h5><span class="mw-headline" id="Security_Discussion">Security Discussion</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a data-href="/w/index.php?title=VPN-Firewall&amp;action=edit&amp;section=31" href="https://www.whonix.org/w/index.php?title=VPN-Firewall&amp;action=edit&amp;section=31.html" title="Edit section: Security Discussion">edit</a><span class="mw-editsection-bracket">]</span></span></h5>
<p>Statement by the creator of VPN-Firewall, Patrick Schleizer.
</p><p>I don't think I can ever make this standalone VPN-Firewall  project as leak proof as Whonix as is. This is because I invented VPN-Firewall alone from scratch - in comparison Whonix was an evolution of existing previous documentation and created by multiple contributors. Also VPN-Firewall is younger, receives less attention by the community, and a lot more difficult to set up than Whonix. All these factors lead to lower popularity and thereby less eyes on the implementation. Specifically the <a href="#Forwarding">#Forwarding</a> feature should be activated with care, since it is my first project using IP forwarding. If you have any suggestions on how to avoid IP forwarding, please make them.
</p>
<h5><span class="mw-headline" id="Alternatives">Alternatives</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a data-href="/w/index.php?title=VPN-Firewall&amp;action=edit&amp;section=32" href="https://www.whonix.org/w/index.php?title=VPN-Firewall&amp;action=edit&amp;section=32.html" title="Edit section: Alternatives">edit</a><span class="mw-editsection-bracket">]</span></span></h5>
<ul><li>One could play with the linux equivalent of the <a class="external text" data-href="http://cranthetrader.blogspot.se/2011/10/dont-allow-non-vpn-traffic.html" href="http://cranthetrader.blogspot.se/2011/10/dont-allow-non-vpn-traffic.html" rel="noreferrer noopener" target="_blank">route</a> command.</li>
<li><a class="external text" data-href="http://www.inputoutput.io/hardening-your-vpn-setup-with-iptables/" href="http://www.inputoutput.io/hardening-your-vpn-setup-with-iptables/" rel="noreferrer noopener" target="_blank">Hardening your VPN Setup with iptables</a></li>
<li><a class="external text" data-href="http://www.guavi.com/vpncheck_free.html" href="http://www.guavi.com/vpncheck_free.html" rel="noreferrer noopener" target="_blank">VPNCheck</a> - No source code. Nice looking user interface.</li>
<li><a class="external text" data-href="http://vpnetmon.webs.com/" href="http://vpnetmon.webs.com/" rel="noreferrer noopener" target="_blank">VPNetMon</a> - No source code. Windows only. Checks every, let’s say 500 ms, if the VPN IP is still valid, if not, kill a list of applications. This is not very secure, it’s a game if that time period is sufficient to stop a leak and if killing the applications is fast enough. Nice looking user interface.</li>
<li><a class="external text" data-href="http://openvpnchecker.com/" href="http://openvpnchecker.com/" rel="noreferrer noopener" target="_blank">OPENVPN Watchdog</a> - No source code. Windows only. Nice looking user interface.</li>
<li><a class="external text" data-href="https://sourceforge.net/projects/vpnlife" href="https://sourceforge.net/projects/vpnlife" rel="noreferrer noopener" target="_blank">VPN Lifeguard</a></li>
<li><a class="external text" data-href="https://zorrovpn.com/articles/windows-firewall-vpn-only" href="https://zorrovpn.com/articles/windows-firewall-vpn-only" rel="noreferrer noopener" target="_blank">Windows firewall</a>. Windows only.</li>
<li><a class="external text" data-href="https://superuser.com/questions/268902/how-to-block-all-traffic-but-one-ip-in-windows-firewall" href="https://superuser.com/questions/268902/how-to-block-all-traffic-but-one-ip-in-windows-firewall" rel="noreferrer noopener" target="_blank">IP Security Policies</a>. Windows only.</li></ul>
<h1><span class="mw-headline" id="Footnotes">Footnotes</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a data-href="/w/index.php?title=VPN-Firewall&amp;action=edit&amp;section=33" href="https://www.whonix.org/w/index.php?title=VPN-Firewall&amp;action=edit&amp;section=33.html" title="Edit section: Footnotes">edit</a><span class="mw-editsection-bracket">]</span></span></h1>
<div class="reflist" style="list-style-type: decimal;">
<div class="mw-references-wrap"><ol class="references">
<li id="cite_note-1"><span class="mw-cite-backlink"><a href="#cite_ref-1">↑</a></span> <span class="reference-text"><a class="external free" data-href="https://phabricator.whonix.org/T460" href="https://phabricator.whonix.org/T460" rel="noreferrer noopener" target="_blank">https://phabricator.whonix.org/T460</a></span>
</li>
<li id="cite_note-2"><span class="mw-cite-backlink"><a href="#cite_ref-2">↑</a></span> <span class="reference-text">
This is due to technical limitations. The VPN-Firewall instructions assume to modify a files located in the root image, which by default do not persist in TemplateBasedVMs. So a convenient one time setup and then having it just work including autostart of VPN-Firewall and OpenVPN will not work yet. Help welcome!

In future, perhaps the following instructions could be made to work after some <a class="external text" data-href="https://github.com/marmarek/qubes-core-agent-linux/blob/master/vm-systemd/bind-dirs.sh" href="https://github.com/marmarek/qubes-core-agent-linux/blob/master/vm-systemd/bind-dirs.sh" rel="noreferrer noopener" target="_blank">bind-dirs.sh</a> enhancements.

When using a TemplateBasedVM, to persist these changes use the Qubes bind dirs mechanism.

<pre>sudo mkdir /rw/config/qubes-bind-dirs.d
</pre>
<p>Open <i><span style="background-color:#FBFBFB">/rw/config/qubes-bind-dirs.d/50_user.conf</span></i> in an editor with root rights.
</p>
<div style="background: #F8F8F8; border: 2px; padding: 5px; margin: 10px; border-style: solid; border-color: black; width: 100%">
<p><u>If you are using a graphical Whonix or <a data-href="/wiki/Qubes" href="./Qubes.html" title="Qubes">Qubes-Whonix</a></u>, run.
</p><div class="codeContainerNew">
<div class="preDiv">
<pre>kdesudo kwrite /rw/config/qubes-bind-dirs.d/50_user.conf</pre>
</div>
<div class="textareaDiv">
<textarea class="codeBoxAreaNew" onfocus="this.select()" readonly="readonly" rows="1">kdesudo kwrite /rw/config/qubes-bind-dirs.d/50_user.conf</textarea>
</div>
</div>
<p><u>If you are using a terminal-only Whonix</u>, run.
</p><div class="codeContainerNew">
<div class="preDiv">
<pre>sudo nano /rw/config/qubes-bind-dirs.d/50_user.conf</pre>
</div>
<div class="textareaDiv">
<textarea class="codeBoxAreaNew" onfocus="this.select()" readonly="readonly" rows="1">sudo nano /rw/config/qubes-bind-dirs.d/50_user.conf</textarea>
</div>
</div>
</div>
<pre>binds+=( '/etc/openvpn' )
binds+=( '/lib/systemd/system/openvpn@openvpn.service' )
binds+=( '/etc/systemd/system/multi-user.target.wants/openvpn@openvpn.service' )
</pre>
<p>TODO: Does not work yet. Files need to exist first.
</p><p>TODO: umount during run is probably not sane.
</p>
<pre>/usr/lib/qubes/bind-dirs.sh umount
</pre>
<p>TODO: re-running bind-dirs.sh without previous umount does not work yet.
</p>
<pre>/usr/lib/qubes/bind-dirs.sh
</pre></span>
</li>
<li id="cite_note-3"><span class="mw-cite-backlink"><a href="#cite_ref-3">↑</a></span> <span class="reference-text">
<i>/etc/openvpn/update-resolv-conf</i> uses resolvconf.

resolvconf needs to be installed for the lines beginning with <i>script-security</i>, <i>up</i>, and <i>down</i> to function properly.</span>
</li>
<li id="cite_note-4"><span class="mw-cite-backlink"><a href="#cite_ref-4">↑</a></span> <span class="reference-text">
In the <i>/etc/openvpn/openvpn.conf</i> file, change the following text.

<pre>script-security 2
up "/etc/openvpn/update-resolv-conf script_type=up dev=tun0"
down "/etc/openvpn/update-resolv-conf script_type=down dev=tun0"
</pre>
<p>To the following. Remove or comment out the lines beginning with "up" and "down", and change the 2 to a 1.
</p>
<pre>script-security 1
</pre>
<p>Open <i><span style="background-color:#FBFBFB">/etc/resolv.conf</span></i> in an editor with root rights.
</p>
<div style="background: #F8F8F8; border: 2px; padding: 5px; margin: 10px; border-style: solid; border-color: black; width: 100%">
<p><u>If you are using a graphical Whonix or <a data-href="/wiki/Qubes" href="./Qubes.html" title="Qubes">Qubes-Whonix</a></u>, run.
</p><div class="codeContainerNew">
<div class="preDiv">
<pre>kdesudo kwrite /etc/resolv.conf</pre>
</div>
<div class="textareaDiv">
<textarea class="codeBoxAreaNew" onfocus="this.select()" readonly="readonly" rows="1">kdesudo kwrite /etc/resolv.conf</textarea>
</div>
</div>
<p><u>If you are using a terminal-only Whonix</u>, run.
</p><div class="codeContainerNew">
<div class="preDiv">
<pre>sudo nano /etc/resolv.conf</pre>
</div>
<div class="textareaDiv">
<textarea class="codeBoxAreaNew" onfocus="this.select()" readonly="readonly" rows="1">sudo nano /etc/resolv.conf</textarea>
</div>
</div>
</div>
<p>Comment out.
</p>
<pre>#nameserver 10.152.152.10
</pre>
<p>Add.
</p>
<pre>## Riseup.net OpenVPN DNS server
nameserver 172.27.100.1
</pre>
<p>If Riseup is not being used, replace 172.27.100.1 with the virtual LAN IP address of the VPN provider's DNS server. If unsure, the VPN provider might provide it. Users can also try to infer it by running <i>sudo route</i> after successfully connecting to the VPN. The first destination default gateway should also function as a DNS server.
</p><p>Save and exit.
</p><p>Users who want to prevent <i>/etc/resolv.conf</i> being overwritten by other packages like DHCP or resolvconf should run.
</p>
<pre>sudo chattr +i /etc/resolv.conf
</pre>
<p>In order to revert this change, use <i>-i</i>.
</p><p>Ignore the <i>/etc/resolv.conf</i> instructions below.
</p>
</span></li>
<li id="cite_note-5"><span class="mw-cite-backlink"><a href="#cite_ref-5">↑</a></span> <span class="reference-text">
This is done to prevent the old DNS server being used.
For further discussion of this issue, see:
<a class="external free" data-href="https://github.com/adrelanos/vpn-firewall/issues/16" href="https://github.com/adrelanos/vpn-firewall/issues/16" rel="noreferrer noopener" target="_blank">https://github.com/adrelanos/vpn-firewall/issues/16</a></span>
</li>
<li id="cite_note-6"><span class="mw-cite-backlink"><a href="#cite_ref-6">↑</a></span> <span class="reference-text">
So changes in <i>/etc/resolvconf/run/interface/original.resolvconf</i> from chapter <a href="#DNS_Configuration">#DNS Configuration</a> take effect.</span>
</li>
<li id="cite_note-7"><span class="mw-cite-backlink"><a href="#cite_ref-7">↑</a></span> <span class="reference-text">This has the same effect as the <i>scurl</i> command above.</span>
</li>
<li id="cite_note-8"><span class="mw-cite-backlink"><a href="#cite_ref-8">↑</a></span> <span class="reference-text">
Debian feature request: <a class="external text" data-href="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=824290" href="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=824290" rel="noreferrer noopener" target="_blank">add dpkg trigger for /usr/share/netfilter-persistent/plugins.d folder to have newly installed plugins take effect</a></span>
</li>
</ol></div></div>
<hr/>
<div style="padding-bottom:1px; padding-top:6px; border:thin solid black; background:#EEEEEE; text-align:center;"><u>Random News:</u>
<p>Bored? Want to chat with other Whonix users? Join us in <a class="external text" data-href="http://irc://irc.oftc.net/whonix" href="http://irc://irc.oftc.net/whonix" rel="noreferrer noopener" target="_blank">IRC</a> chat (<a class="external text" data-href="https://webirc.oftc.net:8443/?channels=Whonix" href="https://webirc.oftc.net:8443/?channels=Whonix" rel="noreferrer noopener" target="_blank">Webchat</a>).
</p>
</div>
<hr/><p><font size="-1"><a class="external text" data-href="./VPN-Firewall" href="./VPN-Firewall" rel="noreferrer noopener" target="_blank">https</a> | (<a data-href="/wiki/Forcing_.onion_on_Whonix.org" href="./Forcing_.onion_on_Whonix.org.html" title="Forcing .onion on Whonix.org">forcing</a>) <a class="external text" data-href="http://dds6qkxpwdeubwucdiaord2xgbbeyds25rbsgr73tbfpqpt4a6vjwsyd.onion/wiki/VPN-Firewall" href="http://dds6qkxpwdeubwucdiaord2xgbbeyds25rbsgr73tbfpqpt4a6vjwsyd.onion/wiki/VPN-Firewall" rel="noreferrer noopener" target="_blank">onion</a><br/>
</font></p><font size="-1"></font><p><font size="-1">Share: <a data-href="https://twitter.com/intent/tweet?url=./VPN-Firewall&amp;text=&amp;via=Whonix" href="https://twitter.com/intent/tweet?url=./VPN-Firewall&amp;text=&amp;via=Whonix">Twitter</a>
|
<a data-href="https://facebook.com/sharer.php?u=./VPN-Firewall" href="https://facebook.com/sharer.php?u=./VPN-Firewall">Facebook</a></font>
</p><p><font size="-1">This is a wiki. Want to improve this page? Help is welcome and volunteer contributions are happily considered! See <a class="external text" data-href="https://github.com/Whonix/Whonix/blob/master/CONTRIBUTING.md" href="https://github.com/Whonix/Whonix/blob/master/CONTRIBUTING.md" rel="noreferrer noopener" target="_blank">Conditions for Contributions to Whonix</a>, then <a data-href="/w/index.php?title=VPN-Firewall&amp;action=edit" href="https://www.whonix.org/w/index.php?title=VPN-Firewall&amp;action=edit">Edit</a>! IP addresses are scrubbed, but editing over Tor is recommended. Edits are held for moderation.</font>
</p><p><font size="-1">Whonix is a <a class="external text" data-href="http://www.openinventionnetwork.com/licensees.php" href="http://www.openinventionnetwork.com/licensees.php" rel="noreferrer noopener" target="_blank">licensee</a> of the Open Invention Network. Unless otherwise noted, the content of this page is <a data-href="/wiki/Whonix:Copyrights" href="./Whonix:Copyrights.html" title="Whonix:Copyrights">copyrighted</a> and licensed under the same Libre Software <a class="external text" data-href="https://github.com/Whonix/Whonix/blob/master/debian/copyright" href="https://github.com/Whonix/Whonix/blob/master/debian/copyright" rel="noreferrer noopener" target="_blank">license</a> as Whonix itself. (<a data-href="/wiki/Why_Whonix_is_Free_Software" href="./Why_Whonix_is_Free_Software.html" title="Why Whonix is Free Software">Why?</a>)</font>
</p>
<!-- 
NewPP limit report
Cached time: 20181009035304
Cache expiry: 0
Dynamic content: true
CPU time usage: 0.220 seconds
Real time usage: 0.382 seconds
Preprocessor visited node count: 991/1000000
Preprocessor generated node count: 2577/1000000
Post‐expand include size: 19945/2097152 bytes
Template argument size: 2626/2097152 bytes
Highest expansion depth: 8/40
Expensive parser function count: 0/100
Unstrip recursion depth: 1/20
Unstrip post‐expand size: 11871/5000000 bytes
Lua time usage: 0.050/7.000 seconds
Lua virtual size: 14.8 MB/50 MB
Lua estimated memory usage: 0 bytes
-->
<!--
Transclusion expansion time report (%,ms,calls,template)
100.00%  314.001      1 -total
 30.16%   94.706      4 Template:Mbox
 28.69%   90.100     13 Template:CodeSelect
 27.35%   85.885      5 Template:Open_with_root_rights
 26.19%   82.224      5 Template:Box
 14.49%   45.489      1 Template:Header
 14.24%   44.700      1 Template:Reflist
  6.45%   20.250      1 Template:VPN/Setup/DNS_Configuration
  5.68%   17.831      1 Template:Footer
  3.85%   12.092      1 Template:VPN/Setup/VPN_Credentials
-->
</div></div><div class="printfooter">
Retrieved from "<a data-href="https://www.whonix.org/w/index.php?title=VPN-Firewall&amp;oldid=36023" dir="ltr" href="https://www.whonix.org/w/index.php?title=VPN-Firewall&amp;oldid=36023">https://www.whonix.org/w/index.php?title=VPN-Firewall&amp;oldid=36023</a>"</div>
<div class="clear_both"></div>
</div>
<div class="group"><div class="catlinks" data-mw="interface" id="catlinks"><div class="mw-normal-catlinks" id="mw-normal-catlinks"><a data-href="/wiki/Special:Categories" href="./Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a data-href="/wiki/Category:Documentation" href="./Category:Documentation.html" title="Category:Documentation">Documentation</a></li></ul></div></div></div>
</div>
</div>
</div>
<footer class="row">
<div id="footer">
<div class="small-12 large-centered columns text-center" id="footer-left">
<ul id="footer-left">
<li id="footer-lastmod"> This page was last edited on 20 August 2018, at 19:17.</li>
<li id="footer-Priority_Support"><a data-href="/wiki/Priority_Support" href="./Priority_Support.html" title="Priority Support">Priority Support</a></li>
<li id="footer-Investors"><a data-href="/wiki/Investors" href="./Investors.html" title="Investors">Investors</a></li>
<li id="footer-Professional_Support"><a data-href="/wiki/Professional_Support" href="./Professional_Support.html" title="Professional Support">Professional Support</a></li>
</ul>
</div>
<div class="large-12 small-12 columns" id="footer-right-icons">
<ul id="poweredby">
</ul>
</div>
</div>
</footer>
</div>

</body>
<!-- Cached/compressed 20181009035304 -->
</html>
